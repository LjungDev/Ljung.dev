<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Ljung | Character Movement from Scratch pt 5: Jumping</title><meta name="description" content="Here we&#x27;ll look at jumping, and state machines."/><meta name="next-head-count" content="4"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/14da082a368919fc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/14da082a368919fc.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-9b5d6ec4444c80fa.js" defer=""></script><script src="/_next/static/chunks/main-7c70317c243a4143.js" defer=""></script><script src="/_next/static/chunks/pages/_app-301819447092fb27.js" defer=""></script><script src="/_next/static/chunks/ddc9e94f-4c7cb313852dfa1e.js" defer=""></script><script src="/_next/static/chunks/247-2427dfe63c188f3b.js" defer=""></script><script src="/_next/static/chunks/13-1bb7831376086322.js" defer=""></script><script src="/_next/static/chunks/pages/tutorial/%5Bslug%5D-22eeb0a3910b85b8.js" defer=""></script><script src="/_next/static/FdMC6e8Jf18CHKkiz_cXU/_buildManifest.js" defer=""></script><script src="/_next/static/FdMC6e8Jf18CHKkiz_cXU/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Baloo+2&family=Fira+Code&family=Open+Sans:wght@300;400;700&display=swap">@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazaps.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sFVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpp_lGP6HcMqzQCjA.woff) format('woff');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpn_lGP6HcMqzQCjA.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpm_lGP6HcMqzQCjA.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpo_lGP6HcMqzQ.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJV37MOzlojwUKaJO.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVT7MOzlojwUKaJO.woff) format('woff');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVz7MOzlojwUKaJO.woff) format('woff');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVP7MOzlojwUKaJO.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJV77MOzlojwUKaJO.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVD7MOzlojwUKQ.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8H57QK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="flex flex-col min-h-screen"><div class="flex flex-col items-center grow pt-12 bg-snow-storm-2 dark:bg-polar-night-0"><div class="flex items-center gap-2"><div class="flex items-center gap-2 hover:cursor-pointer hover:opacity-75"><div class="relative w-14 h-24"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="Logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:contain"/><noscript><img alt="Logo" src="/logo.svg" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:contain" loading="lazy"/></noscript></span></div><div class=" flex flex-col items-center gap-1"><div class="relative"><h1 class="text-6xl font-display text-polar-night-0 dark:text-snow-storm-2">Ljung</h1><span class="absolute right-0 bottom-0.5 w-0"><span class="text-base font-display opacity-50 text-polar-night-0 dark:text-snow-storm-2"></span></span></div></div><span class="text-base font-display opacity-50 text-polar-night-0 dark:text-snow-storm-2">.dev</span></div><div class="flex gap-1 items-center font-body text-base"><a class="font-bold text-polar-night-0 dark:text-snow-storm-2" href="/tutorials/">Tutorials</a></div></div><div class="max-w-xl w-full flex flex-col gap-12 items-center mb-12"><div class="h-[1px] w-full opacity-10 bg-polar-night-0 dark:bg-snow-storm-2"></div><div class="flex flex-col gap-5 max-w-[min(100%,512px)] m-3 p-3 text-polar-night-0 dark:text-snow-storm-2 text-base font-body"><div class="flex"><div class="grow text-left"><a class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="/tutorial/character-movement-from-scratch-pt-4-gravity/">« <!-- -->pt 4: Gravity</a></div><div class="grow text-right"></div></div><div><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false">A project using this tutorial series is <a target="_blank" class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="https://github.com/LjungDev/Cactus">tracked on GitHub</a>. The revision after this part is <a target="_blank" class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="https://github.com/LjungDev/Cactus/commit/0a7652301f4c68c70d483575f35c7ab2bd41ef76">0a76523</a>.</p></blockquote><p class="py-2 false">Hej!</p><p class="py-2 false">With gravity done implementing jumping is theoretically easy; just add a force upwards for one tick and let gravity handle the rest. In practice however, with our current code, there is much to be done.</p><p class="py-2 false">The main problem is that we do a ground check every tick, and because of how jumping works we&#x27;ll probably just zero out our vertical velocity as soon as we start jumping.</p><p class="py-2 false">Of course, this can be solved with more code, but it quickly gets messy if we don&#x27;t think about our architecture. Luckily, there&#x27;s a very common code pattern that can be used to solve this: State Machines!</p><h1 class="font-display text-4xl pt-6">State Machine</h1><h2 class="font-display text-3xl pt-5">Concept</h2><p class="py-2 false">If you&#x27;re unfamiliar with State Machines it is very simple. Given a set of distinct abstract &quot;states&quot; (e.g. &quot;Walking&quot;, &quot;Falling&quot;, &quot;Swimming&quot; etc.) we switch between which set of code we use based on a single variable called &quot;the current state&quot;, which can only be one of the state at a time.</p><p class="py-2 false">The current state is changed based on &quot;transitions&quot; - conditions in each state that causes it to enter another state. For example, if we&#x27;re &quot;Walking&quot; and we suddenly have no ground, we&#x27;re now &quot;Falling&quot;.</p><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false">The built-in <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">CharacterMovementComponent</code> actually use this pattern! As well as many other concepts in game development like AI.</p></blockquote><h2 class="font-display text-3xl pt-5">Code</h2><p class="py-2 false">Based on this, we should introduce two states, &quot;Walking&quot; and &quot;Falling&quot;. Both states share similar functionality (for example both consume and apply horizontal movement) but they differ slightly. I&#x27;ve made a diagram that outline the basic states and functions we&#x27;re going to refactor/use:</p><div class="flex justify-center cursor-pointer"><div style="overflow:hidden;position:relative;width:100%;max-width:2021px"><img style="display:block;width:100%" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDIxIiBoZWlnaHQ9IjUxMSI+PC9zdmc+" aria-hidden="true" alt=""/><img role="presentation" aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgLChULFg4OFRUNDh0TFgUMFxUZGBYVIhUiKzcvGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0NFQ8NHDscFh0vLy8vLy87Oy8vLy8vLy8vLy8vLy87Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAAcAGAMBIgACEQEDEQH/xAAXAAEAAwAAAAAAAAAAAAAAAAAAAgMH/8QAHBAAAgICAwAAAAAAAAAAAAAAAAMBAgVCBDFB/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAwDAQACEQMRAD8A19nKWuPZK65BdtZABUW5Ki+qgAJX/9k=" style="opacity:1;transition:opacity 500ms;position:absolute;left:0;top:0;width:100%"/><noscript><picture><source srcSet="https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;dpr=0.25&amp;fm=webp&amp;max-w=600 505w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;dpr=0.5&amp;fm=webp&amp;max-w=600 1010w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;dpr=0.75&amp;fm=webp&amp;max-w=600 1515w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;fm=webp&amp;max-w=600 2021w" sizes="(max-width: 2021px) 100vw, 2021px" type="image/webp"/><source srcSet="https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;dpr=0.25&amp;max-w=600 505w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;dpr=0.5&amp;max-w=600 1010w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;dpr=0.75&amp;max-w=600 1515w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;max-w=600 2021w" sizes="(max-width: 2021px) 100vw, 2021px"/><img src="https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format&amp;max-w=600" alt="" style="position:absolute;left:0;top:0;width:100%;height:100%" loading="lazy"/></picture></noscript></div></div><p class="py-2 false">Blue elements represent common functionality between the states, and circles are state transitions.</p><p class="py-2 false">To support this, we&#x27;re going to rewrite most of our movement component, but let&#x27;s start with the state machine. We&#x27;re going to use an Enum to hold our possible states, a variable with our current state, and two functions for walking and falling respectively.</p><p class="py-2 false">To our movement component header let&#x27;s add above our class declaration:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#88C0D0">UENUM</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">enum</span><span> </span><span class="token" style="color:#88C0D0">EMovementState</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  Walking</span><span class="token" style="color:#81A1C1">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span>  Falling
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span></span><span class="token" style="color:#81A1C1">}</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And inside our class declaration, after our tick function let&#x27;s add:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">private</span><span class="token" style="color:#81A1C1">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>  EMovementState MovementState</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">DoMovement_Walking</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>  </span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">DoMovement_Falling</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">To keep things nice and functional we&#x27;ll provide the <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">DeltaTime</code> for them to avoid having to grab it elsewhere.</p><p class="py-2 false">In our cpp file inside <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">TickComponent</code> we&#x27;ll remove everything after our velocity reset and replace with the state check and functions:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">switch</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>MovementState</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span></span><span class="token" style="color:#81A1C1">case</span><span> Walking</span><span class="token" style="color:#81A1C1">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>  </span><span class="token" style="color:#88C0D0">DoMovement_Walking</span><span class="token" style="color:#81A1C1">(</span><span>DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span>  </span><span class="token" style="color:#81A1C1">break</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span></span><span class="token" style="color:#81A1C1">case</span><span> Falling</span><span class="token" style="color:#81A1C1">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span><span>  </span><span class="token" style="color:#88C0D0">DoMovement_Falling</span><span class="token" style="color:#81A1C1">(</span><span>DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span><span>  </span><span class="token" style="color:#81A1C1">break</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">11</span><span></span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">13</span><span></span><span class="token" style="color:#88C0D0">UpdateComponentVelocity</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And that&#x27;s all for the state machine itself! However we&#x27;re now missing our walking/falling functionality, but before that we need to implement some additional functions.</p><h1 class="font-display text-4xl pt-6">Desired Input</h1><p class="py-2 false">Since both Walking and Falling want to use desired (horizontal) input we will move that into a separate function to avoid code duplication. We&#x27;ll however omit the <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">ConsumeInputVector</code> call from that since that directly modifies a class variable, and we want to keep our functions as pure as possible. Instead we&#x27;ll provide the input vector as a function parameter.</p><p class="py-2 false">In our header file, below our <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">MovemenState</code> variable, add:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>FVector </span><span class="token" style="color:#88C0D0">GetDesiredInputMovement</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">const</span><span> FVector InputVector</span><span class="token" style="color:#81A1C1">)</span><span> </span><span class="token" style="color:#81A1C1">const</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And add the implementation, which is just our horizontal movement calculation from before:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>FVector </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">GetDesiredInputMovement</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">const</span><span> FVector InputVector</span><span class="token" style="color:#81A1C1">)</span><span> </span><span class="token" style="color:#81A1C1">const</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector</span><span class="token" style="color:#81A1C1">&amp;</span><span> Input </span><span class="token" style="color:#81A1C1">=</span><span> InputVector</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">GetClampedToMaxSize2D</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#B48EAD">1.0f</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector Movement </span><span class="token" style="color:#81A1C1">=</span><span> Input </span><span class="token" style="color:#81A1C1">*</span><span> MoveSpeed</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>  </span><span class="token" style="color:#81A1C1">return</span><span> Movement</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><h1 class="font-display text-4xl pt-6">Move</h1><p class="py-2 false">The Move function will perform the bulk of our previous functionality. The function will take <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">DeltaTime</code> and return if we hit something, as well as output the hit result.</p><p class="py-2 false">In our header we add the declaration just above our <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">DoMovement</code> functions:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">bool</span><span> </span><span class="token" style="color:#88C0D0">Move</span><span class="token" style="color:#81A1C1">(</span><span>FHitResult</span><span class="token" style="color:#81A1C1">&amp;</span><span> OutInitialHit</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And for our definition we basically do the same as our previous tick function, with added handling for the return values:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">bool</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">Move</span><span class="token" style="color:#81A1C1">(</span><span>FHitResult</span><span class="token" style="color:#81A1C1">&amp;</span><span> OutInitialHit</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FRotator</span><span class="token" style="color:#81A1C1">&amp;</span><span> Rotation </span><span class="token" style="color:#81A1C1">=</span><span> UpdatedComponent</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetComponentRotation</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector MovementDelta </span><span class="token" style="color:#81A1C1">=</span><span> Velocity </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>  </span><span class="token" style="color:#88C0D0">SafeMoveUpdatedComponent</span><span class="token" style="color:#81A1C1">(</span><span>MovementDelta</span><span class="token" style="color:#81A1C1">,</span><span> Rotation</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">true</span><span class="token" style="color:#81A1C1">,</span><span> OutInitialHit</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>OutInitialHit</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">IsValidBlockingHit</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span><span>    </span><span class="token" style="color:#88C0D0">HandleImpact</span><span class="token" style="color:#81A1C1">(</span><span>OutInitialHit</span><span class="token" style="color:#81A1C1">,</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">,</span><span> MovementDelta</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">11</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">12</span><span>    FHitResult </span><span class="token" style="color:#88C0D0">Hit</span><span class="token" style="color:#81A1C1">(</span><span>OutInitialHit</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">13</span><span>    </span><span class="token" style="color:#88C0D0">SlideAlongSurface</span><span class="token" style="color:#81A1C1">(</span><span>MovementDelta</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#B48EAD">1.0f</span><span> </span><span class="token" style="color:#81A1C1">-</span><span> OutInitialHit</span><span class="token" style="color:#81A1C1">.</span><span>Time</span><span class="token" style="color:#81A1C1">,</span><span> OutInitialHit</span><span class="token" style="color:#81A1C1">.</span><span>Normal</span><span class="token" style="color:#81A1C1">,</span><span> Hit</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">true</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">14</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">15</span><span>    </span><span class="token" style="color:#81A1C1">return</span><span> </span><span class="token" style="color:#81A1C1">true</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">16</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">17</span><span>  </span><span class="token" style="color:#81A1C1">return</span><span> </span><span class="token" style="color:#81A1C1">false</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">18</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><p class="py-2 false">Note that we copy the hit result to use with <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">SlideAlongSurface</code>, because it may modify the hit result in turn, and we are only interested in the initial hit for additional handling later.</p><p class="py-2 false">We also no longer reset our Z velocity as that is specific to the <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">Falling</code> state.</p><h1 class="font-display text-4xl pt-6">Ground Check</h1><p class="py-2 false">This is where it becomes a bit more complex, as we cannot use the same hit check for ground as we have for <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">Move</code>, since you might move upwards or collide with a wall. Instead we need to manually implement a similar function that sweeps the world and checks for ground.</p><p class="py-2 false">The function signature is simple enough; return a <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">bool</code> and hit result similar to the <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">Move</code> function. In our header about the <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">Move</code> function add:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">bool</span><span> </span><span class="token" style="color:#88C0D0">CheckForGround</span><span class="token" style="color:#81A1C1">(</span><span>FHitResult</span><span class="token" style="color:#81A1C1">&amp;</span><span> OutHit</span><span class="token" style="color:#81A1C1">)</span><span> </span><span class="token" style="color:#81A1C1">const</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">The internals involve a bit more lines though.</p><h2 class="font-display text-3xl pt-5">Collider Reference</h2><p class="py-2 false">Manual collision checking is done with either line traces or shape sweeps. In our case we&#x27;ll do a shape sweep that mimics the same shape as our collider. Our movement component doesn&#x27;t know about our capsule collider however, so we need keep a reference to it.</p><p class="py-2 false">In our header just above our <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">MovementState</code> variable add:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#88C0D0">UPROPERTY</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>UCapsuleComponent</span><span class="token" style="color:#81A1C1">*</span><span> UpdatedCollider</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And above our <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">TickComponent</code> we need to add an override for <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">BeginPlay</code> to grab our collider:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">virtual</span><span> </span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">BeginPlay</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span> </span><span class="token" style="color:#81A1C1">override</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">Then in our cpp file add the capsule collider header:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token macro directive-hash" style="color:#81A1C1">#</span><span class="token macro directive" style="color:#81A1C1">include</span><span class="token macro" style="color:#81A1C1"> </span><span class="token macro" style="color:#A3BE8C">&quot;Components/CapsuleComponent.h&quot;</span></code></pre></div><p class="py-2 false">And implement the <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">BeginPlay</code> function like so:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">BeginPlay</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#88C0D0">Super</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">BeginPlay</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>  UpdatedCollider </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token generic-function" style="color:#88C0D0">Cast</span><span class="token generic-function generic" style="color:#81A1C1">&lt;</span><span class="token generic-function generic" style="color:#88C0D0">UCapsuleComponent</span><span class="token generic-function generic" style="color:#81A1C1">&gt;</span><span class="token" style="color:#81A1C1">(</span><span>UpdatedComponent</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><p class="py-2 false">We should now have a capsule collider reference in runtime to work with.</p><h2 class="font-display text-3xl pt-5">Sweep</h2><p class="py-2 false">A shape sweep requires a few parameters:</p><ul class="list-disc list-inside"><li class="my-2 pl-2"><p class="py-2 inline">Start location</p></li><li class="my-2 pl-2"><p class="py-2 inline">End location</p></li><li class="my-2 pl-2"><p class="py-2 inline">Rotation</p></li><li class="my-2 pl-2"><p class="py-2 inline">Collision channel</p></li><li class="my-2 pl-2"><p class="py-2 inline">Shape</p></li><li class="my-2 pl-2"><p class="py-2 inline">Query/response parameters</p></li></ul><p class="py-2 false">Most of these can be extracted from our capsule collider, however we need to take note that locations are based on the center point of the shape (not the base).</p><p class="py-2 false">We&#x27;ll start of the GroundCheck function by checking if we have our UpdatedCollider:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">bool</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">CheckForGround</span><span class="token" style="color:#81A1C1">(</span><span>FHitResult</span><span class="token" style="color:#81A1C1">&amp;</span><span> OutHit</span><span class="token" style="color:#81A1C1">)</span><span> </span><span class="token" style="color:#81A1C1">const</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">!</span><span>UpdatedCollider</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>    </span><span class="token" style="color:#81A1C1">return</span><span> </span><span class="token" style="color:#81A1C1">false</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>  </span><span class="token" style="color:#81A1C1">}</span></code></pre></div><p class="py-2 false">Next we setup some constants and calculate our start and end sweep location:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">constexpr</span><span> </span><span class="token" style="color:#81A1C1">static</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> ZOffset </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">5.0f</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector Offset </span><span class="token" style="color:#81A1C1">=</span><span> FVector</span><span class="token double-colon" style="color:#81A1C1">::</span><span>UpVector </span><span class="token" style="color:#81A1C1">*</span><span> ZOffset</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector ColliderLocation </span><span class="token" style="color:#81A1C1">=</span><span> UpdatedCollider</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetComponentLocation</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector StartLocation </span><span class="token" style="color:#81A1C1">=</span><span> ColliderLocation</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector EndLocation </span><span class="token" style="color:#81A1C1">=</span><span> ColliderLocation </span><span class="token" style="color:#81A1C1">-</span><span> Offset</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false"><code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">constexpr static</code> is just an optimization for a purely constant value, but you can also make this a regular <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">UPROPERTY</code> if you intend to tweak it a lot.</p></blockquote><p class="py-2 false">Next, we setup our sweep configuration. We need four things:</p><ul class="list-disc list-inside"><li class="my-2 pl-2"><p class="py-2 inline">FCollisionQueryParams which we use to make sure we don&#x27;t self-collide</p></li><li class="my-2 pl-2"><p class="py-2 inline">FCollisionResponseParams which controls a few extra flags, that we copy directly from our collider</p></li><li class="my-2 pl-2"><p class="py-2 inline">FCollisionShape with the correct capsule shape, which we just grab from our collider as well</p></li><li class="my-2 pl-2"><p class="py-2 inline">ECollisionChannel value that tells what to collide against, also provided by the collider</p></li></ul><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>FCollisionQueryParams SweepParams</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>SweepParams</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">AddIgnoredActor</span><span class="token" style="color:#81A1C1">(</span><span>UpdatedCollider</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetOwner</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>FCollisionResponseParams ResponseParams</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>UpdatedCollider</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">InitSweepCollisionParams</span><span class="token" style="color:#81A1C1">(</span><span>SweepParams</span><span class="token" style="color:#81A1C1">,</span><span> ResponseParams</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span>FCollisionShape SweepShape </span><span class="token" style="color:#81A1C1">=</span><span> UpdatedCollider</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetCollisionShape</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span></span><span class="token" style="color:#81A1C1">const</span><span> ECollisionChannel CollisionChannel </span><span class="token" style="color:#81A1C1">=</span><span> UpdatedCollider</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetCollisionObjectType</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">Finally we perform the sweep using the world object, and return if we hit or not:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">bool</span><span> bDidHit </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetWorld</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">SweepSingleByChannel</span><span class="token" style="color:#81A1C1">(</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>  OutHit</span><span class="token" style="color:#81A1C1">,</span><span> StartLocation</span><span class="token" style="color:#81A1C1">,</span><span> EndLocation</span><span class="token" style="color:#81A1C1">,</span><span> FQuat</span><span class="token double-colon" style="color:#81A1C1">::</span><span>Identity</span><span class="token" style="color:#81A1C1">,</span><span> CollisionChannel</span><span class="token" style="color:#81A1C1">,</span><span> SweepShape</span><span class="token" style="color:#81A1C1">,</span><span> SweepParams</span><span class="token" style="color:#81A1C1">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  ResponseParams</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span></span><span class="token" style="color:#81A1C1">return</span><span> bDidHit</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><h1 class="font-display text-4xl pt-6">State: Walking</h1><p class="py-2 false">Our walking function is quite simply now since we&#x27;ve refactored a lot of the code into functions. It is about the same as our previous code, with the addition of changing state to Falling when we aren&#x27;t grounded anymore:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">DoMovement_Walking</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector InputVector </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">ConsumeInputVector</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector HorizontalMovement </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetDesiredInputMovement</span><span class="token" style="color:#81A1C1">(</span><span>InputVector</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>  Velocity </span><span class="token" style="color:#81A1C1">+=</span><span> HorizontalMovement</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span>  FHitResult Hit</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span>  </span><span class="token" style="color:#88C0D0">Move</span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">,</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">bool</span><span> bIsGrounded </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">CheckForGround</span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">11</span>  
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">12</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">!</span><span>bIsGrounded</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">13</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">14</span><span>    MovementState </span><span class="token" style="color:#81A1C1">=</span><span> Falling</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">15</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">16</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><h1 class="font-display text-4xl pt-6">State: Falling</h1><p class="py-2 false">Our Falling function is similar to our Walking function with the additional code for apply gravity and state change. If you go back to the diagram you&#x27;ll also see that we need to handle hitting the ceiling, otherwise some interesting oddities will happen.</p><p class="py-2 false">To check for ceiling we first check if we hit something, and we&#x27;re moving upwards (<code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">Velocity.Z &gt; 0</code>), then grab the dot product of the impact normal and check the angle to see if we hit a flat ceiling, and stop if we do.</p><p class="py-2 false">If you&#x27;re unfamiliar with the concepts, the impact normal is a vector that points straight out from the surface we hit, the dot product is a value that tells how close two vectors (like our normal and straight down) are rotation-wise, and to get the angle (in radians) we get the arc-cosine of the value.</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">DoMovement_Falling</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector InputVector </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">ConsumeInputVector</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector HorizontalMovement </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetDesiredInputMovement</span><span class="token" style="color:#81A1C1">(</span><span>InputVector</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>  </span><span class="token" style="color:#636f88">// Apply gravity</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> GravityForce </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetGravityZ</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector VerticalMovement </span><span class="token" style="color:#81A1C1">=</span><span> FVector</span><span class="token double-colon" style="color:#81A1C1">::</span><span>UpVector </span><span class="token" style="color:#81A1C1">*</span><span> GravityForce </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> TerminalVelocity </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetPhysicsVolume</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">-&gt;</span><span>TerminalVelocity</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">11</span><span>  Velocity </span><span class="token" style="color:#81A1C1">+=</span><span> HorizontalMovement </span><span class="token" style="color:#81A1C1">+</span><span> VerticalMovement</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">12</span><span>  Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">FMath</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">Max</span><span class="token" style="color:#81A1C1">(</span><span>Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">-</span><span>TerminalVelocity</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">13</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">14</span><span>  FHitResult Hit</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">15</span><span>  </span><span class="token" style="color:#81A1C1">bool</span><span> bDidHit </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">Move</span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">,</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">16</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">17</span><span>  </span><span class="token" style="color:#636f88">// Check if we hit ceiling</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">18</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>bDidHit </span><span class="token" style="color:#81A1C1">&amp;&amp;</span><span> Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">&gt;</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">19</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">20</span><span>    </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> Dot </span><span class="token" style="color:#81A1C1">=</span><span> Hit</span><span class="token" style="color:#81A1C1">.</span><span>ImpactNormal</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">Dot</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">-</span><span>FVector</span><span class="token double-colon" style="color:#81A1C1">::</span><span>UpVector</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">21</span><span>    </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> Angle </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">FMath</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">Acos</span><span class="token" style="color:#81A1C1">(</span><span>Dot</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">22</span><span>    </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> StopAngleInRadians </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">FMath</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">DegreesToRadians</span><span class="token" style="color:#81A1C1">(</span><span>MaxCeilingStopAngle</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">23</span><span>    </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>Angle </span><span class="token" style="color:#81A1C1">&lt;=</span><span> StopAngleInRadians</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">24</span><span>    </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">25</span><span>      Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">26</span><span>    </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">27</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">28</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">29</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">bool</span><span> bIsGrounded </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">CheckForGround</span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">30</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>bIsGrounded </span><span class="token" style="color:#81A1C1">&amp;&amp;</span><span> Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">&lt;=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">31</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">32</span><span>    MovementState </span><span class="token" style="color:#81A1C1">=</span><span> Walking</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">33</span><span>    Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">34</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">35</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><p class="py-2 false">For the ceiling check I&#x27;ve extracted the angle into a <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">UPROPERTY</code> value called <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">MaxCeilingStopAngle</code> and set its default to 5.0f, so we hit a ceiling the angle of the hit is within 5 degrees of straight up.</p><p class="py-2 false">For our state change we also check that we&#x27;re moving downwards so we don&#x27;t accidentally snap when for example jumping over something.</p><h1 class="font-display text-4xl pt-6">Jumping!</h1><p class="py-2 false">And that leads us (finally!) to jumping. As with any action we need to setup the input. </p><h2 class="font-display text-3xl pt-5">Input</h2><p class="py-2 false">In our <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">CactusPlayerPawn</code> (or your equivalent) we add an input action (next the other input actions):</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#88C0D0">UPROPERTY</span><span class="token" style="color:#81A1C1">(</span><span>EditDefaultsOnly</span><span class="token" style="color:#81A1C1">,</span><span> Category</span><span class="token" style="color:#81A1C1">=</span><span class="token" style="color:#A3BE8C">&quot;Input&quot;</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>UInputAction</span><span class="token" style="color:#81A1C1">*</span><span> JumpAction</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And a function declaration (below our other input functions):</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">OnInput_Jump</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">For our implementation the input binding is the same as the others (in <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">SetupPlayerInputComponent</code>):</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>PlayerEnhancedInputComponent</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">BindAction</span><span class="token" style="color:#81A1C1">(</span><span>JumpAction</span><span class="token" style="color:#81A1C1">,</span><span> ETriggerEvent</span><span class="token double-colon" style="color:#81A1C1">::</span><span>Triggered</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">this</span><span class="token" style="color:#81A1C1">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>                                         </span><span class="token" style="color:#81A1C1">&amp;</span><span>ACactusPlayerPawn</span><span class="token double-colon" style="color:#81A1C1">::</span><span>OnInput_Jump</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And the jump function will just trigger the jump on our movement component, which we&#x27;ll setup soon:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">ACactusPlayerPawn</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">OnInput_Jump</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  MovementComponent</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">Jump</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><p class="py-2 false">For the input action, since jump is always a &quot;press&quot; and not a &quot;hold&quot; like the other inputs, we also add a trigger with &quot;Pressed&quot; to it:</p><div class="flex justify-center cursor-pointer"><div style="overflow:hidden;position:relative;width:100%;max-width:469px"><img style="display:block;width:100%" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0NjkiIGhlaWdodD0iNDEwIj48L3N2Zz4=" aria-hidden="true" alt=""/><img role="presentation" aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBw0SBhMLDQgIBwcNDg4QBwcGBxEJDQgYFx8ZGBYVFhUaHysjGh0oHSEiJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OFQ0NFS8cFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABUAGAMBIgACEQEDEQH/xAAaAAADAAMBAAAAAAAAAAAAAAAAAwQCBQYB/8QAHBABAAIBBQAAAAAAAAAAAAAAAAIDIQERIjEy/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDir5cWts9K7Z4S7ZSLloGU3iCqfRQCJdgAIf/Z" style="opacity:1;transition:opacity 500ms;position:absolute;left:0;top:0;width:100%"/><noscript><picture><source srcSet="https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;dpr=0.25&amp;fm=webp&amp;max-w=600 117w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;dpr=0.5&amp;fm=webp&amp;max-w=600 234w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;dpr=0.75&amp;fm=webp&amp;max-w=600 351w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;fm=webp&amp;max-w=600 469w" sizes="(max-width: 469px) 100vw, 469px" type="image/webp"/><source srcSet="https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;dpr=0.25&amp;max-w=600 117w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;dpr=0.5&amp;max-w=600 234w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;dpr=0.75&amp;max-w=600 351w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;max-w=600 469w" sizes="(max-width: 469px) 100vw, 469px"/><img src="https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format&amp;max-w=600" alt="" style="position:absolute;left:0;top:0;width:100%;height:100%" loading="lazy"/></picture></noscript></div></div><p class="py-2 false">We add the action to our input mapping context and set our desired input keys:</p><div class="flex justify-center cursor-pointer"><div style="overflow:hidden;position:relative;width:100%;max-width:538px"><img style="display:block;width:100%" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MzgiIGhlaWdodD0iNjA2Ij48L3N2Zz4=" aria-hidden="true" alt=""/><img role="presentation" aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBxAHBhUNCAgNDQcNDg8OBQgNDhYNDQcNFxUZGCIVFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0NEA0NEC8cFh0vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAFQMBIgACEQEDEQH/xAAZAAEBAAMBAAAAAAAAAAAAAAAABAMFBgH/xAAcEAEAAQUBAQAAAAAAAAAAAAAAAQIDERIhEwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAMAwEAAhEDEQA/AOI+qdqWv8+rbk5hjwQQ12s1CyaegM13kJt+vQDYAH//2Q==" style="opacity:1;transition:opacity 500ms;position:absolute;left:0;top:0;width:100%"/><noscript><picture><source srcSet="https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;dpr=0.25&amp;fm=webp&amp;max-w=600 134w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;dpr=0.5&amp;fm=webp&amp;max-w=600 269w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;dpr=0.75&amp;fm=webp&amp;max-w=600 403w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;fm=webp&amp;max-w=600 538w" sizes="(max-width: 538px) 100vw, 538px" type="image/webp"/><source srcSet="https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;dpr=0.25&amp;max-w=600 134w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;dpr=0.5&amp;max-w=600 269w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;dpr=0.75&amp;max-w=600 403w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;max-w=600 538w" sizes="(max-width: 538px) 100vw, 538px"/><img src="https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format&amp;max-w=600" alt="" style="position:absolute;left:0;top:0;width:100%;height:100%" loading="lazy"/></picture></noscript></div></div><p class="py-2 false">Don&#x27;t forget to set the input action reference in our Pawn BP!</p><h2 class="font-display text-3xl pt-5">Movement Code</h2><p class="py-2 false">The movement component header needs two things: a jump force variable, and a jump function (both <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">public</code>):</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">public</span><span class="token" style="color:#81A1C1">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>  </span><span class="token" style="color:#88C0D0">UPROPERTY</span><span class="token" style="color:#81A1C1">(</span><span>EditAnywhere</span><span class="token" style="color:#81A1C1">,</span><span> Category</span><span class="token" style="color:#81A1C1">=</span><span class="token" style="color:#A3BE8C">&quot;Movement&quot;</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>  </span><span class="token" style="color:#81A1C1">float</span><span> JumpForce</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span>  </span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span><span>  </span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">Jump</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false">I&#x27;ve set the default value of <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">JumpForce</code> in the constructor to 420.0f as a homage to the same default in the built-in character movement component.</p></blockquote><p class="py-2 false">And finally finally, the implementation of the jump function we&#x27;re we simply check if we&#x27;re Walking, add our jump force, and move to Falling:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">Jump</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>MovementState </span><span class="token" style="color:#81A1C1">==</span><span> Walking</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>    Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">+=</span><span> JumpForce</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>    MovementState </span><span class="token" style="color:#81A1C1">=</span><span> Falling</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><h1 class="font-display text-4xl pt-6">Results</h1><p class="py-2 false">All that refactoring for our 5 lines worth of jump code gives us the ability to jump!</p><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video><h2 class="font-display text-3xl pt-5">Ceiling</h2><p class="py-2 false">We should also stop when we hit a flat-ish ceiling, but slide along any angled ceilings:</p><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video><p class="py-2 false">Interestingly, because of how <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">SlideAlongSurface</code> works, we also slightly brake (proportional to the normal) when we hit a slope, giving us somewhat natural physics:</p><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video></div><div class="flex"><div class="grow text-left"><a class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="/tutorial/character-movement-from-scratch-pt-4-gravity/">« <!-- -->pt 4: Gravity</a></div><div class="grow text-right"></div></div></div><div class="h-[1px] w-full opacity-10 bg-polar-night-0 dark:bg-snow-storm-2"></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteMetainfo":{"headerTitle":"Ljung","headerSubtitle":".dev","pageTitlePrefix":"Ljung | "},"_site":{"globalSeo":{"siteName":"Ljung","fallbackSeo":{"title":"Ljung | Game Dev","description":"Indie Game Developer from Sweden 🎮"}}},"post":{"title":"Character Movement from Scratch pt 5: Jumping","description":"Here we'll look at jumping, and state machines.","seriesPrevious":{"slug":"character-movement-from-scratch-pt-4-gravity","seriesTitle":"pt 4: Gravity"},"seriesNext":null,"content":{"value":{"schema":"dast","document":{"type":"root","children":[{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","value":"A project using this tutorial series is "},{"url":"https://github.com/LjungDev/Cactus","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"tracked on GitHub"}]},{"type":"span","value":". The revision after this part is "},{"url":"https://github.com/LjungDev/Cactus/commit/0a7652301f4c68c70d483575f35c7ab2bd41ef76","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"0a76523"}]},{"type":"span","value":"."}]}]},{"type":"paragraph","children":[{"type":"span","value":"Hej!"}]},{"type":"paragraph","children":[{"type":"span","value":"With gravity done implementing jumping is theoretically easy; just add a force upwards for one tick and let gravity handle the rest. In practice however, with our current code, there is much to be done."}]},{"type":"paragraph","children":[{"type":"span","value":"The main problem is that we do a ground check every tick, and because of how jumping works we'll probably just zero out our vertical velocity as soon as we start jumping."}]},{"type":"paragraph","children":[{"type":"span","value":"Of course, this can be solved with more code, but it quickly gets messy if we don't think about our architecture. Luckily, there's a very common code pattern that can be used to solve this: State Machines!"}]},{"type":"heading","level":1,"children":[{"type":"span","value":"State Machine"}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Concept"}]},{"type":"paragraph","children":[{"type":"span","value":"If you're unfamiliar with State Machines it is very simple. Given a set of distinct abstract \"states\" (e.g. \"Walking\", \"Falling\", \"Swimming\" etc.) we switch between which set of code we use based on a single variable called \"the current state\", which can only be one of the state at a time."}]},{"type":"paragraph","children":[{"type":"span","value":"The current state is changed based on \"transitions\" - conditions in each state that causes it to enter another state. For example, if we're \"Walking\" and we suddenly have no ground, we're now \"Falling\"."}]},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","value":"The built-in "},{"type":"span","marks":["code"],"value":"CharacterMovementComponent"},{"type":"span","value":" actually use this pattern! As well as many other concepts in game development like AI."}]}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Code"}]},{"type":"paragraph","children":[{"type":"span","value":"Based on this, we should introduce two states, \"Walking\" and \"Falling\". Both states share similar functionality (for example both consume and apply horizontal movement) but they differ slightly. I've made a diagram that outline the basic states and functions we're going to refactor/use:"}]},{"item":"55480729","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"Blue elements represent common functionality between the states, and circles are state transitions."}]},{"type":"paragraph","children":[{"type":"span","value":"To support this, we're going to rewrite most of our movement component, but let's start with the state machine. We're going to use an Enum to hold our possible states, a variable with our current state, and two functions for walking and falling respectively."}]},{"type":"paragraph","children":[{"type":"span","value":"To our movement component header let's add above our class declaration:"}]},{"code":"UENUM()\nenum EMovementState\n{\n  Walking,\n  Falling\n};","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And inside our class declaration, after our tick function let's add:"}]},{"code":"private:\n  EMovementState MovementState;\n\n  void DoMovement_Walking(const float DeltaTime);\n  void DoMovement_Falling(const float DeltaTime);","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"To keep things nice and functional we'll provide the "},{"type":"span","marks":["code"],"value":"DeltaTime"},{"type":"span","value":" for them to avoid having to grab it elsewhere."}]},{"type":"paragraph","children":[{"type":"span","value":"In our cpp file inside "},{"type":"span","marks":["code"],"value":"TickComponent"},{"type":"span","value":" we'll remove everything after our velocity reset and replace with the state check and functions:"}]},{"code":"...\n\nswitch (MovementState)\n{\ncase Walking:\n  DoMovement_Walking(DeltaTime);\n  break;\ncase Falling:\n  DoMovement_Falling(DeltaTime);\n  break;\n}\n\nUpdateComponentVelocity();","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And that's all for the state machine itself! However we're now missing our walking/falling functionality, but before that we need to implement some additional functions."}]},{"type":"heading","level":1,"children":[{"type":"span","value":"Desired Input"}]},{"type":"paragraph","children":[{"type":"span","value":"Since both Walking and Falling want to use desired (horizontal) input we will move that into a separate function to avoid code duplication. We'll however omit the "},{"type":"span","marks":["code"],"value":"ConsumeInputVector"},{"type":"span","value":" call from that since that directly modifies a class variable, and we want to keep our functions as pure as possible. Instead we'll provide the input vector as a function parameter."}]},{"type":"paragraph","children":[{"type":"span","value":"In our header file, below our "},{"type":"span","marks":["code"],"value":"MovemenState"},{"type":"span","value":" variable, add:"}]},{"code":"FVector GetDesiredInputMovement(const FVector InputVector) const;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And add the implementation, which is just our horizontal movement calculation from before:"}]},{"code":"FVector USimpleMovementComponent::GetDesiredInputMovement(const FVector InputVector) const\n{\n  const FVector\u0026 Input = InputVector.GetClampedToMaxSize2D(1.0f);\n  const FVector Movement = Input * MoveSpeed;\n  return Movement;\n}","type":"code","language":"cpp"},{"type":"heading","level":1,"children":[{"type":"span","value":"Move"}]},{"type":"paragraph","children":[{"type":"span","value":"The Move function will perform the bulk of our previous functionality. The function will take "},{"type":"span","marks":["code"],"value":"DeltaTime"},{"type":"span","value":" and return if we hit something, as well as output the hit result."}]},{"type":"paragraph","children":[{"type":"span","value":"In our header we add the declaration just above our "},{"type":"span","marks":["code"],"value":"DoMovement"},{"type":"span","value":" functions:"}]},{"code":"bool Move(FHitResult\u0026 OutInitialHit, const float DeltaTime);","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And for our definition we basically do the same as our previous tick function, with added handling for the return values:"}]},{"code":"bool USimpleMovementComponent::Move(FHitResult\u0026 OutInitialHit, const float DeltaTime)\n{\n  const FRotator\u0026 Rotation = UpdatedComponent-\u003eGetComponentRotation();\n  const FVector MovementDelta = Velocity * DeltaTime;\n\n  SafeMoveUpdatedComponent(MovementDelta, Rotation, true, OutInitialHit);\n\n  if (OutInitialHit.IsValidBlockingHit())\n  {\n    HandleImpact(OutInitialHit, DeltaTime, MovementDelta);\n\n    FHitResult Hit(OutInitialHit);\n    SlideAlongSurface(MovementDelta, 1.0f - OutInitialHit.Time, OutInitialHit.Normal, Hit, true);\n\n    return true;\n  }\n  return false;\n}","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"Note that we copy the hit result to use with "},{"type":"span","marks":["code"],"value":"SlideAlongSurface"},{"type":"span","value":", because it may modify the hit result in turn, and we are only interested in the initial hit for additional handling later."}]},{"type":"paragraph","children":[{"type":"span","value":"We also no longer reset our Z velocity as that is specific to the "},{"type":"span","marks":["code"],"value":"Falling"},{"type":"span","value":" state."}]},{"type":"heading","level":1,"children":[{"type":"span","value":"Ground Check"}]},{"type":"paragraph","children":[{"type":"span","value":"This is where it becomes a bit more complex, as we cannot use the same hit check for ground as we have for "},{"type":"span","marks":["code"],"value":"Move"},{"type":"span","value":", since you might move upwards or collide with a wall. Instead we need to manually implement a similar function that sweeps the world and checks for ground."}]},{"type":"paragraph","children":[{"type":"span","value":"The function signature is simple enough; return a "},{"type":"span","marks":["code"],"value":"bool"},{"type":"span","value":" and hit result similar to the "},{"type":"span","marks":["code"],"value":"Move"},{"type":"span","value":" function. In our header about the "},{"type":"span","marks":["code"],"value":"Move"},{"type":"span","value":" function add:"}]},{"code":"bool CheckForGround(FHitResult\u0026 OutHit) const;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"The internals involve a bit more lines though."}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Collider Reference"}]},{"type":"paragraph","children":[{"type":"span","value":"Manual collision checking is done with either line traces or shape sweeps. In our case we'll do a shape sweep that mimics the same shape as our collider. Our movement component doesn't know about our capsule collider however, so we need keep a reference to it."}]},{"type":"paragraph","children":[{"type":"span","value":"In our header just above our "},{"type":"span","marks":["code"],"value":"MovementState"},{"type":"span","value":" variable add:"}]},{"code":"UPROPERTY()\nUCapsuleComponent* UpdatedCollider;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And above our "},{"type":"span","marks":["code"],"value":"TickComponent"},{"type":"span","value":" we need to add an override for "},{"type":"span","marks":["code"],"value":"BeginPlay"},{"type":"span","value":" to grab our collider:"}]},{"code":"\nvirtual void BeginPlay() override;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"Then in our cpp file add the capsule collider header:"}]},{"code":"\n#include \"Components/CapsuleComponent.h\"","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And implement the "},{"type":"span","marks":["code"],"value":"BeginPlay"},{"type":"span","value":" function like so:"}]},{"code":"void USimpleMovementComponent::BeginPlay()\n{\n  Super::BeginPlay();\n\n  UpdatedCollider = Cast\u003cUCapsuleComponent\u003e(UpdatedComponent);\n}","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"We should now have a capsule collider reference in runtime to work with."}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Sweep"}]},{"type":"paragraph","children":[{"type":"span","value":"A shape sweep requires a few parameters:"}]},{"type":"list","style":"bulleted","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"Start location"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"End location"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"Rotation"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"Collision channel"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"Shape"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"Query/response parameters"}]}]}]},{"type":"paragraph","children":[{"type":"span","value":"Most of these can be extracted from our capsule collider, however we need to take note that locations are based on the center point of the shape (not the base)."}]},{"type":"paragraph","children":[{"type":"span","value":"We'll start of the GroundCheck function by checking if we have our UpdatedCollider:"}]},{"code":"bool USimpleMovementComponent::CheckForGround(FHitResult\u0026 OutHit) const\n{\n  if (!UpdatedCollider)\n  {\n    return false;\n  }","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"Next we setup some constants and calculate our start and end sweep location:"}]},{"code":"constexpr static float ZOffset = 5.0f;\nconst FVector Offset = FVector::UpVector * ZOffset;\nconst FVector ColliderLocation = UpdatedCollider-\u003eGetComponentLocation();\nconst FVector StartLocation = ColliderLocation;\nconst FVector EndLocation = ColliderLocation - Offset;","type":"code","language":"cpp"},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","marks":["code"],"value":"constexpr static"},{"type":"span","value":" is just an optimization for a purely constant value, but you can also make this a regular "},{"type":"span","marks":["code"],"value":"UPROPERTY"},{"type":"span","value":" if you intend to tweak it a lot."}]}]},{"type":"paragraph","children":[{"type":"span","value":"Next, we setup our sweep configuration. We need four things:"}]},{"type":"list","style":"bulleted","children":[{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"FCollisionQueryParams which we use to make sure we don't self-collide"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"FCollisionResponseParams which controls a few extra flags, that we copy directly from our collider"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"FCollisionShape with the correct capsule shape, which we just grab from our collider as well"}]}]},{"type":"listItem","children":[{"type":"paragraph","children":[{"type":"span","value":"ECollisionChannel value that tells what to collide against, also provided by the collider"}]}]}]},{"code":"FCollisionQueryParams SweepParams;\nSweepParams.AddIgnoredActor(UpdatedCollider-\u003eGetOwner());\n\nFCollisionResponseParams ResponseParams;\nUpdatedCollider-\u003eInitSweepCollisionParams(SweepParams, ResponseParams);\n\nFCollisionShape SweepShape = UpdatedCollider-\u003eGetCollisionShape();\nconst ECollisionChannel CollisionChannel = UpdatedCollider-\u003eGetCollisionObjectType();","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"Finally we perform the sweep using the world object, and return if we hit or not:"}]},{"code":"bool bDidHit = GetWorld()-\u003eSweepSingleByChannel(\n  OutHit, StartLocation, EndLocation, FQuat::Identity, CollisionChannel, SweepShape, SweepParams,\n  ResponseParams);\n\nreturn bDidHit;","type":"code","language":"cpp"},{"type":"heading","level":1,"children":[{"type":"span","value":"State: Walking"}]},{"type":"paragraph","children":[{"type":"span","value":"Our walking function is quite simply now since we've refactored a lot of the code into functions. It is about the same as our previous code, with the addition of changing state to Falling when we aren't grounded anymore:"}]},{"code":"void USimpleMovementComponent::DoMovement_Walking(const float DeltaTime)\n{\n  const FVector InputVector = ConsumeInputVector();\n  const FVector HorizontalMovement = GetDesiredInputMovement(InputVector);\n  Velocity += HorizontalMovement;\n\n  FHitResult Hit;\n  Move(Hit, DeltaTime);\n\n  const bool bIsGrounded = CheckForGround(Hit);\n  \n  if (!bIsGrounded)\n  {\n    MovementState = Falling;\n  }\n}","type":"code","language":"cpp"},{"type":"heading","level":1,"children":[{"type":"span","value":"State: Falling"}]},{"type":"paragraph","children":[{"type":"span","value":"Our Falling function is similar to our Walking function with the additional code for apply gravity and state change. If you go back to the diagram you'll also see that we need to handle hitting the ceiling, otherwise some interesting oddities will happen."}]},{"type":"paragraph","children":[{"type":"span","value":"To check for ceiling we first check if we hit something, and we're moving upwards ("},{"type":"span","marks":["code"],"value":"Velocity.Z \u003e 0"},{"type":"span","value":"), then grab the dot product of the impact normal and check the angle to see if we hit a flat ceiling, and stop if we do."}]},{"type":"paragraph","children":[{"type":"span","value":"If you're unfamiliar with the concepts, the impact normal is a vector that points straight out from the surface we hit, the dot product is a value that tells how close two vectors (like our normal and straight down) are rotation-wise, and to get the angle (in radians) we get the arc-cosine of the value."}]},{"code":"void USimpleMovementComponent::DoMovement_Falling(const float DeltaTime)\n{\n  const FVector InputVector = ConsumeInputVector();\n  const FVector HorizontalMovement = GetDesiredInputMovement(InputVector);\n\n  // Apply gravity\n  const float GravityForce = GetGravityZ();\n  const FVector VerticalMovement = FVector::UpVector * GravityForce * DeltaTime;\n  const float TerminalVelocity = GetPhysicsVolume()-\u003eTerminalVelocity;\n\n  Velocity += HorizontalMovement + VerticalMovement;\n  Velocity.Z = FMath::Max(Velocity.Z, -TerminalVelocity);\n\n  FHitResult Hit;\n  bool bDidHit = Move(Hit, DeltaTime);\n\n  // Check if we hit ceiling\n  if (bDidHit \u0026\u0026 Velocity.Z \u003e 0)\n  {\n    const float Dot = Hit.ImpactNormal.Dot(-FVector::UpVector);\n    const float Angle = FMath::Acos(Dot);\n    const float StopAngleInRadians = FMath::DegreesToRadians(MaxCeilingStopAngle);\n    if (Angle \u003c= StopAngleInRadians)\n    {\n      Velocity.Z = 0;\n    }\n  }\n\n  const bool bIsGrounded = CheckForGround(Hit);\n  if (bIsGrounded \u0026\u0026 Velocity.Z \u003c= 0)\n  {\n    MovementState = Walking;\n    Velocity.Z = 0;\n  }\n}","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"For the ceiling check I've extracted the angle into a "},{"type":"span","marks":["code"],"value":"UPROPERTY"},{"type":"span","value":" value called "},{"type":"span","marks":["code"],"value":"MaxCeilingStopAngle"},{"type":"span","value":" and set its default to 5.0f, so we hit a ceiling the angle of the hit is within 5 degrees of straight up."}]},{"type":"paragraph","children":[{"type":"span","value":"For our state change we also check that we're moving downwards so we don't accidentally snap when for example jumping over something."}]},{"type":"heading","level":1,"children":[{"type":"span","value":"Jumping!"}]},{"type":"paragraph","children":[{"type":"span","value":"And that leads us (finally!) to jumping. As with any action we need to setup the input. "}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Input"}]},{"type":"paragraph","children":[{"type":"span","value":"In our "},{"type":"span","marks":["code"],"value":"CactusPlayerPawn"},{"type":"span","value":" (or your equivalent) we add an input action (next the other input actions):"}]},{"code":"UPROPERTY(EditDefaultsOnly, Category=\"Input\")\nUInputAction* JumpAction;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And a function declaration (below our other input functions):"}]},{"code":"void OnInput_Jump();","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"For our implementation the input binding is the same as the others (in "},{"type":"span","marks":["code"],"value":"SetupPlayerInputComponent"},{"type":"span","value":"):"}]},{"code":"PlayerEnhancedInputComponent-\u003eBindAction(JumpAction, ETriggerEvent::Triggered, this,\n                                         \u0026ACactusPlayerPawn::OnInput_Jump);","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And the jump function will just trigger the jump on our movement component, which we'll setup soon:"}]},{"code":"void ACactusPlayerPawn::OnInput_Jump()\n{\n  MovementComponent-\u003eJump();\n}","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"For the input action, since jump is always a \"press\" and not a \"hold\" like the other inputs, we also add a trigger with \"Pressed\" to it:"}]},{"item":"55485512","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"We add the action to our input mapping context and set our desired input keys:"}]},{"item":"55485513","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"Don't forget to set the input action reference in our Pawn BP!"}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Movement Code"}]},{"type":"paragraph","children":[{"type":"span","value":"The movement component header needs two things: a jump force variable, and a jump function (both "},{"type":"span","marks":["code"],"value":"public"},{"type":"span","value":"):"}]},{"code":"public:\n\n  ...\n\n  UPROPERTY(EditAnywhere, Category=\"Movement\")\n  float JumpForce;\n\n  ...\n\n  void Jump();","type":"code","language":"cpp"},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","value":"I've set the default value of "},{"type":"span","marks":["code"],"value":"JumpForce"},{"type":"span","value":" in the constructor to 420.0f as a homage to the same default in the built-in character movement component."}]}]},{"type":"paragraph","children":[{"type":"span","value":"And finally finally, the implementation of the jump function we're we simply check if we're Walking, add our jump force, and move to Falling:"}]},{"code":"void USimpleMovementComponent::Jump()\n{\n  if (MovementState == Walking)\n  {\n    Velocity.Z += JumpForce;\n    MovementState = Falling;\n  }\n}","type":"code","language":"cpp"},{"type":"heading","level":1,"children":[{"type":"span","value":"Results"}]},{"type":"paragraph","children":[{"type":"span","value":"All that refactoring for our 5 lines worth of jump code gives us the ability to jump!"}]},{"item":"55485514","type":"block"},{"type":"heading","level":2,"children":[{"type":"span","value":"Ceiling"}]},{"type":"paragraph","children":[{"type":"span","value":"We should also stop when we hit a flat-ish ceiling, but slide along any angled ceilings:"}]},{"item":"55485520","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"Interestingly, because of how "},{"type":"span","marks":["code"],"value":"SlideAlongSurface"},{"type":"span","value":" works, we also slightly brake (proportional to the normal) when we hit a slope, giving us somewhat natural physics:"}]},{"item":"55485521","type":"block"}]}},"blocks":[{"__typename":"ImageRecord","id":"55480729","image":{"responsiveImage":{"base64":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgLChULFg4OFRUNDh0TFgUMFxUZGBYVIhUiKzcvGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0NFQ8NHDscFh0vLy8vLy87Oy8vLy8vLy8vLy8vLy87Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAAcAGAMBIgACEQEDEQH/xAAXAAEAAwAAAAAAAAAAAAAAAAAAAgMH/8QAHBAAAgICAwAAAAAAAAAAAAAAAAMBAgVCBDFB/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAwDAQACEQMRAD8A19nKWuPZK65BdtZABUW5Ki+qgAJX/9k=","srcSet":"https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026dpr=0.25\u0026max-w=600 505w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026dpr=0.5\u0026max-w=600 1010w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026dpr=0.75\u0026max-w=600 1515w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026max-w=600 2021w","webpSrcSet":"https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026dpr=0.25\u0026fm=webp\u0026max-w=600 505w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026dpr=0.5\u0026fm=webp\u0026max-w=600 1010w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026dpr=0.75\u0026fm=webp\u0026max-w=600 1515w,https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026fm=webp\u0026max-w=600 2021w","sizes":"(max-width: 2021px) 100vw, 2021px","src":"https://www.datocms-assets.com/77616/1662824665-fpmfs-pt5-jump-state-machine.png?auto=format\u0026max-w=600","alt":null,"title":null,"width":2021,"height":511,"aspectRatio":3.954990215264188}}},{"__typename":"ImageRecord","id":"55485512","image":{"responsiveImage":{"base64":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBw0SBhMLDQgIBwcNDg4QBwcGBxEJDQgYFx8ZGBYVFhUaHysjGh0oHSEiJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0OFQ0NFS8cFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABUAGAMBIgACEQEDEQH/xAAaAAADAAMBAAAAAAAAAAAAAAAAAwQCBQYB/8QAHBABAAIBBQAAAAAAAAAAAAAAAAIDIQERIjEy/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDir5cWts9K7Z4S7ZSLloGU3iCqfRQCJdgAIf/Z","srcSet":"https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026dpr=0.25\u0026max-w=600 117w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026dpr=0.5\u0026max-w=600 234w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026dpr=0.75\u0026max-w=600 351w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026max-w=600 469w","webpSrcSet":"https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026dpr=0.25\u0026fm=webp\u0026max-w=600 117w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026dpr=0.5\u0026fm=webp\u0026max-w=600 234w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026dpr=0.75\u0026fm=webp\u0026max-w=600 351w,https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026fm=webp\u0026max-w=600 469w","sizes":"(max-width: 469px) 100vw, 469px","src":"https://www.datocms-assets.com/77616/1663007819-fpmfs-pt5-input-action-jump.png?auto=format\u0026max-w=600","alt":null,"title":null,"width":469,"height":410,"aspectRatio":1.1439024390243901}}},{"__typename":"ImageRecord","id":"55485513","image":{"responsiveImage":{"base64":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBxAHBhUNCAgNDQcNDg8OBQgNDhYNDQcNFxUZGCIVFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDg0NEA0NEC8cFh0vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIABgAFQMBIgACEQEDEQH/xAAZAAEBAAMBAAAAAAAAAAAAAAAABAMFBgH/xAAcEAEAAQUBAQAAAAAAAAAAAAAAAQIDERIhEwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAMAwEAAhEDEQA/AOI+qdqWv8+rbk5hjwQQ12s1CyaegM13kJt+vQDYAH//2Q==","srcSet":"https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026dpr=0.25\u0026max-w=600 134w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026dpr=0.5\u0026max-w=600 269w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026dpr=0.75\u0026max-w=600 403w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026max-w=600 538w","webpSrcSet":"https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026dpr=0.25\u0026fm=webp\u0026max-w=600 134w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026dpr=0.5\u0026fm=webp\u0026max-w=600 269w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026dpr=0.75\u0026fm=webp\u0026max-w=600 403w,https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026fm=webp\u0026max-w=600 538w","sizes":"(max-width: 538px) 100vw, 538px","src":"https://www.datocms-assets.com/77616/1663007966-fpmfs-pt5-input-mapping.png?auto=format\u0026max-w=600","alt":null,"title":null,"width":538,"height":606,"aspectRatio":0.8877887788778878}}},{"__typename":"WebmRecord","id":"55485514","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"D23CM900J0202jh00J6V7oUryb3QmqwcrUId"}}},{"__typename":"WebmRecord","id":"55485520","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"2Hg8OL2dD7KbspthYWTOpg2BePKT9YVJ"}}},{"__typename":"WebmRecord","id":"55485521","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"qiuE02FCeyAwDLT01nP1HU9TK96QNNSxG6"}}}]}},"isPreview":false},"__N_SSG":true},"page":"/tutorial/[slug]","query":{"slug":"character-movement-from-scratch-pt-5-jumping"},"buildId":"FdMC6e8Jf18CHKkiz_cXU","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>