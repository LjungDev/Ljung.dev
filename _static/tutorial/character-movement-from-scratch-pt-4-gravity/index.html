<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Ljung | Character Movement from Scratch pt 4: Gravity</title><meta name="description" content="In this part we will implement gravity!"/><meta name="next-head-count" content="4"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/14da082a368919fc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/14da082a368919fc.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-9b5d6ec4444c80fa.js" defer=""></script><script src="/_next/static/chunks/main-7c70317c243a4143.js" defer=""></script><script src="/_next/static/chunks/pages/_app-301819447092fb27.js" defer=""></script><script src="/_next/static/chunks/ddc9e94f-4c7cb313852dfa1e.js" defer=""></script><script src="/_next/static/chunks/247-2427dfe63c188f3b.js" defer=""></script><script src="/_next/static/chunks/13-1bb7831376086322.js" defer=""></script><script src="/_next/static/chunks/pages/tutorial/%5Bslug%5D-22eeb0a3910b85b8.js" defer=""></script><script src="/_next/static/FdMC6e8Jf18CHKkiz_cXU/_buildManifest.js" defer=""></script><script src="/_next/static/FdMC6e8Jf18CHKkiz_cXU/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Baloo+2&family=Fira+Code&family=Open+Sans:wght@300;400;700&display=swap">@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazaps.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sFVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpp_lGP6HcMqzQCjA.woff) format('woff');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpn_lGP6HcMqzQCjA.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpm_lGP6HcMqzQCjA.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Baloo 2';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/baloo2/v14/wXK0E3kTposypRydzVT08TS3JnAmtdgazZpo_lGP6HcMqzQ.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJV37MOzlojwUKaJO.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVT7MOzlojwUKaJO.woff) format('woff');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVz7MOzlojwUKaJO.woff) format('woff');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVP7MOzlojwUKaJO.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJV77MOzlojwUKaJO.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVD7MOzlojwUKQ.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8H57QK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="flex flex-col min-h-screen"><div class="flex flex-col items-center grow pt-12 bg-snow-storm-2 dark:bg-polar-night-0"><div class="flex items-center gap-2"><div class="flex items-center gap-2 hover:cursor-pointer hover:opacity-75"><div class="relative w-14 h-24"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="Logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:contain"/><noscript><img alt="Logo" src="/logo.svg" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:contain" loading="lazy"/></noscript></span></div><div class=" flex flex-col items-center gap-1"><div class="relative"><h1 class="text-6xl font-display text-polar-night-0 dark:text-snow-storm-2">Ljung</h1><span class="absolute right-0 bottom-0.5 w-0"><span class="text-base font-display opacity-50 text-polar-night-0 dark:text-snow-storm-2"></span></span></div></div><span class="text-base font-display opacity-50 text-polar-night-0 dark:text-snow-storm-2">.dev</span></div><div class="flex gap-1 items-center font-body text-base"><a class="font-bold text-polar-night-0 dark:text-snow-storm-2" href="/tutorials/">Tutorials</a></div></div><div class="max-w-xl w-full flex flex-col gap-12 items-center mb-12"><div class="h-[1px] w-full opacity-10 bg-polar-night-0 dark:bg-snow-storm-2"></div><div class="flex flex-col gap-5 max-w-[min(100%,512px)] m-3 p-3 text-polar-night-0 dark:text-snow-storm-2 text-base font-body"><div class="flex"><div class="grow text-left"><a class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="/tutorial/character-movement-from-scratch-pt-3-collision/">« <!-- -->pt 3: Collision</a></div><div class="grow text-right"><a class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="/tutorial/character-movement-from-scratch-pt-5-jumping/">pt 5: Jumping<!-- --> »</a></div></div><div><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false">A project using this tutorial series is <a target="_blank" class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="https://github.com/LjungDev/Cactus">tracked on GitHub</a>. The revision after this part is <a target="_blank" class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="https://github.com/LjungDev/Cactus/commit/cacd857bfdc6c25f077d0e29ac80b73a7f53045a">cacd857</a>.</p></blockquote><p class="py-2 false">Hej!</p><p class="py-2 false">In this part of the the tutorial series we will look at implementing gravity, and at the end we will have a our character move down slopes and fall down from edges!</p><p class="py-2 false">Gravity is actually quite simple. It is simply a constant force being applied &quot;downwards&quot;. For Unreal this is negative Z, but it can be anything you want (for example making a game with planets and their own gravity!).</p><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false">Disclaimer: I&#x27;m not that good at physics so things might not be physically accurate...but they don&#x27;t have to be! The nice thing about games is that it only have to <em>seem</em> realistic (or not). With that said, we&#x27;ll try to make use of forces, velocity, acceleration etc. so that it hopefully makes sense.</p><p class="py-2 false">Also, for this tutorial we won&#x27;t bother with drag (air resistance) or anything else besides the basics.</p></blockquote><p class="py-2 false">First, since we&#x27;re introducing an entirely new force unrelated to our input, we should rename our horizontal movement input for clarity and move the velocity update to the move section:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#636f88">/** SimpleMovementComponent::TickComponent */</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span></span><span class="token" style="color:#636f88">// Calculate input force</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector</span><span class="token" style="color:#81A1C1">&amp;</span><span> Input </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">ConsumeInputVector</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">GetClampedToMaxSize2D</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#B48EAD">1.0f</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector HorizontalMovement </span><span class="token" style="color:#81A1C1">=</span><span> Input </span><span class="token" style="color:#81A1C1">*</span><span> MoveSpeed</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span><span></span><span class="token" style="color:#636f88">// Move</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FRotator</span><span class="token" style="color:#81A1C1">&amp;</span><span> Rotation </span><span class="token" style="color:#81A1C1">=</span><span> UpdatedComponent</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetComponentRotation</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">11</span><span>Velocity </span><span class="token" style="color:#81A1C1">+=</span><span> HorizontalMovement</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">13</span><span></span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span></code></pre></div><p class="py-2 false">The effect is the same but now we have a bit cleaner structure to work with.</p><h1 class="font-display text-4xl pt-6">Applying Gravity</h1><p class="py-2 false">From the movement component, gravity can be fetched by calling <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">GetGravityZ()</code>. This is a nice helper that grabs the current gravity. This can be overridden per world but by default it uses the global gravity value set in Project Settings -&gt; Engine -&gt; Physics, which by default is <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">-980.0</code>. Notice that it is already nicely expressed as a negative value, so we can multiply it with <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">FVector::UpVector</code> directly to get a downwards force.</p><blockquote class="bg-snow-storm-0 dark:bg-polar-night-1 border-l-4 border-l-polar-night-0 dark:border-l-snow-storm-0 px-4 py-2 my-2"><p class="py-2 false">Note: -980.0 is the same as Earths average gravitational acceleration expressed in Unreal units, equal to 9.8m/s^2.</p></blockquote><p class="py-2 false">Let&#x27;s add a section just before the move step where we calculate our vertical movement:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#636f88">// Apply gravity</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> GravityForce </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetGravityZ</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector VerticalMovement </span><span class="token" style="color:#81A1C1">=</span><span> FVector</span><span class="token double-colon" style="color:#81A1C1">::</span><span>UpVector </span><span class="token" style="color:#81A1C1">*</span><span> GravityForce</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">And add it to our velocity in our move step:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span>Velocity </span><span class="token" style="color:#81A1C1">+=</span><span> HorizontalMovement </span><span class="token" style="color:#81A1C1">+</span><span> VerticalMovement</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">We also need to reset our Z velocity whenever we hit ground, otherwise it will constantly accumulate and cause lots of trouble, so set it to 0 within our hit check:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">IsValidBlockingHit</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span>  Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span>  
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>  </span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span></span><span class="token" style="color:#81A1C1">}</span></code></pre></div><p class="py-2 false">Now let&#x27;s try it:</p><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video><p class="py-2 false">Ok, this kind of works...but we&#x27;re falling way too fast. The reason? Well we&#x27;ve actually been cheating/simplifying how (horizontal) movement is implemented. </p><p class="py-2 false">Both horizontal and vertical movement are represented by variables that correspond to cm/s we want to move. The difference is that gravity actually accumulates! In real life things don&#x27;t immediately start falling at max speed. They <em>accelerate</em>.</p><p class="py-2 false">Realizing this and analyzing the code we can actually see that we&#x27;re adding the speed of 9.8m/s <em>every tick</em>. Instead we want to accumulate so that we roughly equal a speed of 9.8m/s <em>after 1 second</em> (that is, 9.8m/s/s). The reason it&#x27;s different with horizontal movement is that we&#x27;re resetting XY velocity each frame (in thie </p><p class="py-2 false">Luckily once we figure this out the fix is very simple; we just need to multiple our gravity force by <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">DeltaTime</code> one extra time:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> GravityForce </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetGravityZ</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span> </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span></span><span class="token" style="color:#81A1C1">const</span><span> FVector VerticalMovement </span><span class="token" style="color:#81A1C1">=</span><span> FVector</span><span class="token double-colon" style="color:#81A1C1">::</span><span>UpVector </span><span class="token" style="color:#81A1C1">*</span><span> GravityForce </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">We should now fall at a much more acceptable rate:</p><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video><p class="py-2 false">If you find this too slow or too fast you can always add an extra multiplier to <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">GravityForce</code> and tweak it to your liking.</p><h2 class="font-display text-3xl pt-5">Terminal Velocity</h2><p class="py-2 false">An optional but recommended step is to also factor in terminal velocity. This means that we won&#x27;t accumulate speed indefinitely and instead clamp our falling speed. To do that we simply grab our current physics volume and use its <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">TerminalVelocity</code>. In case we&#x27;re not in any specific physics volume it falls back to the global value set in Project Settings -&gt; Engine -&gt; Physics which by default is <code class="px-1 rounded-sm bg-snow-storm-0 dark:bg-polar-night-2">4000.0</code>. We can then clamp our velocity Z (after applying our movement):</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> TerminalVelocity </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetPhysicsVolume</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">-&gt;</span><span>TerminalVelocity </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#81A1C1">.</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span><span>Velocity </span><span class="token" style="color:#81A1C1">+=</span><span> HorizontalMovement </span><span class="token" style="color:#81A1C1">+</span><span> VerticalMovement</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">FMath</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">Max</span><span class="token" style="color:#81A1C1">(</span><span>Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">-</span><span>TerminalVelocity</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span></code></pre></div><p class="py-2 false">We also need to include the physics volume header at the top:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token macro directive-hash" style="color:#81A1C1">#</span><span class="token macro directive" style="color:#81A1C1">include</span><span class="token macro" style="color:#81A1C1"> </span><span class="token macro" style="color:#A3BE8C">&quot;SimpleMovementComponent.h&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token macro directive-hash" style="color:#81A1C1">#</span><span class="token macro directive" style="color:#81A1C1">include</span><span class="token macro" style="color:#81A1C1"> </span><span class="token macro" style="color:#A3BE8C">&quot;GameFramework/PhysicsVolume.h&quot;</span></code></pre></div><h1 class="font-display text-4xl pt-6">Results</h1><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video><p class="py-2 false">(I&#x27;ve added an on screen debug message to help visualize)</p><p class="py-2 false">And, as an added bonus, we can now also walk down slopes (albeit a bit choppy - we will fix that later on!):</p><video style="height:100%;max-width:100%" metadata="[object Object]" controls="" muted="" loop=""></video><p class="py-2 false">Our final tick function now looks like this:</p><div class="border-snow-storm-0 dark:border-polar-night-1 border-2 rounded flex flex-col gap-1 my-2"><span class="text-polar-night-3 mx-2">cpp</span><pre style="color:#f8f8f2;background:#2E3440;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0"><code class="language-cpp" style="color:#f8f8f2;background:none;font-family:&quot;Fira Code&quot;, Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">1</span><span class="token" style="color:#81A1C1">void</span><span> </span><span class="token" style="color:#88C0D0">USimpleMovementComponent</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">TickComponent</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">float</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">,</span><span> ELevelTick TickType</span><span class="token" style="color:#81A1C1">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">2</span><span>                                             FActorComponentTickFunction</span><span class="token" style="color:#81A1C1">*</span><span> ThisTickFunction</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">3</span><span></span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">4</span><span>  </span><span class="token" style="color:#88C0D0">Super</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">TickComponent</span><span class="token" style="color:#81A1C1">(</span><span>DeltaTime</span><span class="token" style="color:#81A1C1">,</span><span> TickType</span><span class="token" style="color:#81A1C1">,</span><span> ThisTickFunction</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">6</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#88C0D0">ShouldSkipUpdate</span><span class="token" style="color:#81A1C1">(</span><span>DeltaTime</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">7</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">8</span><span>    </span><span class="token" style="color:#81A1C1">return</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">9</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">11</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">!</span><span>PawnOwner </span><span class="token" style="color:#81A1C1">||</span><span> </span><span class="token" style="color:#81A1C1">!</span><span>UpdatedComponent</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">12</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">13</span><span>    </span><span class="token" style="color:#81A1C1">return</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">14</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">15</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">16</span><span>  </span><span class="token" style="color:#636f88">// Reset velocity</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">17</span><span>  Velocity</span><span class="token" style="color:#81A1C1">.</span><span>X </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">18</span><span>  Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Y </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">19</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">20</span><span>  </span><span class="token" style="color:#636f88">// Calculate force</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">21</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector</span><span class="token" style="color:#81A1C1">&amp;</span><span> Input </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">ConsumeInputVector</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">GetClampedToMaxSize2D</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#B48EAD">1.0f</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">22</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector HorizontalMovement </span><span class="token" style="color:#81A1C1">=</span><span> Input </span><span class="token" style="color:#81A1C1">*</span><span> MoveSpeed</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">23</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">24</span><span>  </span><span class="token" style="color:#636f88">// Apply gravity</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">25</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> GravityForce </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetGravityZ</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">26</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector VerticalMovement </span><span class="token" style="color:#81A1C1">=</span><span> FVector</span><span class="token double-colon" style="color:#81A1C1">::</span><span>UpVector </span><span class="token" style="color:#81A1C1">*</span><span> GravityForce </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">27</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">28</span><span>  </span><span class="token" style="color:#636f88">// Move</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">29</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FRotator</span><span class="token" style="color:#81A1C1">&amp;</span><span> Rotation </span><span class="token" style="color:#81A1C1">=</span><span> UpdatedComponent</span><span class="token" style="color:#81A1C1">-&gt;</span><span class="token" style="color:#88C0D0">GetComponentRotation</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">30</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> </span><span class="token" style="color:#81A1C1">float</span><span> TerminalVelocity </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">GetPhysicsVolume</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">-&gt;</span><span>TerminalVelocity</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">31</span><span>  Velocity </span><span class="token" style="color:#81A1C1">+=</span><span> HorizontalMovement </span><span class="token" style="color:#81A1C1">+</span><span> VerticalMovement</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">32</span><span>  Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#88C0D0">FMath</span><span class="token double-colon" style="color:#81A1C1">::</span><span class="token" style="color:#88C0D0">Max</span><span class="token" style="color:#81A1C1">(</span><span>Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">-</span><span>TerminalVelocity</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">33</span><span>  </span><span class="token" style="color:#81A1C1">const</span><span> FVector MovementDelta </span><span class="token" style="color:#81A1C1">=</span><span> Velocity </span><span class="token" style="color:#81A1C1">*</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">34</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">35</span><span>  FHitResult Hit</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">36</span><span>  </span><span class="token" style="color:#88C0D0">SafeMoveUpdatedComponent</span><span class="token" style="color:#81A1C1">(</span><span>MovementDelta</span><span class="token" style="color:#81A1C1">,</span><span> Rotation</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">true</span><span class="token" style="color:#81A1C1">,</span><span> Hit</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">37</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">38</span><span>  </span><span class="token" style="color:#81A1C1">if</span><span> </span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">.</span><span class="token" style="color:#88C0D0">IsValidBlockingHit</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">39</span><span>  </span><span class="token" style="color:#81A1C1">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">40</span><span>    Velocity</span><span class="token" style="color:#81A1C1">.</span><span>Z </span><span class="token" style="color:#81A1C1">=</span><span> </span><span class="token" style="color:#B48EAD">0</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">41</span><span>    </span><span class="token" style="color:#88C0D0">HandleImpact</span><span class="token" style="color:#81A1C1">(</span><span>Hit</span><span class="token" style="color:#81A1C1">,</span><span> DeltaTime</span><span class="token" style="color:#81A1C1">,</span><span> MovementDelta</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">42</span><span>    </span><span class="token" style="color:#88C0D0">SlideAlongSurface</span><span class="token" style="color:#81A1C1">(</span><span>MovementDelta</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#B48EAD">1.0f</span><span> </span><span class="token" style="color:#81A1C1">-</span><span> Hit</span><span class="token" style="color:#81A1C1">.</span><span>Time</span><span class="token" style="color:#81A1C1">,</span><span> Hit</span><span class="token" style="color:#81A1C1">.</span><span>Normal</span><span class="token" style="color:#81A1C1">,</span><span> Hit</span><span class="token" style="color:#81A1C1">,</span><span> </span><span class="token" style="color:#81A1C1">true</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">43</span><span>  </span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">44</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">45</span><span>  </span><span class="token" style="color:#88C0D0">UpdateComponentVelocity</span><span class="token" style="color:#81A1C1">(</span><span class="token" style="color:#81A1C1">)</span><span class="token" style="color:#81A1C1">;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">46</span><span></span><span class="token" style="color:#81A1C1">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#636f88">47</span></code></pre></div><p class="py-2 false">And that&#x27;s it! Next up we will look at a more active application of gravity: jumping! 🪂</p></div><div class="flex"><div class="grow text-left"><a class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="/tutorial/character-movement-from-scratch-pt-3-collision/">« <!-- -->pt 3: Collision</a></div><div class="grow text-right"><a class="text-frost-3 dark:text-frost-1 hover:opacity-50 active:opacity-75" href="/tutorial/character-movement-from-scratch-pt-5-jumping/">pt 5: Jumping<!-- --> »</a></div></div></div><div class="h-[1px] w-full opacity-10 bg-polar-night-0 dark:bg-snow-storm-2"></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"siteMetainfo":{"headerTitle":"Ljung","headerSubtitle":".dev","pageTitlePrefix":"Ljung | "},"_site":{"globalSeo":{"siteName":"Ljung","fallbackSeo":{"title":"Ljung | Game Dev","description":"Indie Game Developer from Sweden 🎮"}}},"post":{"title":"Character Movement from Scratch pt 4: Gravity","description":"In this part we will implement gravity!","seriesPrevious":{"slug":"character-movement-from-scratch-pt-3-collision","seriesTitle":"pt 3: Collision"},"seriesNext":{"slug":"character-movement-from-scratch-pt-5-jumping","seriesTitle":"pt 5: Jumping"},"content":{"value":{"schema":"dast","document":{"type":"root","children":[{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","value":"A project using this tutorial series is "},{"url":"https://github.com/LjungDev/Cactus","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"tracked on GitHub"}]},{"type":"span","value":". The revision after this part is "},{"url":"https://github.com/LjungDev/Cactus/commit/cacd857bfdc6c25f077d0e29ac80b73a7f53045a","meta":[{"id":"target","value":"_blank"}],"type":"link","children":[{"type":"span","value":"cacd857"}]},{"type":"span","value":"."}]}]},{"type":"paragraph","children":[{"type":"span","value":"Hej!"}]},{"type":"paragraph","children":[{"type":"span","value":"In this part of the the tutorial series we will look at implementing gravity, and at the end we will have a our character move down slopes and fall down from edges!"}]},{"type":"paragraph","children":[{"type":"span","value":"Gravity is actually quite simple. It is simply a constant force being applied \"downwards\". For Unreal this is negative Z, but it can be anything you want (for example making a game with planets and their own gravity!)."}]},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","value":"Disclaimer: I'm not that good at physics so things might not be physically accurate...but they don't have to be! The nice thing about games is that it only have to "},{"type":"span","marks":["emphasis"],"value":"seem"},{"type":"span","value":" realistic (or not). With that said, we'll try to make use of forces, velocity, acceleration etc. so that it hopefully makes sense."}]},{"type":"paragraph","children":[{"type":"span","value":"Also, for this tutorial we won't bother with drag (air resistance) or anything else besides the basics."}]}]},{"type":"paragraph","children":[{"type":"span","value":"First, since we're introducing an entirely new force unrelated to our input, we should rename our horizontal movement input for clarity and move the velocity update to the move section:"}]},{"code":"/** SimpleMovementComponent::TickComponent */\n\n...\n\n// Calculate input force\nconst FVector\u0026 Input = ConsumeInputVector().GetClampedToMaxSize2D(1.0f);\nconst FVector HorizontalMovement = Input * MoveSpeed;\n\n// Move\nconst FRotator\u0026 Rotation = UpdatedComponent-\u003eGetComponentRotation();\nVelocity += HorizontalMovement;\n\n...","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"The effect is the same but now we have a bit cleaner structure to work with."}]},{"type":"heading","level":1,"children":[{"type":"span","value":"Applying Gravity"}]},{"type":"paragraph","children":[{"type":"span","value":"From the movement component, gravity can be fetched by calling "},{"type":"span","marks":["code"],"value":"GetGravityZ()"},{"type":"span","value":". This is a nice helper that grabs the current gravity. This can be overridden per world but by default it uses the global gravity value set in Project Settings -\u003e Engine -\u003e Physics, which by default is "},{"type":"span","marks":["code"],"value":"-980.0"},{"type":"span","value":". Notice that it is already nicely expressed as a negative value, so we can multiply it with "},{"type":"span","marks":["code"],"value":"FVector::UpVector"},{"type":"span","value":" directly to get a downwards force."}]},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"span","value":"Note: -980.0 is the same as Earths average gravitational acceleration expressed in Unreal units, equal to 9.8m/s^2."}]}]},{"type":"paragraph","children":[{"type":"span","value":"Let's add a section just before the move step where we calculate our vertical movement:"}]},{"code":"// Apply gravity\nconst float GravityForce = GetGravityZ();\nconst FVector VerticalMovement = FVector::UpVector * GravityForce;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And add it to our velocity in our move step:"}]},{"code":"Velocity += HorizontalMovement + VerticalMovement;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"We also need to reset our Z velocity whenever we hit ground, otherwise it will constantly accumulate and cause lots of trouble, so set it to 0 within our hit check:"}]},{"code":"if (Hit.IsValidBlockingHit())\n{\n  Velocity.Z = 0;\n  \n  ...\n}","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"Now let's try it:"}]},{"item":"55445411","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"Ok, this kind of works...but we're falling way too fast. The reason? Well we've actually been cheating/simplifying how (horizontal) movement is implemented. "}]},{"type":"paragraph","children":[{"type":"span","value":"Both horizontal and vertical movement are represented by variables that correspond to cm/s we want to move. The difference is that gravity actually accumulates! In real life things don't immediately start falling at max speed. They "},{"type":"span","marks":["emphasis"],"value":"accelerate"},{"type":"span","value":"."}]},{"type":"paragraph","children":[{"type":"span","value":"Realizing this and analyzing the code we can actually see that we're adding the speed of 9.8m/s "},{"type":"span","marks":["emphasis"],"value":"every tick"},{"type":"span","value":". Instead we want to accumulate so that we roughly equal a speed of 9.8m/s "},{"type":"span","marks":["emphasis"],"value":"after 1 second"},{"type":"span","value":" (that is, 9.8m/s/s). The reason it's different with horizontal movement is that we're resetting XY velocity each frame (in thie "}]},{"type":"paragraph","children":[{"type":"span","value":"Luckily once we figure this out the fix is very simple; we just need to multiple our gravity force by "},{"type":"span","marks":["code"],"value":"DeltaTime"},{"type":"span","value":" one extra time:"}]},{"code":"const float GravityForce = GetGravityZ() * DeltaTime;\nconst FVector VerticalMovement = FVector::UpVector * GravityForce * DeltaTime;","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"We should now fall at a much more acceptable rate:"}]},{"item":"55445412","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"If you find this too slow or too fast you can always add an extra multiplier to "},{"type":"span","marks":["code"],"value":"GravityForce"},{"type":"span","value":" and tweak it to your liking."}]},{"type":"heading","level":2,"children":[{"type":"span","value":"Terminal Velocity"}]},{"type":"paragraph","children":[{"type":"span","value":"An optional but recommended step is to also factor in terminal velocity. This means that we won't accumulate speed indefinitely and instead clamp our falling speed. To do that we simply grab our current physics volume and use its "},{"type":"span","marks":["code"],"value":"TerminalVelocity"},{"type":"span","value":". In case we're not in any specific physics volume it falls back to the global value set in Project Settings -\u003e Engine -\u003e Physics which by default is "},{"type":"span","marks":["code"],"value":"4000.0"},{"type":"span","value":". We can then clamp our velocity Z (after applying our movement):"}]},{"code":"const float TerminalVelocity = GetPhysicsVolume()-\u003eTerminalVelocity * DeltaTime;\n\n...\n\nVelocity += HorizontalMovement + VerticalMovement;\nVelocity.Z = FMath::Max(Velocity.Z, -TerminalVelocity);","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"We also need to include the physics volume header at the top:"}]},{"code":"#include \"SimpleMovementComponent.h\"\n\n#include \"GameFramework/PhysicsVolume.h\"","type":"code","language":"cpp"},{"type":"heading","level":1,"children":[{"type":"span","value":"Results"}]},{"item":"55445413","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"(I've added an on screen debug message to help visualize)"}]},{"type":"paragraph","children":[{"type":"span","value":"And, as an added bonus, we can now also walk down slopes (albeit a bit choppy - we will fix that later on!):"}]},{"item":"55445448","type":"block"},{"type":"paragraph","children":[{"type":"span","value":"Our final tick function now looks like this:"}]},{"code":"void USimpleMovementComponent::TickComponent(float DeltaTime, ELevelTick TickType,\n                                             FActorComponentTickFunction* ThisTickFunction)\n{\n  Super::TickComponent(DeltaTime, TickType, ThisTickFunction);\n\n  if (ShouldSkipUpdate(DeltaTime))\n  {\n    return;\n  }\n\n  if (!PawnOwner || !UpdatedComponent)\n  {\n    return;\n  }\n\n  // Reset velocity\n  Velocity.X = 0;\n  Velocity.Y = 0;\n\n  // Calculate force\n  const FVector\u0026 Input = ConsumeInputVector().GetClampedToMaxSize2D(1.0f);\n  const FVector HorizontalMovement = Input * MoveSpeed;\n\n  // Apply gravity\n  const float GravityForce = GetGravityZ();\n  const FVector VerticalMovement = FVector::UpVector * GravityForce * DeltaTime;\n\n  // Move\n  const FRotator\u0026 Rotation = UpdatedComponent-\u003eGetComponentRotation();\n  const float TerminalVelocity = GetPhysicsVolume()-\u003eTerminalVelocity;\n  Velocity += HorizontalMovement + VerticalMovement;\n  Velocity.Z = FMath::Max(Velocity.Z, -TerminalVelocity);\n  const FVector MovementDelta = Velocity * DeltaTime;\n\n  FHitResult Hit;\n  SafeMoveUpdatedComponent(MovementDelta, Rotation, true, Hit);\n\n  if (Hit.IsValidBlockingHit())\n  {\n    Velocity.Z = 0;\n    HandleImpact(Hit, DeltaTime, MovementDelta);\n    SlideAlongSurface(MovementDelta, 1.0f - Hit.Time, Hit.Normal, Hit, true);\n  }\n\n  UpdateComponentVelocity();\n}\n","type":"code","language":"cpp"},{"type":"paragraph","children":[{"type":"span","value":"And that's it! Next up we will look at a more active application of gravity: jumping! 🪂"}]}]}},"blocks":[{"__typename":"WebmRecord","id":"55445411","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"NZqtLbTqI0001QMr3snReeK702l8sKJcStn"}}},{"__typename":"WebmRecord","id":"55445412","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"WDsBJ4BzHdTvO8q5fUuyfmB49DqDaJQ4"}}},{"__typename":"WebmRecord","id":"55445413","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"JfzZ21jKy00Z801DZ02tDVYi6b01GwJ4GxnF"}}},{"__typename":"WebmRecord","id":"55445448","video":{"title":null,"alt":null,"video":{"muxPlaybackId":"wYcfgYG22smLJWIru302U5uK2vtF007Q3F"}}}]}},"isPreview":false},"__N_SSG":true},"page":"/tutorial/[slug]","query":{"slug":"character-movement-from-scratch-pt-4-gravity"},"buildId":"FdMC6e8Jf18CHKkiz_cXU","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>