(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{7631:function(a){"undefined"!=typeof window&&function(b,c){a.exports=c()}(this,function(){return function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b||4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,(function(b){return a[b]}).bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="/dist/",c(c.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(a,b,c){"use strict";var d=Object.prototype.hasOwnProperty,e="~";function f(){}function g(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function h(a,b,c,d,f){if("function"!=typeof c)throw TypeError("The listener must be a function");var h=new g(c,d||a,f),i=e?e+b:b;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],h]:a._events[i].push(h):(a._events[i]=h,a._eventsCount++),a}function i(a,b){0== --a._eventsCount?a._events=new f:delete a._events[b]}function j(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(e=!1)),j.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)d.call(a,b)&&c.push(e?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},j.prototype.listeners=function(a){var b=e?e+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,g=Array(f);d<f;d++)g[d]=c[d].fn;return g},j.prototype.listenerCount=function(a){var b=e?e+a:a,c=this._events[b];return c?c.fn?1:c.length:0},j.prototype.emit=function(a,b,c,d,f,g){var h=e?e+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,f),!0;case 6:return k.fn.call(k.context,b,c,d,f,g),!0}for(j=1,i=Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},j.prototype.on=function(a,b,c){return h(this,a,b,c,!1)},j.prototype.once=function(a,b,c){return h(this,a,b,c,!0)},j.prototype.removeListener=function(a,b,c,d){var f=e?e+a:a;if(!this._events[f])return this;if(!b)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||i(this,f);else{for(var h=0,j=[],k=g.length;h<k;h++)(g[h].fn!==b||d&&!g[h].once||c&&g[h].context!==c)&&j.push(g[h]);j.length?this._events[f]=1===j.length?j[0]:j:i(this,f)}return this},j.prototype.removeAllListeners=function(a){var b;return a?(b=e?e+a:a,this._events[b]&&i(this,b)):(this._events=new f,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=e,j.EventEmitter=j,a.exports=j},"./node_modules/url-toolkit/src/url-toolkit.js":function(a,b,c){var d,e,f,g,h,i;e=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,f=/^([^\/?#]*)([^]*)$/,g=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),!(b=b.trim())){if(!c.alwaysNormalize)return a;var d=i.parseURL(a);if(!d)throw Error("Error trying to parse base URL.");return d.path=i.normalizePath(d.path),i.buildURLFromParts(d)}var e=i.parseURL(b);if(!e)throw Error("Error trying to parse relative URL.");if(e.scheme)return c.alwaysNormalize?(e.path=i.normalizePath(e.path),i.buildURLFromParts(e)):b;var g=i.parseURL(a);if(!g)throw Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&"/"!==g.path[0]){var h=f.exec(g.path);g.netLoc=h[1],g.path=h[2]}g.netLoc&&!g.path&&(g.path="/");var j={scheme:g.scheme,netLoc:e.netLoc,path:null,params:e.params,query:e.query,fragment:e.fragment};if(!e.netLoc&&(j.netLoc=g.netLoc,"/"!==e.path[0])){if(e.path){var k=g.path,l=k.substring(0,k.lastIndexOf("/")+1)+e.path;j.path=i.normalizePath(l)}else j.path=g.path,e.params||(j.params=g.params,e.query||(j.query=g.query))}return null===j.path&&(j.path=c.alwaysNormalize?i.normalizePath(e.path):e.path),i.buildURLFromParts(j)},parseURL:function(a){var b=e.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(g,"");a.length!==(a=a.replace(h,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}},a.exports=i},"./node_modules/webworkify-webpack/index.js":function(a,b,c){function d(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}c.m=a,c.c=b,c.i=function(a){return a},c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{configurable:!1,enumerable:!0,get:d})},c.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="/",c.oe=function(a){throw console.error(a),a};var d=c(c.s=ENTRY_MODULE);return d.default||d}var e="[\\.|\\-|\\+|\\w|/|@]+",f="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+e+").*?\\)";function g(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function h(a){return!isNaN(1*a)}function i(a,b,d){var i,j={};j[d]=[];var k=b.toString(),l=k.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return j;for(var m=l[1],n=RegExp("(\\\\n|\\W)"+g(m)+f,"g");i=n.exec(k);)"dll-reference"!==i[3]&&j[d].push(i[3]);for(n=RegExp("\\("+g(m)+'\\("(dll-reference\\s('+e+'))"\\)\\)'+f,"g");i=n.exec(k);)a[i[2]]||(j[d].push(i[1]),a[i[2]]=c(i[1]).m),j[i[2]]=j[i[2]]||[],j[i[2]].push(i[4]);for(var o=Object.keys(j),p=0;p<o.length;p++)for(var q=0;q<j[o[p]].length;q++)h(j[o[p]][q])&&(j[o[p]][q]=1*j[o[p]][q]);return j}function j(a){return Object.keys(a).reduce(function(b,c){return b||a[c].length>0},!1)}a.exports=function(a,b){b=b||{};var e={main:c.m},f=b.all?{main:Object.keys(e.main)}:function(a,b){for(var c={main:[b]},d={main:[]},e={main:{}};j(c);)for(var f=Object.keys(c),g=0;g<f.length;g++){var h=f[g],k=c[h].pop();if(e[h]=e[h]||{},!e[h][k]&&a[h][k]){e[h][k]=!0,d[h]=d[h]||[],d[h].push(k);for(var l=i(a,a[h][k],h),m=Object.keys(l),n=0;n<m.length;n++)c[m[n]]=c[m[n]]||[],c[m[n]]=c[m[n]].concat(l[m[n]])}}return d}(e,a),g="";Object.keys(f).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;f[a][b];)b++;f[a].push(b),e[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+f[a].map(function(b){return""+JSON.stringify(b)+": "+e[a][b].toString()}).join(",")+"});\n"}),g=g+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.main.map(function(a){return""+JSON.stringify(a)+": "+e.main[a].toString()}).join(",")+"}))(self);";var h=new window.Blob([g],{type:"text/javascript"});if(b.bare)return h;var k=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),l=new window.Worker(k);return l.objectURL=k,l}},"./src/config.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"hlsDefaultConfig",function(){return x}),c.d(b,"mergeConfig",function(){return y}),c.d(b,"enableStreamingMode",function(){return z});var d=c(/*! ./controller/abr-controller */ "./src/controller/abr-controller.ts"),e=c(/*! ./controller/audio-stream-controller */ "./src/controller/audio-stream-controller.ts"),f=c(/*! ./controller/audio-track-controller */ "./src/controller/audio-track-controller.ts"),g=c(/*! ./controller/subtitle-stream-controller */ "./src/controller/subtitle-stream-controller.ts"),h=c(/*! ./controller/subtitle-track-controller */ "./src/controller/subtitle-track-controller.ts"),i=c(/*! ./controller/buffer-controller */ "./src/controller/buffer-controller.ts"),j=c(/*! ./controller/timeline-controller */ "./src/controller/timeline-controller.ts"),k=c(/*! ./controller/cap-level-controller */ "./src/controller/cap-level-controller.ts"),l=c(/*! ./controller/fps-controller */ "./src/controller/fps-controller.ts"),m=c(/*! ./controller/eme-controller */ "./src/controller/eme-controller.ts"),n=c(/*! ./controller/cmcd-controller */ "./src/controller/cmcd-controller.ts"),o=c(/*! ./utils/xhr-loader */ "./src/utils/xhr-loader.ts"),p=c(/*! ./utils/fetch-loader */ "./src/utils/fetch-loader.ts"),q=c(/*! ./utils/cues */ "./src/utils/cues.ts"),r=c(/*! ./utils/mediakeys-helper */ "./src/utils/mediakeys-helper.ts"),s=c(/*! ./utils/logger */ "./src/utils/logger.ts");function t(){return(t=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function u(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function v(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?u(Object(c),!0).forEach(function(b){w(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):u(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function w(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var x=v(v({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:d.default,bufferController:i.default,capLevelController:k.default,fpsController:l.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:r.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:q.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:g.SubtitleStreamController,subtitleTrackController:h.default,timelineController:j.TimelineController,audioStreamController:e.default,audioTrackController:f.default,emeController:m.default,cmcdController:n.default});function y(a,b){if((b.liveSyncDurationCount||b.liveMaxLatencyDurationCount)&&(b.liveSyncDuration||b.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==b.liveMaxLatencyDurationCount&&(void 0===b.liveSyncDurationCount||b.liveMaxLatencyDurationCount<=b.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==b.liveMaxLatencyDuration&&(void 0===b.liveSyncDuration||b.liveMaxLatencyDuration<=b.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},a,b)}function z(a){var b=a.loader;b!==p.default&&b!==o.default?(s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):Object(p.fetchSupported)()&&(a.loader=p.default,a.progressive=!0,a.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../utils/ewma-bandwidth-estimator */ "./src/utils/ewma-bandwidth-estimator.ts"),f=c(/*! ../events */ "./src/events.ts"),g=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),h=c(/*! ../errors */ "./src/errors.ts"),i=c(/*! ../types/loader */ "./src/types/loader.ts"),j=c(/*! ../utils/logger */ "./src/utils/logger.ts");function k(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var l=function(){function a(a){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=a;var b=a.config;this.bwEstimator=new e.default(b.abrEwmaSlowVoD,b.abrEwmaFastVoD,b.abrEwmaDefaultEstimate),this.registerListeners()}var b,c,l,m=a.prototype;return m.registerListeners=function(){var a=this.hls;a.on(f.Events.FRAG_LOADING,this.onFragLoading,this),a.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(f.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var a=this.hls;a.off(f.Events.FRAG_LOADING,this.onFragLoading,this),a.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(f.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},m.onFragLoading=function(a,b){var c,d=b.frag;d.type!==i.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=d,this.partCurrent=null!=(c=b.part)?c:null,this.timer=self.setInterval(this.onCheck,100))},m.onLevelLoaded=function(a,b){var c=this.hls.config;b.details.live?this.bwEstimator.update(c.abrEwmaSlowLive,c.abrEwmaFastLive):this.bwEstimator.update(c.abrEwmaSlowVoD,c.abrEwmaFastVoD)},m._abandonRulesCheck=function(){var a,b=this.fragCurrent,c=this.partCurrent,e=this.hls,h=e.autoLevelEnabled,i=e.config,k=e.media;if(b&&k){var l=c?c.stats:b.stats,m=c?c.duration:b.duration;if(l.aborted){j.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(h&&!k.paused&&k.playbackRate&&k.readyState){var n=performance.now()-l.loading.start,o=Math.abs(k.playbackRate);if(!(n<=500*m/o)){var p=e.levels,q=e.minAutoLevel,r=p[b.level],s=l.total||Math.max(l.loaded,Math.round(m*r.maxBitrate/8)),t=Math.max(1,l.bwEstimate?l.bwEstimate/8:1e3*l.loaded/n),u=(s-l.loaded)/t,v=k.currentTime,w=(g.BufferHelper.bufferInfo(k,v,i.maxBufferHole).end-v)/o;if(!(w>=2*m/o)&&!(u<=w)){var x=Number.POSITIVE_INFINITY;for(a=b.level-1;a>q&&!((x=m*p[a].maxBitrate/(6.4*t))<w);a--);if(!(x>=u)){var y=this.bwEstimator.getEstimate();j.logger.warn("Fragment "+b.sn+(c?" part "+c.index:"")+" of level "+b.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+a+"\n      Current BW estimate: "+(Object(d.isFiniteNumber)(y)?(y/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+u.toFixed(3)+" s\n      Estimated load time for the next fragment: "+x.toFixed(3)+" s\n      Time to underbuffer: "+w.toFixed(3)+" s"),e.nextLoadLevel=a,this.bwEstimator.sample(n,l.loaded),this.clearTimer(),b.loader&&(this.fragCurrent=this.partCurrent=null,b.loader.abort()),e.trigger(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:b,part:c,stats:l})}}}}}},m.onFragLoaded=function(a,b){var c=b.frag,e=b.part;if(c.type===i.PlaylistLevelType.MAIN&&Object(d.isFiniteNumber)(c.sn)){var g=e?e.stats:c.stats,h=e?e.duration:c.duration;if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var j=this.hls.levels[c.level],k=(j.loaded?j.loaded.bytes:0)+g.loaded,l=(j.loaded?j.loaded.duration:0)+h;j.loaded={bytes:k,duration:l},j.realBitrate=Math.round(8*k/l)}if(c.bitrateTest){var m={stats:g,frag:c,part:e,id:c.type};this.onFragBuffered(f.Events.FRAG_BUFFERED,m),c.bitrateTest=!1}}},m.onFragBuffered=function(a,b){var c=b.frag,d=b.part,e=d?d.stats:c.stats;if(!e.aborted&&c.type===i.PlaylistLevelType.MAIN&&"initSegment"!==c.sn){var f=e.parsing.end-e.loading.start;this.bwEstimator.sample(f,e.loaded),e.bwEstimate=this.bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=f/1e3:this.bitrateTestDelay=0}},m.onError=function(a,b){switch(b.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},m.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},m.getNextABRAutoLevel=function(){var a=this.fragCurrent,b=this.partCurrent,c=this.hls,d=c.maxAutoLevel,e=c.config,f=c.minAutoLevel,h=c.media,i=b?b.duration:a?a.duration:0,k=h?h.currentTime:0,l=h&&0!==h.playbackRate?Math.abs(h.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():e.abrEwmaDefaultEstimate,n=(g.BufferHelper.bufferInfo(h,k,e.maxBufferHole).end-k)/l,o=this.findBestLevel(m,f,d,n,e.abrBandWidthFactor,e.abrBandWidthUpFactor);if(o>=0)return o;j.logger.trace((n?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=i?Math.min(i,e.maxStarvationDelay):e.maxStarvationDelay,q=e.abrBandWidthFactor,r=e.abrBandWidthUpFactor;if(!n){var s=this.bitrateTestDelay;s&&(p=(i?Math.min(i,e.maxLoadingDelay):e.maxLoadingDelay)-s,j.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),q=r=1)}return Math.max(o=this.findBestLevel(m,f,d,n+p,q,r),0)},m.findBestLevel=function(a,b,c,d,e,f){for(var g,h=this.fragCurrent,i=this.partCurrent,k=this.lastLoadedFragLevel,l=this.hls.levels,m=l[k],n=!!(null!=m&&null!==(g=m.details)&& void 0!==g&&g.live),o=null==m?void 0:m.codecSet,p=i?i.duration:h?h.duration:0,q=c;q>=b;q--){var r=l[q];if(r&&(!o||r.codecSet===o)){var s=r.details,t=(i?null==s?void 0:s.partTarget:null==s?void 0:s.averagetargetduration)||p,u=void 0;u=q<=k?e*a:f*a;var v=l[q].maxBitrate,w=v*t/u;if(j.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+q+"/"+Math.round(u)+"/"+v+"/"+t+"/"+d+"/"+w),u>v&&(!w||n&&!this.bitrateTestDelay||w<d))return q}}return -1},b=a,c=[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this.bwEstimator;if(-1!==a&&(!b||!b.canEstimate()))return a;var c=this.getNextABRAutoLevel();return -1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}}],k(b.prototype,c),l&&k(b,l),a}();b.default=l},"./src/controller/audio-stream-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ./base-stream-controller */ "./src/controller/base-stream-controller.ts"),f=c(/*! ../events */ "./src/events.ts"),g=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),h=c(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),i=c(/*! ../types/level */ "./src/types/level.ts"),j=c(/*! ../types/loader */ "./src/types/loader.ts"),k=c(/*! ../loader/fragment */ "./src/loader/fragment.ts"),l=c(/*! ../demux/chunk-cache */ "./src/demux/chunk-cache.ts"),m=c(/*! ../demux/transmuxer-interface */ "./src/demux/transmuxer-interface.ts"),n=c(/*! ../types/transmuxer */ "./src/types/transmuxer.ts"),o=c(/*! ./fragment-finders */ "./src/controller/fragment-finders.ts"),p=c(/*! ../utils/discontinuities */ "./src/utils/discontinuities.ts"),q=c(/*! ../errors */ "./src/errors.ts"),r=c(/*! ../utils/logger */ "./src/utils/logger.ts");function s(){return(s=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function t(a,b){return(t=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var u=function(a){function b(b,c){var d;return(d=a.call(this,b,c,"[audio-stream-controller]")||this).videoBuffer=null,d.videoTrackCC=-1,d.waitingVideoCC=-1,d.audioSwitch=!1,d.trackId=-1,d.waitingData=null,d.mainDetails=null,d.bufferFlushed=!1,d._registerListeners(),d}c=b,u=a,c.prototype=Object.create(u.prototype),c.prototype.constructor=c,t(c,u);var c,u,v=b.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var a=this.hls;a.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(f.Events.ERROR,this.onError,this),a.on(f.Events.BUFFER_RESET,this.onBufferReset,this),a.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var a=this.hls;a.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(f.Events.ERROR,this.onError,this),a.off(f.Events.BUFFER_RESET,this.onBufferReset,this),a.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(a,b){var c=b.frag,d=b.id,f=b.initPTS;if("main"===d){var g=c.cc;this.initPTS[c.cc]=f,this.log("InitPTS for cc: "+g+" found from main: "+f),this.videoTrackCC=g,this.state===e.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=e.State.STOPPED;return}var b=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,b>0&& -1===a?(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=e.State.IDLE):(this.loadedmetadata=!1,this.state=e.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},v.doTick=function(){switch(this.state){case e.State.IDLE:this.doTickIdle();break;case e.State.WAITING_TRACK:var b,c=this.levels,d=this.trackId,f=null==c?void 0:null===(b=c[d])|| void 0===b?void 0:b.details;if(f){if(this.waitForCdnTuneIn(f))break;this.state=e.State.WAITING_INIT_PTS}break;case e.State.FRAG_LOADING_WAITING_RETRY:var h,i=performance.now(),j=this.retryDate;(!j||i>=j||null!==(h=this.media)&& void 0!==h&&h.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=e.State.IDLE);break;case e.State.WAITING_INIT_PTS:var k=this.waitingData;if(k){var l=k.frag,m=k.part,n=k.cache,p=k.complete;if(void 0!==this.initPTS[l.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=e.State.FRAG_LOADING;var q={frag:l,part:m,payload:n.flush(),networkDetails:null};this._handleFragmentLoadProgress(q),p&&a.prototype._handleFragmentLoadComplete.call(this,q)}else if(this.videoTrackCC!==this.waitingVideoCC)r.logger.log("Waiting fragment cc ("+l.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var s=this.getLoadPosition(),t=g.BufferHelper.bufferInfo(this.mediaBuffer,s,this.config.maxBufferHole);0>Object(o.fragmentWithinToleranceTest)(t.end,this.config.maxFragLookUpTolerance,l)&&(r.logger.log("Waiting fragment cc ("+l.cc+") @ "+l.start+" cancelled because another fragment at "+t.end+" is needed"),this.clearWaitingFragment())}}else this.state=e.State.IDLE}this.onTickEnd()},v.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=e.State.IDLE)},v.onTickEnd=function(){var a=this.media;if(a&&a.readyState){var b=(this.mediaBuffer?this.mediaBuffer:a).buffered;!this.loadedmetadata&&b.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},v.doTickIdle=function(){var a,b,c=this.hls,d=this.levels,g=this.media,h=this.trackId,i=c.config;if(d&&d[h]&&(g|| !this.startFragRequested&&i.startFragPrefetch)){var l=d[h].details;if(!l||l.live&&this.levelLastLoaded!==h||this.waitForCdnTuneIn(l)){this.state=e.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,k.ElementaryStreamTypes.AUDIO,j.PlaylistLevelType.AUDIO));var m=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,j.PlaylistLevelType.AUDIO);if(null!==m){var n=m.len,o=this.getMaxBufferLength(),p=this.audioSwitch;if(!(n>=o)||p){if(!p&&this._streamEnded(m,l)){c.trigger(f.Events.BUFFER_EOS,{type:"audio"}),this.state=e.State.ENDED;return}var q=l.fragments[0].start,r=m.end;if(p){var s=this.getLoadPosition();r=s,l.PTSKnown&&s<q&&(m.end>q||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),g.currentTime=q+.05)}var t=this.getNextFragment(r,l);if(!t){this.bufferFlushed=!0;return}(null===(a=t.decryptdata)|| void 0===a?void 0:a.keyFormat)!=="identity"||null!==(b=t.decryptdata)&& void 0!==b&&b.key?this.loadFragment(t,l,r):this.loadKey(t,l)}}}},v.getMaxBufferLength=function(){var b=a.prototype.getMaxBufferLength.call(this),c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,j.PlaylistLevelType.MAIN);return null===c?b:Math.max(b,c.len)},v.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(a,b){var c=b.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(a){return new i.Level(a)})},v.onAudioTrackSwitching=function(a,b){var c=!!b.url;this.trackId=b.id;var d=this.fragCurrent;null!=d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(100):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=e.State.IDLE):this.state=e.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(a,b){this.mainDetails=b.details},v.onAudioTrackLoaded=function(a,b){var c,d=this.levels,f=b.details,g=b.id;if(!d){this.warn("Audio tracks were reset while loading level "+g);return}this.log("Track "+g+" loaded ["+f.startSN+","+f.endSN+"],duration:"+f.totalduration);var h=d[g],i=0;if(f.live||null!==(c=h.details)&& void 0!==c&&c.live){var j=this.mainDetails;if(f.fragments[0]||(f.deltaUpdateFailed=!0),f.deltaUpdateFailed||!j)return;!h.details&&f.hasProgramDateTime&&j.hasProgramDateTime?(Object(p.alignMediaPlaylistByPDT)(f,j),i=f.fragments[0].start):i=this.alignPlaylists(f,h.details)}h.details=f,this.levelLastLoaded=g,this.startFragRequested|| !this.mainDetails&&f.live||this.setStartPosition(h.details,i),this.state!==e.State.WAITING_TRACK||this.waitForCdnTuneIn(f)||(this.state=e.State.IDLE),this.tick()},v._handleFragmentLoadProgress=function(a){var b,c=a.frag,d=a.part,f=a.payload,g=this.config,h=this.trackId,i=this.levels;if(!i){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var k=i[h];console.assert(k,"Audio track is defined on fragment load progress");var o=k.details;console.assert(o,"Audio track details are defined on fragment load progress");var p=g.defaultAudioCodec||k.audioCodec||"mp4a.40.2",q=this.transmuxer;q||(q=this.transmuxer=new m.default(this.hls,j.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var s=this.initPTS[c.cc],t=null===(b=c.initSegment)|| void 0===b?void 0:b.data;if(void 0!==s){var u=!1,v=d?d.index:-1,w=-1!==v,x=new n.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,f.byteLength,v,w);q.push(f,t,p,"",c,d,o.totalduration,u,x,s)}else r.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+o.startSN+" ,"+o.endSN+"],track "+h),(this.waitingData=this.waitingData||{frag:c,part:d,cache:new l.default,complete:!1}).cache.push(new Uint8Array(f)),this.waitingVideoCC=this.videoTrackCC,this.state=e.State.WAITING_INIT_PTS},v._handleFragmentLoadComplete=function(b){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,b)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(a,b){var c=b.tracks.audio;c&&(this.mediaBuffer=c.buffer),b.tracks.video&&(this.videoBuffer=b.tracks.video.buffer)},v.onFragBuffered=function(a,b){var c=b.frag,d=b.part;if(c.type===j.PlaylistLevelType.AUDIO){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(d?" p: "+d.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}"initSegment"!==c.sn&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,d)}},v.onError=function(b,c){switch(c.details){case q.ErrorDetails.FRAG_LOAD_ERROR:case q.ErrorDetails.FRAG_LOAD_TIMEOUT:case q.ErrorDetails.KEY_LOAD_ERROR:case q.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(j.PlaylistLevelType.AUDIO,c);break;case q.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case q.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==e.State.ERROR&&this.state!==e.State.STOPPED&&(this.state=c.fatal?e.State.ERROR:e.State.IDLE,this.warn(c.details+" while loading frag, switching to "+this.state+" state"));break;case q.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===c.parent&&(this.state===e.State.PARSING||this.state===e.State.PARSED)){var d=!0,f=this.getFwdBufferInfo(this.mediaBuffer,j.PlaylistLevelType.AUDIO);f&&f.len>.5&&(d=!this.reduceMaxBufferLength(f.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},v.onBufferFlushed=function(a,b){b.type===k.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},v._handleTransmuxComplete=function(a){var b,c="audio",d=this.hls,g=a.remuxResult,h=a.chunkMeta,i=this.getCurrentContext(h);if(!i){this.warn("The loading context changed while buffering fragment "+h.sn+" of level "+h.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(h.level);return}var j=i.frag,l=i.part,m=g.audio,n=g.text,o=g.id3,p=g.initSegment;if(!this.fragContextChanged(j)){if(this.state=e.State.PARSING,this.audioSwitch&&m&&this.completeAudioSwitch(),null!=p&&p.tracks&&(this._bufferInitSegment(p.tracks,j,h),d.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:j,id:c,tracks:p.tracks})),m){var q=m.startPTS,r=m.endPTS,t=m.startDTS,u=m.endDTS;l&&(l.elementaryStreams[k.ElementaryStreamTypes.AUDIO]={startPTS:q,endPTS:r,startDTS:t,endDTS:u}),j.setElementaryStreamInfo(k.ElementaryStreamTypes.AUDIO,q,r,t,u),this.bufferFragmentData(m,j,l,h)}if(null!=o&&null!==(b=o.samples)&& void 0!==b&&b.length){var v=s({frag:j,id:c},o);d.trigger(f.Events.FRAG_PARSING_METADATA,v)}if(n){var w=s({frag:j,id:c},n);d.trigger(f.Events.FRAG_PARSING_USERDATA,w)}}},v._bufferInitSegment=function(a,b,c){if(this.state===e.State.PARSING){a.video&&delete a.video;var d=a.audio;if(d){d.levelCodec=d.codec,d.id="audio",this.log("Init audio buffer, container:"+d.container+", codecs[parsed]=["+d.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,a);var g=d.initSegment;if(null!=g&&g.byteLength){var h={type:"audio",frag:b,part:null,chunkMeta:c,parent:b.type,data:g};this.hls.trigger(f.Events.BUFFER_APPENDING,h)}this.tick()}}},v.loadFragment=function(b,c,f){var g=this.fragmentTracker.getState(b);this.fragCurrent=b,(this.audioSwitch||g===h.FragmentState.NOT_LOADED||g===h.FragmentState.PARTIAL)&&("initSegment"===b.sn?this._loadInitSegment(b):c.live&&!Object(d.isFiniteNumber)(this.initPTS[b.cc])?(this.log("Waiting for video PTS in continuity counter "+b.cc+" of live stream before loading audio fragment "+b.sn+" of level "+this.trackId),this.state=e.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,b,c,f)))},v.completeAudioSwitch=function(){var b=this.hls,c=this.media,d=this.trackId;c&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,b.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:d})},b}(e.default);b.default=u},"./src/controller/audio-track-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../errors */ "./src/errors.ts"),f=c(/*! ./base-playlist-controller */ "./src/controller/base-playlist-controller.ts"),g=c(/*! ../types/loader */ "./src/types/loader.ts");function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var j=function(a){function b(b){var c;return(c=a.call(this,b,"[audio-track-controller]")||this).tracks=[],c.groupId=null,c.tracksInGroup=[],c.trackId=-1,c.trackName="",c.selectDefaultTrack=!0,c.registerListeners(),c}c=b,f=a,c.prototype=Object.create(f.prototype),c.prototype.constructor=c,i(c,f);var c,f,j,k,l,m=b.prototype;return m.registerListeners=function(){var a=this.hls;a.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(d.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(d.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(d.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(d.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var a=this.hls;a.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(d.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(d.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(d.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(d.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,a.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(a,b){this.tracks=b.audioTracks||[]},m.onAudioTrackLoaded=function(a,b){var c=b.id,d=b.details,e=this.tracksInGroup[c];if(!e){this.warn("Invalid audio track id "+c);return}var f=e.details;e.details=b.details,this.log("audioTrack "+c+" loaded ["+d.startSN+"-"+d.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,b,f))},m.onLevelLoading=function(a,b){this.switchLevel(b.level)},m.onLevelSwitching=function(a,b){this.switchLevel(b.level)},m.switchLevel=function(a){var b=this.hls.levels[a];if(null!=b&&b.audioGroupIds){var c=b.audioGroupIds[b.urlId];if(this.groupId!==c){this.groupId=c;var e=this.tracks.filter(function(a){return!c||a.groupId===c});this.selectDefaultTrack&&!e.some(function(a){return a.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;var f={audioTracks:e};this.log("Updating audio tracks, "+e.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(d.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},m.onError=function(b,c){a.prototype.onError.call(this,b,c),!c.fatal&&c.context&&c.context.type===g.PlaylistContextType.AUDIO_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},m.setAudioTrack=function(a){var b=this.tracksInGroup;if(a<0||a>=b.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var c=b[this.trackId];this.log("Now switching to audio-track index "+a);var e=b[a],f=e.id,g=e.groupId,h=e.name,i=e.type,j=e.url;if(this.trackId=a,this.trackName=h,this.selectDefaultTrack=!1,this.hls.trigger(d.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:void 0===g?"":g,name:h,type:i,url:j}),!e.details||e.details.live){var k=this.switchParams(e.url,null==c?void 0:c.details);this.loadPlaylist(k)}},m.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var b=this.trackName,c=this.findTrackId(b)||this.findTrackId();-1!==c?this.setAudioTrack(c):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(a){for(var b=this.tracksInGroup,c=0;c<b.length;c++){var d=b[c];if((!this.selectDefaultTrack||d.default)&&(!a||a===d.name))return d.id}return -1},m.loadPlaylist=function(a){var b=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(b)){var c=b.id,e=b.groupId,f=b.url;if(a)try{f=a.addDirectives(f)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("loading audio-track playlist for id: "+c),this.clearTimer(),this.hls.trigger(d.Events.AUDIO_TRACK_LOADING,{url:f,id:c,groupId:e,deliveryDirectives:a||null})}},j=b,k=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}],h(j.prototype,k),l&&h(j,l),b}(f.default);b.default=j},"./src/controller/base-playlist-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return i});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../types/level */ "./src/types/level.ts"),f=c(/*! ./level-helper */ "./src/controller/level-helper.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h=c(/*! ../errors */ "./src/errors.ts"),i=function(){function a(a,b){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=g.logger.log.bind(g.logger,b+":"),this.warn=g.logger.warn.bind(g.logger,b+":"),this.hls=a}var b=a.prototype;return b.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},b.onError=function(a,b){b.fatal&&b.type===h.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},b.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},b.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},b.stopLoad=function(){this.canLoad=!1,this.clearTimer()},b.switchParams=function(a,b){var c=null==b?void 0:b.renditionReports;if(c)for(var f=0;f<c.length;f++){var g=c[f],h=""+g.URI;if(h===a.substr(-h.length)){var i=parseInt(g["LAST-MSN"]),j=parseInt(g["LAST-PART"]);if(b&&this.hls.config.lowLatencyMode){var k=Math.min(b.age-b.partTarget,b.targetduration);void 0!==j&&k>b.partTarget&&(j+=1)}if(Object(d.isFiniteNumber)(i))return new e.HlsUrlParameters(i,Object(d.isFiniteNumber)(j)?j:void 0,e.HlsSkip.No)}}},b.loadPlaylist=function(a){},b.shouldLoadTrack=function(a){return this.canLoad&&a&&!!a.url&&(!a.details||a.details.live)},b.playlistLoaded=function(a,b,c){var d=this,e=b.details,g=b.stats,h=g.loading.end?Math.max(0,self.performance.now()-g.loading.end):0;if(e.advancedDateTime=Date.now()-h,e.live||null!=c&&c.live){if(e.reloaded(c),c&&this.log("live playlist "+a+" "+(e.advanced?"REFRESHED "+e.lastPartSn+"-"+e.lastPartIndex:"MISSED")),c&&e.fragments.length>0&&Object(f.mergeDetails)(c,e),!this.canLoad||!e.live)return;var i,j=void 0,k=void 0;if(e.canBlockReload&&e.endSN&&e.advanced){var l=this.hls.config.lowLatencyMode,m=e.lastPartSn,n=e.endSN,o=e.lastPartIndex,p=-1!==o,q=m===n,r=l?0:o;p?(j=q?n+1:m,k=q?r:o+1):j=n+1;var s=e.age,t=Math.min(s+e.ageHeader-e.partTarget,1.5*e.targetduration);if(t>0){if(c&&t>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+t+" with playlist age: "+e.age),t=0;else{var u=Math.floor(t/e.targetduration);j+=u,void 0!==k&&(k+=Math.round(t%e.targetduration/e.partTarget)),this.log("CDN Tune-in age: "+e.ageHeader+"s last advanced "+s.toFixed(2)+"s goal: "+t+" skip sn "+u+" to part "+k)}e.tuneInGoal=t}if(i=this.getDeliveryDirectives(e,b.deliveryDirectives,j,k),l||!q){this.loadPlaylist(i);return}}else i=this.getDeliveryDirectives(e,b.deliveryDirectives,j,k);var v=Object(f.computeReloadInterval)(e,g);void 0!==j&&e.canBlockReload&&(v-=e.partTarget||1),this.log("reload live playlist "+a+" in "+Math.round(v)+" ms"),this.timer=self.setTimeout(function(){return d.loadPlaylist(i)},v)}else this.clearTimer()},b.getDeliveryDirectives=function(a,b,c,d){var f=Object(e.getSkipValue)(a,c);return null!=b&&b.skip&&a.deltaUpdateFailed&&(c=b.msn,d=b.part,f=e.HlsSkip.No),new e.HlsUrlParameters(c,d,f)},b.retryLoadingOrFail=function(a){var b,c=this,d=this.hls.config,e=this.retryCount<d.levelLoadingMaxRetry;if(e){if(this.retryCount++,a.details.indexOf("LoadTimeOut")> -1&&null!==(b=a.context)&& void 0!==b&&b.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+a.details+'"'),this.loadPlaylist();else{var f=Math.min(Math.pow(2,this.retryCount)*d.levelLoadingRetryDelay,d.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return c.loadPlaylist()},f),this.warn("retry playlist loading #"+this.retryCount+" in "+f+' ms after "'+a.details+'"')}}else this.warn('cannot recover from error "'+a.details+'"'),this.clearTimer(),a.fatal=!0;return e},a}()},"./src/controller/base-stream-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"State",function(){return v}),c.d(b,"default",function(){return w});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../task-loop */ "./src/task-loop.ts"),f=c(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),g=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),h=c(/*! ../utils/logger */ "./src/utils/logger.ts"),i=c(/*! ../events */ "./src/events.ts"),j=c(/*! ../errors */ "./src/errors.ts"),k=c(/*! ../types/transmuxer */ "./src/types/transmuxer.ts"),l=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),m=c(/*! ../utils/discontinuities */ "./src/utils/discontinuities.ts"),n=c(/*! ./fragment-finders */ "./src/controller/fragment-finders.ts"),o=c(/*! ./level-helper */ "./src/controller/level-helper.ts"),p=c(/*! ../loader/fragment-loader */ "./src/loader/fragment-loader.ts"),q=c(/*! ../crypt/decrypter */ "./src/crypt/decrypter.ts"),r=c(/*! ../utils/time-ranges */ "./src/utils/time-ranges.ts"),s=c(/*! ../types/loader */ "./src/types/loader.ts");function t(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function u(a,b){return(u=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var v={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},w=function(a){function b(b,c,d){var e;return(e=a.call(this)||this).hls=void 0,e.fragPrevious=null,e.fragCurrent=null,e.fragmentTracker=void 0,e.transmuxer=null,e._state=v.STOPPED,e.media=void 0,e.mediaBuffer=void 0,e.config=void 0,e.bitrateTest=!1,e.lastCurrentTime=0,e.nextLoadPosition=0,e.startPosition=0,e.loadedmetadata=!1,e.fragLoadError=0,e.retryDate=0,e.levels=null,e.fragmentLoader=void 0,e.levelLastLoaded=null,e.startFragRequested=!1,e.decrypter=void 0,e.initPTS=[],e.onvseeking=null,e.onvended=null,e.logPrefix="",e.log=void 0,e.warn=void 0,e.logPrefix=d,e.log=h.logger.log.bind(h.logger,d+":"),e.warn=h.logger.warn.bind(h.logger,d+":"),e.hls=b,e.fragmentLoader=new p.default(b.config),e.fragmentTracker=c,e.config=b.config,e.decrypter=new q.default(b,b.config),b.on(i.Events.KEY_LOADED,e.onKeyLoaded,function(a){if(void 0===a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return a}(e)),e}c=b,e=a,c.prototype=Object.create(e.prototype),c.prototype.constructor=c,u(c,e);var c,e,w,x,y,z=b.prototype;return z.doTick=function(){this.onTickEnd()},z.onTickEnd=function(){},z.startLoad=function(a){},z.stopLoad=function(){this.fragmentLoader.abort();var a=this.fragCurrent;a&&this.fragmentTracker.removeFragment(a),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=v.STOPPED},z._streamEnded=function(a,b){var c=this.fragCurrent,d=this.fragmentTracker;if(!b.live&&c&&c.sn>=b.endSN&&!a.nextStart){var e=b.partList;if(null!=e&&e.length){var h=e[e.length-1];return g.BufferHelper.isBuffered(this.media,h.start+h.duration/2)}var i=d.getState(c);return i===f.FragmentState.PARTIAL||i===f.FragmentState.OK}return!1},z.onMediaAttached=function(a,b){var c=this.media=this.mediaBuffer=b.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),c.addEventListener("seeking",this.onvseeking),c.addEventListener("ended",this.onvended);var d=this.config;this.levels&&d.autoStartLoad&&this.state===v.STOPPED&&this.startLoad(d.startPosition)},z.onMediaDetaching=function(){var a=this.media;null!=a&&a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},z.onMediaSeeking=function(){var a=this.config,b=this.fragCurrent,c=this.media,e=this.mediaBuffer,f=this.state,h=c?c.currentTime:0,i=g.BufferHelper.bufferInfo(e||c,h,a.maxBufferHole);if(this.log("media seeking to "+(Object(d.isFiniteNumber)(h)?h.toFixed(3):h)+", state: "+f),f===v.ENDED)this.resetLoadingState();else if(b&&!i.len){var j=a.maxFragLookUpTolerance,k=b.start-j,l=b.start+b.duration+j,m=h>l;(h<k||m)&&(m&&b.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),b.loader.abort()),this.resetLoadingState())}c&&(this.lastCurrentTime=h),this.loadedmetadata||i.len||(this.nextLoadPosition=this.startPosition=h),this.tickImmediate()},z.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},z.onKeyLoaded=function(a,b){if(this.state===v.KEY_LOADING&&b.frag===this.fragCurrent&&this.levels){this.state=v.IDLE;var c=this.levels[b.frag.level].details;c&&this.loadFragment(b.frag,c,b.frag.start)}},z.onHandlerDestroying=function(){this.stopLoad(),a.prototype.onHandlerDestroying.call(this)},z.onHandlerDestroyed=function(){this.state=v.STOPPED,this.hls.off(i.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},z.loadKey=function(a,b){this.log("Loading key for "+a.sn+" of ["+b.startSN+"-"+b.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+a.level),this.state=v.KEY_LOADING,this.fragCurrent=a,this.hls.trigger(i.Events.KEY_LOADING,{frag:a})},z.loadFragment=function(a,b,c){this._loadFragForPlayback(a,b,c)},z._loadFragForPlayback=function(a,b,c){var d=this,e=function(b){if(d.fragContextChanged(a)){d.warn("Fragment "+a.sn+(b.part?" p: "+b.part.index:"")+" of level "+a.level+" was dropped during download."),d.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,d._handleFragmentLoadProgress(b)};this._doFragLoad(a,b,c,e).then(function(b){if(b){d.fragLoadError=0;var c=d.state;if(d.fragContextChanged(a)){c!==v.FRAG_LOADING&&c!==v.BACKTRACKING&&(d.fragCurrent||c!==v.PARSING)||(d.fragmentTracker.removeFragment(a),d.state=v.IDLE);return}if("payload"in b&&(d.log("Loaded fragment "+a.sn+" of level "+a.level),d.hls.trigger(i.Events.FRAG_LOADED,b),d.state===v.BACKTRACKING)){d.fragmentTracker.backtrack(a,b),d.resetFragmentLoading(a);return}d._handleFragmentLoadComplete(b)}}).catch(function(b){d.warn(b),d.resetFragmentLoading(a)})},z.flushMainBuffer=function(a,b,c){if(void 0===c&&(c=null),a-b){var d={startOffset:a,endOffset:b,type:c};this.fragLoadError=0,this.hls.trigger(i.Events.BUFFER_FLUSHING,d)}},z._loadInitSegment=function(a){var b=this;this._doFragLoad(a).then(function(c){if(!c||b.fragContextChanged(a)||!b.levels)throw Error("init load aborted");return c}).then(function(c){var d=b.hls,e=c.payload,f=a.decryptdata;if(e&&e.byteLength>0&&f&&f.key&&f.iv&&"AES-128"===f.method){var g=self.performance.now();return b.decrypter.webCryptoDecrypt(new Uint8Array(e),f.key.buffer,f.iv.buffer).then(function(b){var e=self.performance.now();return d.trigger(i.Events.FRAG_DECRYPTED,{frag:a,payload:b,stats:{tstart:g,tdecrypt:e}}),c.payload=b,c})}return c}).then(function(c){var d=b.fragCurrent,e=b.hls,f=b.levels;if(!f)throw Error("init load aborted, missing levels");var g=f[a.level].details;console.assert(g,"Level details are defined when init segment is loaded");var h=a.stats;b.state=v.IDLE,b.fragLoadError=0,a.data=new Uint8Array(c.payload),h.parsing.start=h.buffering.start=self.performance.now(),h.parsing.end=h.buffering.end=self.performance.now(),c.frag===d&&e.trigger(i.Events.FRAG_BUFFERED,{stats:h,frag:d,part:null,id:a.type}),b.tick()}).catch(function(c){b.warn(c),b.resetFragmentLoading(a)})},z.fragContextChanged=function(a){var b=this.fragCurrent;return!a||!b||a.level!==b.level||a.sn!==b.sn||a.urlId!==b.urlId},z.fragBufferedComplete=function(a,b){var c=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+a.type+" sn: "+a.sn+(b?" part: "+b.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+a.level+" "+r.default.toString(g.BufferHelper.getBuffered(c))),this.state=v.IDLE,this.tick()},z._handleFragmentLoadComplete=function(a){var b=this.transmuxer;if(b){var c=a.frag,d=a.part,e=a.partsLoaded,f=!e||0===e.length||e.some(function(a){return!a}),g=new k.ChunkMetadata(c.level,c.sn,c.stats.chunkCount+1,0,d?d.index:-1,!f);b.flush(g)}},z._handleFragmentLoadProgress=function(a){},z._doFragLoad=function(a,b,c,e){var f=this;if(void 0===c&&(c=null),!this.levels)throw Error("frag load aborted, missing levels");if(c=Math.max(a.start,c||0),this.config.lowLatencyMode&&b){var g=b.partList;if(g&&e){c>a.end&&b.fragmentHint&&(a=b.fragmentHint);var h=this.getNextPart(g,a,c);if(h> -1){var j=g[h];return this.log("Loading part sn: "+a.sn+" p: "+j.index+" cc: "+a.cc+" of playlist ["+b.startSN+"-"+b.endSN+"] parts [0-"+h+"-"+(g.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+a.level+", target: "+parseFloat(c.toFixed(3))),this.nextLoadPosition=j.start+j.duration,this.state=v.FRAG_LOADING,this.hls.trigger(i.Events.FRAG_LOADING,{frag:a,part:g[h],targetBufferTime:c}),this.doFragPartsLoad(a,g,h,e).catch(function(a){return f.handleFragLoadError(a)})}if(!a.url||this.loadedEndOfParts(g,c))return Promise.resolve(null)}}return this.log("Loading fragment "+a.sn+" cc: "+a.cc+" "+(b?"of ["+b.startSN+"-"+b.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+a.level+", target: "+parseFloat(c.toFixed(3))),Object(d.isFiniteNumber)(a.sn)&&!this.bitrateTest&&(this.nextLoadPosition=a.start+a.duration),this.state=v.FRAG_LOADING,this.hls.trigger(i.Events.FRAG_LOADING,{frag:a,targetBufferTime:c}),this.fragmentLoader.load(a,e).catch(function(a){return f.handleFragLoadError(a)})},z.doFragPartsLoad=function(a,b,c,d){var e=this;return new Promise(function(f,g){var h=[];!function c(j){var k=b[j];e.fragmentLoader.loadPart(a,k,d).then(function(d){h[k.index]=d;var g=d.part;e.hls.trigger(i.Events.FRAG_LOADED,d);var l=b[j+1];if(!l||l.fragment!==a)return f({frag:a,part:g,partsLoaded:h});c(j+1)}).catch(g)}(c)})},z.handleFragLoadError=function(a){var b=a.data;return b&&b.details===j.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(b.frag,b.part):this.hls.trigger(i.Events.ERROR,b),null},z._handleTransmuxerFlush=function(a){var b=this.getCurrentContext(a);if(!b||this.state!==v.PARSING){this.fragCurrent||(this.state=v.IDLE);return}var c=b.frag,d=b.part,e=b.level,f=self.performance.now();c.stats.parsing.end=f,d&&(d.stats.parsing.end=f),this.updateLevelTiming(c,d,e,a.partial)},z.getCurrentContext=function(a){var b=this.levels,c=a.level,d=a.sn,e=a.part;if(!b||!b[c])return this.warn("Levels object was unset while buffering fragment "+d+" of level "+c+". The current chunk will not be buffered."),null;var f=b[c],g=e> -1?Object(o.getPartWith)(f,d,e):null,h=g?g.fragment:Object(o.getFragmentWithSN)(f,d,this.fragCurrent);return h?{frag:h,part:g,level:f}:null},z.bufferFragmentData=function(a,b,c,d){if(a&&this.state===v.PARSING){var e=a.data1,f=a.data2,g=e;if(e&&f&&(g=Object(l.appendUint8Array)(e,f)),g&&g.length){var h={type:a.type,frag:b,part:c,chunkMeta:d,parent:b.type,data:g};this.hls.trigger(i.Events.BUFFER_APPENDING,h),a.dropped&&a.independent&&!c&&this.flushBufferGap(b)}}},z.flushBufferGap=function(a){var b=this.media;if(b){if(!g.BufferHelper.isBuffered(b,b.currentTime)){this.flushMainBuffer(0,a.start);return}var c=b.currentTime,d=g.BufferHelper.bufferInfo(b,c,0),e=a.duration,f=Math.min(2*this.config.maxFragLookUpTolerance,.25*e),h=Math.max(Math.min(a.start-f,d.end-f),c+f);a.start-h>f&&this.flushMainBuffer(h,a.start)}},z.getFwdBufferInfo=function(a,b){var c=this.config,e=this.getLoadPosition();if(!Object(d.isFiniteNumber)(e))return null;var f=g.BufferHelper.bufferInfo(a,e,c.maxBufferHole);if(0===f.len&& void 0!==f.nextStart){var h=this.fragmentTracker.getBufferedFrag(e,b);if(h&&f.nextStart<h.end)return g.BufferHelper.bufferInfo(a,e,Math.max(f.nextStart,c.maxBufferHole))}return f},z.getMaxBufferLength=function(a){var b,c=this.config;return b=a?Math.max(8*c.maxBufferSize/a,c.maxBufferLength):c.maxBufferLength,Math.min(b,c.maxMaxBufferLength)},z.reduceMaxBufferLength=function(a){var b=this.config,c=a||b.maxBufferLength;return b.maxMaxBufferLength>=c&&(b.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0)},z.getNextFragment=function(a,b){var c,d,e,f=b.fragments,g=f.length;if(!g)return null;var h=this.config,i=f[0].start;if(b.live){var j=h.initialLiveManifestSize;if(g<j)return this.warn("Not enough fragments to start playback (have: "+g+", need: "+j+")"),null;b.PTSKnown||this.startFragRequested|| -1!==this.startPosition||(e=this.getInitialLiveFragment(b,f),this.startPosition=e?this.hls.liveSyncPosition||e.start:a)}else a<=i&&(e=f[0]);if(!e){var k=h.lowLatencyMode?b.partEnd:b.fragmentEnd;e=this.getFragmentAtPosition(a,k,b)}return null===(c=e)|| void 0===c||!c.initSegment||null!==(d=e)&& void 0!==d&&d.initSegment.data||this.bitrateTest||(e=e.initSegment),e},z.getNextPart=function(a,b,c){for(var d=-1,e=!1,f=!0,g=0,h=a.length;g<h;g++){var i=a[g];if(f=f&&!i.independent,d> -1&&c<i.start)break;var j=i.loaded;!j&&(e||i.independent||f)&&i.fragment===b&&(d=g),e=j}return d},z.loadedEndOfParts=function(a,b){var c=a[a.length-1];return c&&b>c.start&&c.loaded},z.getInitialLiveFragment=function(a,b){var c=this.fragPrevious,d=null;if(c){if(a.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+c.programDateTime),d=Object(n.findFragmentByPDT)(b,c.endProgramDateTime,this.config.maxFragLookUpTolerance)),!d){var e=c.sn+1;if(e>=a.startSN&&e<=a.endSN){var f=b[e-a.startSN];c.cc===f.cc&&(d=f,this.log("Live playlist, switching playlist, load frag with next SN: "+d.sn))}!d&&(d=Object(n.findFragWithCC)(b,c.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+d.sn)}}else{var g=this.hls.liveSyncPosition;null!==g&&(d=this.getFragmentAtPosition(g,this.bitrateTest?a.fragmentEnd:a.edge,a))}return d},z.getFragmentAtPosition=function(a,b,c){var d,e=this.config,g=this.fragPrevious,h=c.fragments,i=c.endSN,j=c.fragmentHint,k=e.maxFragLookUpTolerance,l=!!(e.lowLatencyMode&&c.partList&&j);if(l&&j&&!this.bitrateTest&&(h=h.concat(j),i=j.sn),a<b){var m=a>b-k?0:k;d=Object(n.findFragmentByPTS)(g,h,a,m)}else d=h[h.length-1];if(d){var o=d.sn-c.startSN,p=g&&d.level===g.level,q=h[o+1];if(this.fragmentTracker.getState(d)===f.FragmentState.BACKTRACKED){d=null;for(var r=o;h[r]&&this.fragmentTracker.getState(h[r])===f.FragmentState.BACKTRACKED;)d=g?h[r--]:h[--r];d||(d=q)}else g&&d.sn===g.sn&&!l&&p&&(d.sn<i&&this.fragmentTracker.getState(q)!==f.FragmentState.OK?(this.log("SN "+d.sn+" just loaded, load next one: "+q.sn),d=q):d=null)}return d},z.synchronizeToLiveEdge=function(a){var b=this.config,c=this.media;if(c){var d=this.hls.liveSyncPosition,e=c.currentTime,f=a.fragments[0].start,g=a.edge,h=e>=f-b.maxFragLookUpTolerance&&e<=g;if(null!==d&&c.duration>d&&(e<d||!h)){var i=void 0!==b.liveMaxLatencyDuration?b.liveMaxLatencyDuration:b.liveMaxLatencyDurationCount*a.targetduration;(!h&&c.readyState<4||e<g-i)&&(this.loadedmetadata||(this.nextLoadPosition=d),c.readyState&&(this.warn("Playback: "+e.toFixed(3)+" is located too far from the end of live sliding playlist: "+g+", reset currentTime to : "+d.toFixed(3)),c.currentTime=d))}}},z.alignPlaylists=function(a,b){var c=this.levels,e=this.levelLastLoaded,f=this.fragPrevious,g=null!==e?c[e]:null,h=a.fragments.length;if(!h)return this.warn("No fragments in live playlist"),0;var i=a.fragments[0].start,j=a.alignedSliding&&Object(d.isFiniteNumber)(i);if(!b|| !j&&!i){Object(m.alignStream)(f,g,a);var k=a.fragments[0].start;return this.log("Live playlist sliding: "+k.toFixed(2)+" start-sn: "+(b?b.startSN:"na")+"->"+a.startSN+" prev-sn: "+(f?f.sn:"na")+" fragments: "+h),k}return i},z.waitForCdnTuneIn=function(a){return a.live&&a.canBlockReload&&a.tuneInGoal>Math.max(a.partHoldBack,3*a.partTarget)},z.setStartPosition=function(a,b){var c=this.startPosition;if(c<b&&(c=-1),-1===c|| -1===this.lastCurrentTime){var e=a.startTimeOffset;Object(d.isFiniteNumber)(e)?(c=b+e,e<0&&(c+=a.totalduration),c=Math.min(Math.max(b,c),b+a.totalduration),this.log("Start time offset "+e+" found in playlist, adjust startPosition to "+c),this.startPosition=c):a.live?c=this.hls.liveSyncPosition||b:this.startPosition=c=0,this.lastCurrentTime=c}this.nextLoadPosition=c},z.getLoadPosition=function(){var a=this.media,b=0;return this.loadedmetadata&&a?b=a.currentTime:this.nextLoadPosition&&(b=this.nextLoadPosition),b},z.handleFragLoadAborted=function(a,b){this.transmuxer&&"initSegment"!==a.sn&&a.stats.aborted&&(this.warn("Fragment "+a.sn+(b?" part"+b.index:"")+" of level "+a.level+" was aborted"),this.resetFragmentLoading(a))},z.resetFragmentLoading=function(a){this.fragCurrent&&this.fragContextChanged(a)||(this.state=v.IDLE)},z.onFragmentOrKeyLoadError=function(a,b){if(!b.fatal){var c=b.frag;if(c&&c.type===a){var d=this.fragCurrent;console.assert(d&&c.sn===d.sn&&c.level===d.level&&c.urlId===d.urlId,"Frag load error must match current frag to retry");var e=this.config;if(this.fragLoadError+1<=e.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(c.level))return;var f=Math.min(Math.pow(2,this.fragLoadError)*e.fragLoadingRetryDelay,e.fragLoadingMaxRetryTimeout);this.warn("Fragment "+c.sn+" of "+a+" "+c.level+" failed to load, retrying in "+f+"ms"),this.retryDate=self.performance.now()+f,this.fragLoadError++,this.state=v.FRAG_LOADING_WAITING_RETRY}else b.levelRetry?(a===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=v.IDLE):(h.logger.error(b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.hls.stopLoad(),this.state=v.ERROR)}}},z.afterBufferFlushed=function(a,b,c){if(a){var d=g.BufferHelper.getBuffered(a);this.fragmentTracker.detectEvictedFragments(b,d,c),this.state===v.ENDED&&this.resetLoadingState()}},z.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=v.IDLE},z.resetLiveStartWhenNotLoaded=function(a){if(!this.loadedmetadata){this.startFragRequested=!1;var b=this.levels?this.levels[a].details:null;if(null!=b&&b.live)return this.startPosition=-1,this.setStartPosition(b,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},z.updateLevelTiming=function(a,b,c,d){var e=this,f=c.details;console.assert(!!f,"level.details must be defined"),Object.keys(a.elementaryStreams).reduce(function(b,g){var h=a.elementaryStreams[g];if(h){var j=h.endPTS-h.startPTS;if(j<=0)return e.warn("Could not parse fragment "+a.sn+" "+g+" duration reliably ("+j+") resetting transmuxer to fallback to playlist timing"),e.resetTransmuxer(),b||!1;var k=d?0:Object(o.updateFragPTSDTS)(f,a,h.startPTS,h.endPTS,h.startDTS,h.endDTS);return e.hls.trigger(i.Events.LEVEL_PTS_UPDATED,{details:f,level:c,drift:k,type:g,frag:a,start:h.startPTS,end:h.endPTS}),!0}return b},!1)?(this.state=v.PARSED,this.hls.trigger(i.Events.FRAG_PARSED,{frag:a,part:b})):this.resetLoadingState()},z.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},w=b,x=[{key:"state",get:function(){return this._state},set:function(a){var b=this._state;b!==a&&(this._state=a,this.log(b+"->"+a))}}],t(w.prototype,x),y&&t(w,y),b}(e.default)},"./src/controller/buffer-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return n});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g=c(/*! ../errors */ "./src/errors.ts"),h=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),i=c(/*! ../utils/mediasource-helper */ "./src/utils/mediasource-helper.ts"),j=c(/*! ../loader/fragment */ "./src/loader/fragment.ts"),k=c(/*! ./buffer-operation-queue */ "./src/controller/buffer-operation-queue.ts"),l=Object(i.getMediaSource)(),m=/([ha]vc.)(?:\.[^.,]+)+/,n=function(){function a(a){var b=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=b.hls,c=b.media,d=b.mediaSource;f.logger.log("[buffer-controller]: Media source opened"),c&&(b.updateMediaElementDuration(),a.trigger(e.Events.MEDIA_ATTACHED,{media:c})),d&&d.removeEventListener("sourceopen",b._onMediaSourceOpen),b.checkPendingTracks()},this._onMediaSourceClose=function(){f.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){f.logger.log("[buffer-controller]: Media source ended")},this.hls=a,this._initSourceBuffer(),this.registerListeners()}var b=a.prototype;return b.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},b.destroy=function(){this.unregisterListeners(),this.details=null},b.registerListeners=function(){var a=this.hls;a.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(e.Events.BUFFER_RESET,this.onBufferReset,this),a.on(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.on(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(e.Events.BUFFER_EOS,this.onBufferEos,this),a.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.on(e.Events.FRAG_PARSED,this.onFragParsed,this),a.on(e.Events.FRAG_CHANGED,this.onFragChanged,this)},b.unregisterListeners=function(){var a=this.hls;a.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(e.Events.BUFFER_RESET,this.onBufferReset,this),a.off(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.off(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(e.Events.BUFFER_EOS,this.onBufferEos,this),a.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.off(e.Events.FRAG_PARSED,this.onFragParsed,this),a.off(e.Events.FRAG_CHANGED,this.onFragChanged,this)},b._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new k.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},b.onManifestParsed=function(a,b){var c=2;(!b.audio||b.video)&&b.altAudio||(c=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=c,this.details=null,f.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},b.onMediaAttaching=function(a,b){var c=this.media=b.media;if(c&&l){var d=this.mediaSource=new l;d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),c.src=self.URL.createObjectURL(d),this._objectUrl=c.src}},b.onMediaDetaching=function(){var a=this.media,b=this.mediaSource,c=this._objectUrl;if(b){if(f.logger.log("[buffer-controller]: media source detaching"),"open"===b.readyState)try{b.endOfStream()}catch(d){f.logger.warn("[buffer-controller]: onMediaDetaching: "+d.message+" while calling endOfStream")}this.onBufferReset(),b.removeEventListener("sourceopen",this._onMediaSourceOpen),b.removeEventListener("sourceended",this._onMediaSourceEnded),b.removeEventListener("sourceclose",this._onMediaSourceClose),a&&(c&&self.URL.revokeObjectURL(c),a.src===c?(a.removeAttribute("src"),a.load()):f.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(e.Events.MEDIA_DETACHED,void 0)},b.onBufferReset=function(){var a=this;this.getSourceBufferTypes().forEach(function(b){var c=a.sourceBuffer[b];try{c&&(a.removeBufferListeners(b),a.mediaSource&&a.mediaSource.removeSourceBuffer(c),a.sourceBuffer[b]=void 0)}catch(d){f.logger.warn("[buffer-controller]: Failed to reset the "+b+" buffer",d)}}),this._initSourceBuffer()},b.onBufferCodecs=function(a,b){var c=this,d=this.getSourceBufferTypes().length;Object.keys(b).forEach(function(a){if(d){var e=c.tracks[a];if(e&&"function"==typeof e.buffer.changeType){var f=b[a],g=f.codec,h=f.levelCodec,i=f.container,j=(e.levelCodec||e.codec).replace(m,"$1"),k=(h||g).replace(m,"$1");if(j!==k){var l=i+";codecs="+(h||g);c.appendChangeType(a,l)}}}else c.pendingTracks[a]=b[a]}),!d&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},b.appendChangeType=function(a,b){var c=this,d=this.operationQueue;d.append({execute:function(){var e=c.sourceBuffer[a];e&&(f.logger.log("[buffer-controller]: changing "+a+" sourceBuffer type to "+b),e.changeType(b)),d.shiftAndExecuteNext(a)},onStart:function(){},onComplete:function(){},onError:function(b){f.logger.warn("[buffer-controller]: Failed to change "+a+" SourceBuffer type",b)}},a)},b.onBufferAppending=function(a,b){var c=this,d=this.hls,i=this.operationQueue,j=this.tracks,k=b.data,l=b.type,m=b.frag,n=b.part,o=b.chunkMeta,p=o.buffering[l],q=self.performance.now();p.start=q;var r=m.stats.buffering,s=n?n.stats.buffering:null;0===r.start&&(r.start=q),s&&0===s.start&&(s.start=q);var t=j.audio,u="audio"===l&&1===o.id&&(null==t?void 0:t.container)==="audio/mpeg";i.append({execute:function(){if(p.executeStart=self.performance.now(),u){var a=c.sourceBuffer[l];if(a){var b=m.start-a.timestampOffset;Math.abs(b)>=.1&&(f.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+m.start+" (delta: "+b+") sn: "+m.sn+")"),a.timestampOffset=m.start)}}c.appendExecutor(k,l)},onStart:function(){},onComplete:function(){var a=self.performance.now();p.executeEnd=p.end=a,0===r.first&&(r.first=a),s&&0===s.first&&(s.first=a);var b=c.sourceBuffer,d={};for(var f in b)d[f]=h.BufferHelper.getBuffered(b[f]);c.appendError=0,c.hls.trigger(e.Events.BUFFER_APPENDED,{type:l,frag:m,part:n,chunkMeta:o,parent:m.type,timeRanges:d})},onError:function(a){f.logger.error("[buffer-controller]: Error encountered while trying to append to the "+l+" SourceBuffer",a);var b={type:g.ErrorTypes.MEDIA_ERROR,parent:m.type,details:g.ErrorDetails.BUFFER_APPEND_ERROR,err:a,fatal:!1};a.code===DOMException.QUOTA_EXCEEDED_ERR?b.details=g.ErrorDetails.BUFFER_FULL_ERROR:(c.appendError++,b.details=g.ErrorDetails.BUFFER_APPEND_ERROR,c.appendError>d.config.appendErrorMaxRetry&&(f.logger.error("[buffer-controller]: Failed "+d.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),b.fatal=!0)),d.trigger(e.Events.ERROR,b)}},l)},b.onBufferFlushing=function(a,b){var c=this,d=this.operationQueue,g=function(a){return{execute:c.removeExecutor.bind(c,a,b.startOffset,b.endOffset),onStart:function(){},onComplete:function(){c.hls.trigger(e.Events.BUFFER_FLUSHED,{type:a})},onError:function(b){f.logger.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",b)}}};b.type?d.append(g(b.type),b.type):this.getSourceBufferTypes().forEach(function(a){d.append(g(a),a)})},b.onFragParsed=function(a,b){var c=this,d=b.frag,g=b.part,h=[],i=g?g.elementaryStreams:d.elementaryStreams;i[j.ElementaryStreamTypes.AUDIOVIDEO]?h.push("audiovideo"):(i[j.ElementaryStreamTypes.AUDIO]&&h.push("audio"),i[j.ElementaryStreamTypes.VIDEO]&&h.push("video"));var k=function(){var a=self.performance.now();d.stats.buffering.end=a,g&&(g.stats.buffering.end=a);var b=g?g.stats:d.stats;c.hls.trigger(e.Events.FRAG_BUFFERED,{frag:d,part:g,stats:b,id:d.type})};0===h.length&&f.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+d.type+" level: "+d.level+" sn: "+d.sn),this.blockBuffers(k,h)},b.onFragChanged=function(a,b){this.flushBackBuffer()},b.onBufferEos=function(a,b){var c=this;this.getSourceBufferTypes().reduce(function(a,d){var e=c.sourceBuffer[d];return b.type&&b.type!==d|| !e||e.ended||(e.ended=!0,f.logger.log("[buffer-controller]: "+d+" sourceBuffer now EOS")),a&&!!(!e||e.ended)},!0)&&this.blockBuffers(function(){var a=c.mediaSource;a&&"open"===a.readyState&&a.endOfStream()})},b.onLevelUpdated=function(a,b){var c=b.details;c.fragments.length&&(this.details=c,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},b.flushBackBuffer=function(){var a=this.hls,b=this.details,c=this.media,f=this.sourceBuffer;if(c&&null!==b){var g=this.getSourceBufferTypes();if(g.length){var i=b.live&&null!==a.config.liveBackBufferLength?a.config.liveBackBufferLength:a.config.backBufferLength;if(Object(d.isFiniteNumber)(i)&&!(i<0)){var j=c.currentTime,k=b.levelTargetDuration,l=Math.floor(j/k)*k-Math.max(i,k);g.forEach(function(c){var d=f[c];if(d){var g=h.BufferHelper.getBuffered(d);g.length>0&&l>g.start(0)&&(a.trigger(e.Events.BACK_BUFFER_REACHED,{bufferEnd:l}),b.live&&a.trigger(e.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l}),a.trigger(e.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:l,type:c}))}})}}}},b.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var a=this.details,b=this.hls,c=this.media,e=this.mediaSource,g=a.fragments[0].start+a.totalduration,h=c.duration,i=Object(d.isFiniteNumber)(e.duration)?e.duration:0;a.live&&b.config.liveDurationInfinity?(f.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),e.duration=1/0,this.updateSeekableRange(a)):(g>i&&g>h||!Object(d.isFiniteNumber)(h))&&(f.logger.log("[buffer-controller]: Updating Media Source duration to "+g.toFixed(3)),e.duration=g)}},b.updateSeekableRange=function(a){var b=this.mediaSource,c=a.fragments;if(c.length&&a.live&&null!=b&&b.setLiveSeekableRange){var d=Math.max(0,c[0].start),e=Math.max(d,d+a.totalduration);b.setLiveSeekableRange(d,e)}},b.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,b=this.operationQueue,c=this.pendingTracks,d=Object.keys(c).length;if(d&&!a||2===d){this.createSourceBuffers(c),this.pendingTracks={};var f=this.getSourceBufferTypes();if(0===f.length){this.hls.trigger(e.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}f.forEach(function(a){b.executeNext(a)})}},b.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");var d=0;for(var h in a)if(!b[h]){var i=a[h];if(!i)throw Error("source buffer exists for track "+h+", however track does not");var j=i.levelCodec||i.codec,k=i.container+";codecs="+j;f.logger.log("[buffer-controller]: creating sourceBuffer("+k+")");try{var l=b[h]=c.addSourceBuffer(k),m=h;this.addBufferListener(m,"updatestart",this._onSBUpdateStart),this.addBufferListener(m,"updateend",this._onSBUpdateEnd),this.addBufferListener(m,"error",this._onSBUpdateError),this.tracks[h]={buffer:l,codec:j,container:i.container,levelCodec:i.levelCodec,id:i.id},d++}catch(n){f.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+n.message),this.hls.trigger(e.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:n,mimeType:k})}}d&&this.hls.trigger(e.Events.BUFFER_CREATED,{tracks:this.tracks})},b._onSBUpdateStart=function(a){this.operationQueue.current(a).onStart()},b._onSBUpdateEnd=function(a){var b=this.operationQueue;b.current(a).onComplete(),b.shiftAndExecuteNext(a)},b._onSBUpdateError=function(a,b){f.logger.error("[buffer-controller]: "+a+" SourceBuffer error",b),this.hls.trigger(e.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var c=this.operationQueue.current(a);c&&c.onError(b)},b.removeExecutor=function(a,b,c){var e=this.media,g=this.mediaSource,h=this.operationQueue,i=this.sourceBuffer[a];if(!e||!g||!i){f.logger.warn("[buffer-controller]: Attempting to remove from the "+a+" SourceBuffer, but it does not exist"),h.shiftAndExecuteNext(a);return}var j=Object(d.isFiniteNumber)(e.duration)?e.duration:1/0,k=Object(d.isFiniteNumber)(g.duration)?g.duration:1/0,l=Math.max(0,b),m=Math.min(c,j,k);m>l?(f.logger.log("[buffer-controller]: Removing ["+l+","+m+"] from the "+a+" SourceBuffer"),console.assert(!i.updating,a+" sourceBuffer must not be updating"),i.remove(l,m)):h.shiftAndExecuteNext(a)},b.appendExecutor=function(a,b){var c=this.operationQueue,d=this.sourceBuffer[b];if(!d){f.logger.warn("[buffer-controller]: Attempting to append to the "+b+" SourceBuffer, but it does not exist"),c.shiftAndExecuteNext(b);return}d.ended=!1,console.assert(!d.updating,b+" sourceBuffer must not be updating"),d.appendBuffer(a)},b.blockBuffers=function(a,b){var c=this;if(void 0===b&&(b=this.getSourceBufferTypes()),!b.length){f.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(a);return}var d=this.operationQueue;Promise.all(b.map(function(a){return d.appendBlocker(a)})).then(function(){a(),b.forEach(function(a){var b=c.sourceBuffer[a];b&&b.updating||d.shiftAndExecuteNext(a)})})},b.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},b.addBufferListener=function(a,b,c){var d=this.sourceBuffer[a];if(d){var e=c.bind(this,a);this.listeners[a].push({event:b,listener:e}),d.addEventListener(b,e)}},b.removeBufferListeners=function(a){var b=this.sourceBuffer[a];b&&this.listeners[a].forEach(function(a){b.removeEventListener(a.event,a.listener)})},a}()},"./src/controller/buffer-operation-queue.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return e});var d=c(/*! ../utils/logger */ "./src/utils/logger.ts"),e=function(){function a(a){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=a}var b=a.prototype;return b.append=function(a,b){var c=this.queues[b];c.push(a),1===c.length&&this.buffers[b]&&this.executeNext(b)},b.insertAbort=function(a,b){this.queues[b].unshift(a),this.executeNext(b)},b.appendBlocker=function(a){var b,c=new Promise(function(a){b=a}),d={execute:b,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(d,a),c},b.executeNext=function(a){var b=this.buffers,c=this.queues,e=b[a],f=c[a];if(f.length){var g=f[0];try{g.execute()}catch(h){d.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(h),e&&e.updating||(f.shift(),this.executeNext(a))}}},b.shiftAndExecuteNext=function(a){this.queues[a].shift(),this.executeNext(a)},b.current=function(a){return this.queues[a][0]},a}()},"./src/controller/cap-level-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../events */ "./src/events.ts");function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var f=function(){function a(a){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=a,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b,c,f,g=a.prototype;return g.setStreamController=function(a){this.streamController=a},g.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},g.registerListeners=function(){var a=this.hls;a.on(d.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),a.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(d.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.unregisterListener=function(){var a=this.hls;a.off(d.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),a.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(d.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.onFpsDropLevelCapping=function(b,c){a.isLevelAllowed(c.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(c.droppedLevel)},g.onMediaAttaching=function(a,b){this.media=b.media instanceof HTMLVideoElement?b.media:null},g.onManifestParsed=function(a,b){var c=this.hls;this.restrictedLevels=[],this.firstLevel=b.firstLevel,c.config.capLevelToPlayerSize&&b.video&&this.startCapping()},g.onBufferCodecs=function(a,b){this.hls.config.capLevelToPlayerSize&&b.video&&this.startCapping()},g.onMediaDetaching=function(){this.stopCapping()},g.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var a=this.hls.levels;if(a.length){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a.length-1),b.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},g.getMaxLevel=function(b){var c=this,d=this.hls.levels;if(!d.length)return -1;var e=d.filter(function(d,e){return a.isLevelAllowed(e,c.restrictedLevels)&&e<=b});return this.clientRect=null,a.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},g.startCapping=function(){!this.timer&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},g.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},g.getDimensions=function(){if(this.clientRect)return this.clientRect;var a=this.media,b={width:0,height:0};if(a){var c=a.getBoundingClientRect();b.width=c.width,b.height=c.height,b.width||b.height||(b.width=c.right-c.left||a.width||0,b.height=c.bottom-c.top||a.height||0)}return this.clientRect=b,b},a.isLevelAllowed=function(a,b){return void 0===b&&(b=[]),-1===b.indexOf(a)},a.getMaxLevelByMediaSize=function(a,b,c){if(!a||!a.length)return -1;for(var d=a.length-1,e=0;e<a.length;e+=1){var f,g,h=a[e];if((h.width>=b||h.height>=c)&&(f=h,!(g=a[e+1])||f.width!==g.width||f.height!==g.height)){d=e;break}}return d},b=a,c=[{key:"mediaWidth",get:function(){return this.getDimensions().width*a.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*a.contentScaleFactor}}],f=[{key:"contentScaleFactor",get:function(){var a=1;try{a=self.devicePixelRatio}catch(b){}return a}}],c&&e(b.prototype,c),f&&e(b,f),a}();b.default=f},"./src/controller/cmcd-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return n});var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../types/cmcd */ "./src/types/cmcd.ts"),f=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts");function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b,c){return b&&h(a.prototype,b),c&&h(a,c),a}function j(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(c)return(c=c.call(a)).next.bind(c);if(Array.isArray(a)||(c=k(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0;return function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(a,b){if(a){if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}}function l(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function m(){return(m=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}var n=function(){function a(b){var c=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){c.initialized&&(c.starved=!0),c.buffering=!0},this.onPlaying=function(){c.initialized||(c.initialized=!0),c.buffering=!1},this.applyPlaylistData=function(a){try{c.apply(a,{ot:e.CMCDObjectType.MANIFEST,su:!c.initialized})}catch(b){g.logger.warn("Could not generate manifest CMCD data.",b)}},this.applyFragmentData=function(a){try{var b=a.frag,d=c.hls.levels[b.level],f=c.getObjectType(b),h={d:1e3*b.duration,ot:f};(f===e.CMCDObjectType.VIDEO||f===e.CMCDObjectType.AUDIO||f==e.CMCDObjectType.MUXED)&&(h.br=d.bitrate/1e3,h.tb=c.getTopBandwidth(f)/1e3,h.bl=c.getBufferLength(f)),c.apply(a,h)}catch(i){g.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=b;var d=this.config=b.config,f=d.cmcd;null!=f&&(d.pLoader=this.createPlaylistLoader(),d.fLoader=this.createFragmentLoader(),this.sid=f.sessionId||a.uuid(),this.cid=f.contentId,this.useHeaders=!0===f.useHeaders,this.registerListeners())}var b=a.prototype;return b.registerListeners=function(){var a=this.hls;a.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(d.Events.MEDIA_DETACHED,this.onMediaDetached,this),a.on(d.Events.BUFFER_CREATED,this.onBufferCreated,this)},b.unregisterListeners=function(){var a=this.hls;a.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(d.Events.MEDIA_DETACHED,this.onMediaDetached,this),a.off(d.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},b.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},b.onMediaAttached=function(a,b){this.media=b.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},b.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},b.onBufferCreated=function(a,b){var c,d;this.audioBuffer=null===(c=b.tracks.audio)|| void 0===c?void 0:c.buffer,this.videoBuffer=null===(d=b.tracks.video)|| void 0===d?void 0:d.buffer},b.createData=function(){var a;return{v:e.CMCDVersion,sf:e.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(a=this.media)|| void 0===a?void 0:a.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},b.apply=function(b,c){void 0===c&&(c={}),m(c,this.createData());var d=c.ot===e.CMCDObjectType.INIT||c.ot===e.CMCDObjectType.VIDEO||c.ot===e.CMCDObjectType.MUXED;if(this.starved&&d&&(c.bs=!0,c.su=!0,this.starved=!1),null==c.su&&(c.su=this.buffering),this.useHeaders){var f=a.toHeaders(c);if(!Object.keys(f).length)return;b.headers||(b.headers={}),m(b.headers,f)}else{var g=a.toQuery(c);if(!g)return;b.url=a.appendQueryToUri(b.url,g)}},b.getObjectType=function(a){var b=a.type;return"subtitle"===b?e.CMCDObjectType.TIMED_TEXT:"initSegment"===a.sn?e.CMCDObjectType.INIT:"audio"===b?e.CMCDObjectType.AUDIO:"main"===b?this.hls.audioTracks.length?e.CMCDObjectType.VIDEO:e.CMCDObjectType.MUXED:void 0},b.getTopBandwidth=function(a){var b=0,c=this.hls;if(a===e.CMCDObjectType.AUDIO)g=c.audioTracks;else{var d=c.maxAutoLevel,f=d> -1?d+1:c.levels.length;g=c.levels.slice(0,f)}for(var g,h,i=j(g);!(h=i()).done;){var k=h.value;k.bitrate>b&&(b=k.bitrate)}return b>0?b:NaN},b.getBufferLength=function(a){var b=this.hls.media,c=a===e.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return c&&b?1e3*f.BufferHelper.bufferInfo(c,b.currentTime,this.config.maxBufferHole).len:NaN},b.createPlaylistLoader=function(){var a=this.config.pLoader,b=this.applyPlaylistData,c=a||this.config.loader;return function(){function a(a){this.loader=void 0,this.loader=new c(a)}var d=a.prototype;return d.destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(a,c,d){b(a),this.loader.load(a,c,d)},i(a,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),a}()},b.createFragmentLoader=function(){var a=this.config.fLoader,b=this.applyFragmentData,c=a||this.config.loader;return function(){function a(a){this.loader=void 0,this.loader=new c(a)}var d=a.prototype;return d.destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(a,c,d){b(a),this.loader.load(a,c,d)},i(a,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),a}()},a.uuid=function(){var a=URL.createObjectURL(new Blob),b=a.toString();return URL.revokeObjectURL(a),b.substr(b.lastIndexOf("/")+1)},a.serialize=function(a){for(var b,c=[],d=function(a){return Math.round(a)},e=function(a){return 100*d(a/100)},f=function(a){return encodeURIComponent(a)},g={br:d,d:d,bl:e,dl:e,mtp:e,nor:f,rtp:e,tb:d},h=Object.keys(a||{}).sort(),i=j(h);!(b=i()).done;){var k,l=b.value,m=a[l];if(!Number.isNaN(k=m)&&null!=k&&""!==k&& !1!==k&&("v"!==l||1!==m)&&("pr"!=l||1!==m)){var n=g[l];n&&(m=n(m));var o=typeof m,p=void 0;p="ot"===l||"sf"===l||"st"===l?l+"="+m:"boolean"===o?l:"number"===o?l+"="+m:l+"="+JSON.stringify(m),c.push(p)}}return c.join(",")},a.toHeaders=function(b){for(var c=Object.keys(b),d={},e=["Object","Request","Session","Status"],f=[{},{},{},{}],g={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},h=0,i=c;h<i.length;h++){var j=i[h];f[null!=g[j]?g[j]:1][j]=b[j]}for(var k=0;k<f.length;k++){var l=a.serialize(f[k]);l&&(d["CMCD-"+e[k]]=l)}return d},a.toQuery=function(b){return"CMCD="+encodeURIComponent(a.serialize(b))},a.appendQueryToUri=function(a,b){if(!b)return a;var c=a.includes("?")?"&":"?";return""+a+c+b},a}()},"./src/controller/eme-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../errors */ "./src/errors.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g=c(/*! ../utils/mediakeys-helper */ "./src/utils/mediakeys-helper.ts");function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var i=function(a,b,c){var d={audioCapabilities:[],videoCapabilities:[]};return a.forEach(function(a){d.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:c.audioRobustness||""})}),b.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:c.videoRobustness||""})}),[d]},j=function(a,b,c,d){if(a===g.KeySystems.WIDEVINE)return i(b,c,d);throw Error("Unknown key-system: "+a)},k=function(){function a(a){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=a,this._config=a.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var b,c,i,k=a.prototype;return k.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},k._registerListeners=function(){this.hls.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(d.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(d.Events.MANIFEST_PARSED,this.onManifestParsed,this)},k._unregisterListeners=function(){this.hls.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(d.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(d.Events.MANIFEST_PARSED,this.onManifestParsed,this)},k.getLicenseServerUrl=function(a){switch(a){case g.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw Error('no license server URL configured for key-system "'+a+'"')},k._attemptKeySystemAccess=function(a,b,c){var d=this,e=j(a,b,c,this._drmSystemOptions);f.logger.log("Requesting encrypted media key-system access");var g=this.requestMediaKeySystemAccess(a,e);this.mediaKeysPromise=g.then(function(b){return d._onMediaKeySystemAccessObtained(a,b)}),g.catch(function(b){f.logger.error('Failed to obtain key-system "'+a+'" access:',b)})},k._onMediaKeySystemAccessObtained=function(a,b){var c=this;f.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:b,mediaKeySystemDomain:a};this._mediaKeysList.push(d);var e=Promise.resolve().then(function(){return b.createMediaKeys()}).then(function(b){return d.mediaKeys=b,f.logger.log('Media-keys created for key-system "'+a+'"'),c._onMediaKeysCreated(),b});return e.catch(function(a){f.logger.error("Failed to create media-keys:",a)}),e},k._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),a._onNewMediaKeySession(b.mediaKeysSession))})},k._onNewMediaKeySession=function(a){var b=this;f.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)},k._onKeySessionMessage=function(a,b){f.logger.log("Got EME message event, creating license request"),this._requestLicense(b,function(b){f.logger.log("Received license data (length: "+(b?b.byteLength:b)+"), updating key-session"),a.update(b)})},k.onMediaEncrypted=function(a){var b=this;if(f.logger.log('Media is encrypted using "'+a.initDataType+'" init data type'),!this.mediaKeysPromise){f.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var c=function(c){b._media&&(b._attemptSetMediaKeys(c),b._generateRequestWithPreferredKeySession(a.initDataType,a.initData))};this.mediaKeysPromise.then(c).catch(c)},k._attemptSetMediaKeys=function(a){if(!this._media)throw Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var b=this._mediaKeysList[0];if(!b||!b.mediaKeys){f.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}f.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(b.mediaKeys),this._hasSetMediaKeys=!0}},k._generateRequestWithPreferredKeySession=function(a,b){var c=this,g=this._mediaKeysList[0];if(!g){f.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(g.mediaKeysSessionInitialized){f.logger.warn("Key-Session already initialized but requested again");return}var h=g.mediaKeysSession;if(!h){f.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!b){f.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}f.logger.log('Generating key-session request for "'+a+'" init data type'),g.mediaKeysSessionInitialized=!0,h.generateRequest(a,b).then(function(){f.logger.debug("Key-session generation succeeded")}).catch(function(a){f.logger.error("Error generating key-session request:",a),c.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},k._createLicenseXhr=function(a,b,c){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,a,b,c);var e=this._licenseXhrSetup;if(e)try{e.call(this.hls,d,a),e=void 0}catch(g){f.logger.error(g)}try{d.readyState||d.open("POST",a,!0),e&&e.call(this.hls,d,a)}catch(h){throw Error("issue setting up KeySystem license XHR "+h)}return d},k._onLicenseRequestReadyStageChange=function(a,b,c,g){if(4===a.readyState){if(200===a.status){this._requestLicenseFailureCount=0,f.logger.log("License request succeeded");var h=a.response,i=this._licenseResponseCallback;if(i)try{h=i.call(this.hls,a,b)}catch(j){f.logger.error(j)}g(h)}else{if(f.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3){this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var k=3-this._requestLicenseFailureCount+1;f.logger.warn("Retrying license request, "+k+" attempts left"),this._requestLicense(c,g)}}},k._generateLicenseRequestChallenge=function(a,b){if(a.mediaKeySystemDomain===g.KeySystems.WIDEVINE)return b;throw Error("unsupported key-system: "+a.mediaKeySystemDomain)},k._requestLicense=function(a,b){f.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c){f.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var g=this.getLicenseServerUrl(c.mediaKeySystemDomain),h=this._createLicenseXhr(g,a,b);f.logger.log("Sending license request to URL: "+g);var i=this._generateLicenseRequestChallenge(c,a);h.send(i)}catch(j){f.logger.error("Failure requesting DRM license: "+j),this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},k.onMediaAttached=function(a,b){if(this._emeEnabled){var c=b.media;this._media=c,c.addEventListener("encrypted",this._onMediaEncrypted)}},k.onMediaDetached=function(){var a=this._media,b=this._mediaKeysList;a&&(a.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(b.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return a.setMediaKeys(null)}).catch(function(){}))},k.onManifestParsed=function(a,b){if(this._emeEnabled){var c=b.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),d=b.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(g.KeySystems.WIDEVINE,c,d)}},b=a,c=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}],h(b.prototype,c),i&&h(b,i),a}();b.default=k},"./src/controller/fps-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../utils/logger */ "./src/utils/logger.ts"),f=function(){function a(a){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=a,this.registerListeners()}var b=a.prototype;return b.setStreamController=function(a){this.streamController=a},b.registerListeners=function(){this.hls.on(d.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(d.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(a,b){var c=this.hls.config;if(c.capLevelOnFPSDrop){var d=b.media instanceof self.HTMLVideoElement?b.media:null;this.media=d,d&&"function"==typeof d.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),c.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(a,b,c){var f=performance.now();if(b){if(this.lastTime){var g=f-this.lastTime,h=c-this.lastDroppedFrames,i=b-this.lastDecodedFrames,j=1e3*h/g,k=this.hls;if(k.trigger(d.Events.FPS_DROP,{currentDropped:h,currentDecoded:i,totalDroppedFrames:c}),j>0&&h>k.config.fpsDroppedMonitoringThreshold*i){var l=k.currentLevel;e.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===k.autoLevelCapping||k.autoLevelCapping>=l)&&(l-=1,k.trigger(d.Events.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:k.currentLevel}),k.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=f,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.checkFPSInterval=function(){var a=this.media;if(a){if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)}},a}();b.default=f},"./src/controller/fragment-finders.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"findFragmentByPDT",function(){return f}),c.d(b,"findFragmentByPTS",function(){return g}),c.d(b,"fragmentWithinToleranceTest",function(){return h}),c.d(b,"pdtWithinToleranceTest",function(){return i}),c.d(b,"findFragWithCC",function(){return j});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../utils/binary-search */ "./src/utils/binary-search.ts");function f(a,b,c){if(null===b||!Array.isArray(a)||!a.length||!Object(d.isFiniteNumber)(b)||b<(a[0].programDateTime||0)||b>=(a[a.length-1].endProgramDateTime||0))return null;c=c||0;for(var e=0;e<a.length;++e){var f=a[e];if(i(b,c,f))return f}return null}function g(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0);var f=null;if(a?f=b[a.sn-b[0].sn+1]||null:0===c&&0===b[0].start&&(f=b[0]),f&&0===h(c,d,f))return f;var g=e.default.search(b,h.bind(null,c,d));return g||f}function h(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0);var d=Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-d<=a?1:c.start-d>a&&c.start?-1:0}function i(a,b,c){var d=1e3*Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0)),e=c.endProgramDateTime||0;return e-d>a}function j(a,b){return e.default.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}},"./src/controller/fragment-tracker.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"FragmentState",function(){return d}),c.d(b,"FragmentTracker",function(){return h});var d,e,f=c(/*! ../events */ "./src/events.ts"),g=c(/*! ../types/loader */ "./src/types/loader.ts");(e=d||(d={})).NOT_LOADED="NOT_LOADED",e.BACKTRACKED="BACKTRACKED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK";var h=function(){function a(a){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=a,this._registerListeners()}var b=a.prototype;return b._registerListeners=function(){var a=this.hls;a.on(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),a.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(f.Events.FRAG_LOADED,this.onFragLoaded,this)},b._unregisterListeners=function(){var a=this.hls;a.off(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),a.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(f.Events.FRAG_LOADED,this.onFragLoaded,this)},b.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},b.getAppendedFrag=function(a,b){if(b===g.PlaylistLevelType.MAIN){var c=this.activeFragment,d=this.activeParts;if(!c)return null;if(d)for(var e=d.length;e--;){var f=d[e],h=f?f.end:c.appendedPTS;if(f.start<=a&& void 0!==h&&a<=h)return e>9&&(this.activeParts=d.slice(e-9)),f}else if(c.start<=a&& void 0!==c.appendedPTS&&a<=c.appendedPTS)return c}return this.getBufferedFrag(a,b)},b.getBufferedFrag=function(a,b){for(var c=this.fragments,d=Object.keys(c),e=d.length;e--;){var f=c[d[e]];if((null==f?void 0:f.body.type)===b&&f.buffered){var g=f.body;if(g.start<=a&&a<=g.end)return g}}return null},b.detectEvictedFragments=function(a,b,c){var d=this;Object.keys(this.fragments).forEach(function(e){var f=d.fragments[e];if(f){if(!f.buffered){f.body.type===c&&d.removeFragment(f.body);return}var g=f.range[a];g&&g.time.some(function(a){var c=!d.isTimeBuffered(a.startPTS,a.endPTS,b);return c&&d.removeFragment(f.body),c})}})},b.detectPartialFragments=function(a){var b=this,c=this.timeRanges,d=a.frag,e=a.part;if(c&&"initSegment"!==d.sn){var f=j(d),g=this.fragments[f];g&&(Object.keys(c).forEach(function(a){var f=d.elementaryStreams[a];if(f){var h=c[a],i=null!==e|| !0===f.partial;g.range[a]=b.getBufferedTimes(d,e,i,h)}}),g.backtrack=g.loaded=null,Object.keys(g.range).length?g.buffered=!0:this.removeFragment(g.body))}},b.fragBuffered=function(a){var b=j(a),c=this.fragments[b];c&&(c.backtrack=c.loaded=null,c.buffered=!0)},b.getBufferedTimes=function(a,b,c,d){for(var e={time:[],partial:c},f=b?b.start:a.start,g=b?b.end:a.end,h=a.minEndPTS||g,i=a.maxStartPTS||f,j=0;j<d.length;j++){var k=d.start(j)-this.bufferPadding,l=d.end(j)+this.bufferPadding;if(i>=k&&h<=l){e.time.push({startPTS:Math.max(f,d.start(j)),endPTS:Math.min(g,d.end(j))});break}if(f<l&&g>k)e.partial=!0,e.time.push({startPTS:Math.max(f,d.start(j)),endPTS:Math.min(g,d.end(j))});else if(g<=k)break}return e},b.getPartialFragment=function(a){var b,c,d,e=null,f=0,g=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(j){var k=h[j];k&&i(k)&&(c=k.body.start-g,d=k.body.end+g,a>=c&&a<=d&&f<=(b=Math.min(a-c,d-a))&&(e=k.body,f=b))}),e},b.getState=function(a){var b=j(a),c=this.fragments[b];if(c){if(c.buffered)return i(c)?d.PARTIAL:(0,d.OK);return c.backtrack?d.BACKTRACKED:d.APPENDING}return d.NOT_LOADED},b.backtrack=function(a,b){var c=j(a),d=this.fragments[c];if(!d||d.backtrack)return null;var e=d.backtrack=b||d.loaded;return d.loaded=null,e},b.getBacktrackData=function(a){var b=j(a),c=this.fragments[b];if(c){var d,e=c.backtrack;if(null!=e&&null!==(d=e.payload)&& void 0!==d&&d.byteLength)return e;this.removeFragment(a)}return null},b.isTimeBuffered=function(a,b,c){for(var d,e,f=0;f<c.length;f++){if(d=c.start(f)-this.bufferPadding,e=c.end(f)+this.bufferPadding,a>=d&&b<=e)return!0;if(b<=d)break}return!1},b.onFragLoaded=function(a,b){var c=b.frag,d=b.part;if("initSegment"!==c.sn&&!c.bitrateTest&&!d){var e=j(c);this.fragments[e]={body:c,loaded:b,backtrack:null,buffered:!1,range:Object.create(null)}}},b.onBufferAppended=function(a,b){var c=this,d=b.frag,e=b.part,f=b.timeRanges;if(d.type===g.PlaylistLevelType.MAIN){if(this.activeFragment=d,e){var h=this.activeParts;h||(this.activeParts=h=[]),h.push(e)}else this.activeParts=null}this.timeRanges=f,Object.keys(f).forEach(function(a){var b=f[a];if(c.detectEvictedFragments(a,b),!e)for(var g=0;g<b.length;g++)d.appendedPTS=Math.max(b.end(g),d.appendedPTS||0)})},b.onFragBuffered=function(a,b){this.detectPartialFragments(b)},b.hasFragment=function(a){var b=j(a);return!!this.fragments[b]},b.removeFragmentsInRange=function(a,b,c){var d=this;Object.keys(this.fragments).forEach(function(e){var f=d.fragments[e];if(f&&f.buffered){var g=f.body;g.type===c&&g.start<b&&g.end>a&&d.removeFragment(g)}})},b.removeFragment=function(a){var b=j(a);a.stats.loaded=0,a.clearElementaryStreamInfo(),delete this.fragments[b]},b.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},a}();function i(a){var b,c;return a.buffered&&((null===(b=a.range.video)|| void 0===b?void 0:b.partial)||(null===(c=a.range.audio)|| void 0===c?void 0:c.partial))}function j(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn}},"./src/controller/gap-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"STALL_MINIMUM_DURATION_MS",function(){return h}),c.d(b,"MAX_START_GAP_JUMP",function(){return i}),c.d(b,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return j}),c.d(b,"SKIP_BUFFER_RANGE_START",function(){return k}),c.d(b,"default",function(){return l});var d=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),e=c(/*! ../errors */ "./src/errors.ts"),f=c(/*! ../events */ "./src/events.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h=250,i=2,j=.1,k=.05,l=function(){function a(a,b,c,d){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=a,this.media=b,this.fragmentTracker=c,this.hls=d}var b=a.prototype;return b.destroy=function(){this.hls=this.fragmentTracker=this.media=null},b.poll=function(a){var b=this.config,c=this.media,e=this.stalled,f=c.currentTime,j=c.seeking,k=this.seeking&&!j,l=!this.seeking&&j;if(this.seeking=j,f!==a){if(this.moved=!0,null!==e){if(this.stallReported){var m=self.performance.now()-e;g.logger.warn("playback not stuck anymore @"+f+", after "+Math.round(m)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((l||k)&&(this.stalled=null),!c.paused&&!c.ended&&0!==c.playbackRate&&d.BufferHelper.getBuffered(c).length){var n=d.BufferHelper.bufferInfo(c,f,0),o=n.len>0,p=n.nextStart||0;if(o||p){if(j){var q=n.len>i,r=!p||p-f>i&&!this.fragmentTracker.getPartialFragment(f);if(q||r)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var s,t=Math.max(p,n.start||0)-f,u=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,v=(null==u?void 0:null===(s=u.details)|| void 0===s?void 0:s.live)?2*u.details.targetduration:i;if(t>0&&t<=v){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(null===e){this.stalled=w;return}var x=w-e;!j&&x>=h&&this._reportStall(n.len);var y=d.BufferHelper.bufferInfo(c,f,b.maxBufferHole);this._tryFixBufferStall(y,x)}}},b._tryFixBufferStall=function(a,b){var c=this.config,d=this.fragmentTracker,e=this.media.currentTime,f=d.getPartialFragment(e);if(!(f&&this._trySkipBufferHole(f)))a.len>c.maxBufferHole&&b>1e3*c.highBufferWatchdogPeriod&&(g.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},b._reportStall=function(a){var b=this.hls,c=this.media;this.stallReported||(this.stallReported=!0,g.logger.warn("Playback stalling at @"+c.currentTime+" due to low buffer (buffer="+a+")"),b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},b._trySkipBufferHole=function(a){for(var b=this.config,c=this.hls,h=this.media,i=h.currentTime,l=0,m=d.BufferHelper.getBuffered(h),n=0;n<m.length;n++){var o=m.start(n);if(i+b.maxBufferHole>=l&&i<o){var p=Math.max(o+k,h.currentTime+j);return g.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+p),this.moved=!0,this.stalled=null,h.currentTime=p,a&&c.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+p,frag:a}),p}l=m.end(n)}return 0},b._tryNudgeBuffer=function(){var a=this.config,b=this.hls,c=this.media,d=c.currentTime,h=(this.nudgeRetry||0)+1;if(this.nudgeRetry=h,h<a.nudgeMaxRetry){var i=d+h*a.nudgeOffset;g.logger.warn("Nudging 'currentTime' from "+d+" to "+i),c.currentTime=i,b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else g.logger.error("Playhead still not moving while enough data buffered @"+d+" after "+a.nudgeMaxRetry+" nudges"),b.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},a}()},"./src/controller/id3-track-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../utils/texttrack-utils */ "./src/utils/texttrack-utils.ts"),f=c(/*! ../demux/id3 */ "./src/demux/id3.ts"),g=function(){function a(a){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=a,this._registerListeners()}var b=a.prototype;return b.destroy=function(){this._unregisterListeners()},b._registerListeners=function(){var a=this.hls;a.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(d.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},b._unregisterListeners=function(){var a=this.hls;a.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(d.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},b.onMediaAttached=function(a,b){this.media=b.media},b.onMediaDetaching=function(){this.id3Track&&(Object(e.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},b.getID3Track=function(a){if(this.media){for(var b=0;b<a.length;b++){var c=a[b];if("metadata"===c.kind&&"id3"===c.label)return Object(e.sendAddTrackEvent)(c,this.media),c}return this.media.addTextTrack("metadata","id3")}},b.onFragParsingMetadata=function(a,b){if(this.media){var c=b.frag,d=b.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var e=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,g=0;g<d.length;g++){var h=f.getID3Frames(d[g].data);if(h){var i=d[g].pts,j=g<d.length-1?d[g+1].pts:c.end;j-i<=0&&(j=i+.25);for(var k=0;k<h.length;k++){var l=h[k];if(!f.isTimeStampFrame(l)){var m=new e(i,j,"");m.value=l,this.id3Track.addCue(m)}}}}}},b.onBufferFlushing=function(a,b){var c=b.startOffset,d=b.endOffset,f=b.type;if(!f||"audio"===f){var g=this.id3Track;g&&Object(e.removeCuesInRange)(g,c,d)}},a}();b.default=g},"./src/controller/latency-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return h});var d=c(/*! ../errors */ "./src/errors.ts"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts");function g(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var h=function(){function a(a){var b=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return b.timeupdate()},this.hls=a,this.config=a.config,this.registerListeners()}var b,c,h,i=a.prototype;return i.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},i.registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(e.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(e.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(e.Events.ERROR,this.onError)},i.onMediaAttached=function(a,b){this.media=b.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},i.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},i.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},i.onLevelUpdated=function(a,b){var c=b.details;this.levelDetails=c,c.advanced&&this.timeupdate(),!c.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},i.onError=function(a,b){b.details===d.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,f.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},i.timeupdate=function(){var a=this.media,b=this.levelDetails;if(a&&b){this.currentTime=a.currentTime;var c=this.computeLatency();if(null!==c){this._latency=c;var d=this.config,e=d.lowLatencyMode,f=d.maxLiveSyncPlaybackRate;if(e&&1!==f){var g=this.targetLatency;if(null!==g){var h=c-g,i=Math.min(this.maxLatency,g+b.targetduration);if(b.live&&h<i&&h>.05&&this.forwardBufferLength>1){var j=Math.min(2,Math.max(1,f)),k=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;a.playbackRate=Math.min(j,Math.max(1,k))}else 1!==a.playbackRate&&0!==a.playbackRate&&(a.playbackRate=1)}}}}},i.estimateLiveEdge=function(){var a=this.levelDetails;return null===a?null:a.edge+a.age},i.computeLatency=function(){var a=this.estimateLiveEdge();return null===a?null:a-this.currentTime},b=a,c=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var a=this.config,b=this.levelDetails;return void 0!==a.liveMaxLatencyDuration?a.liveMaxLatencyDuration:b?a.liveMaxLatencyDurationCount*b.targetduration:0}},{key:"targetLatency",get:function(){var a=this.levelDetails;if(null===a)return null;var b=a.holdBack,c=a.partHoldBack,d=a.targetduration,e=this.config,f=e.liveSyncDuration,g=e.liveSyncDurationCount,h=e.lowLatencyMode,i=this.hls.userConfig,j=h&&c||b;return(i.liveSyncDuration||i.liveSyncDurationCount||0===j)&&(j=void 0!==f?f:g*d),j+Math.min(1*this.stallCount,d)}},{key:"liveSyncPosition",get:function(){var a=this.estimateLiveEdge(),b=this.targetLatency,c=this.levelDetails;if(null===a||null===b||null===c)return null;var d=c.edge,e=a-b-this.edgeStalled,f=d-c.totalduration,g=d-(this.config.lowLatencyMode&&c.partTarget||c.targetduration);return Math.min(Math.max(f,e),g)}},{key:"drift",get:function(){var a=this.levelDetails;return null===a?1:a.drift}},{key:"edgeStalled",get:function(){var a=this.levelDetails;if(null===a)return 0;var b=3*(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.max(a.age-b,0)}},{key:"forwardBufferLength",get:function(){var a=this.media,b=this.levelDetails;if(!a||!b)return 0;var c=a.buffered.length;return c?a.buffered.end(c-1):b.edge-this.currentTime}}],g(b.prototype,c),h&&g(b,h),a}()},"./src/controller/level-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return o});var d=c(/*! ../types/level */ "./src/types/level.ts"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../errors */ "./src/errors.ts"),g=c(/*! ../utils/codecs */ "./src/utils/codecs.ts"),h=c(/*! ./level-helper */ "./src/controller/level-helper.ts"),i=c(/*! ./base-playlist-controller */ "./src/controller/base-playlist-controller.ts"),j=c(/*! ../types/loader */ "./src/types/loader.ts");function k(){return(k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function l(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function m(a,b){return(m=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var n=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),o=function(a){function b(b){var c;return(c=a.call(this,b,"[level-controller]")||this)._levels=[],c._firstLevel=-1,c._startLevel=void 0,c.currentLevelIndex=-1,c.manualLevelIndex=-1,c.onParsedComplete=void 0,c._registerListeners(),c}c=b,i=a,c.prototype=Object.create(i.prototype),c.prototype.constructor=c,m(c,i);var c,i,o,p,q,r=b.prototype;return r._registerListeners=function(){var a=this.hls;a.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(e.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(e.Events.ERROR,this.onError,this)},r._unregisterListeners=function(){var a=this.hls;a.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(e.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(e.Events.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,a.prototype.destroy.call(this)},r.startLoad=function(){this._levels.forEach(function(a){a.loadError=0}),a.prototype.startLoad.call(this)},r.onManifestLoaded=function(a,b){var c,i,j=[],k=[],l=[],m={},o=!1,p=!1,q=!1;if(b.levels.forEach(function(a){var b=a.attrs;o=o||!!(a.width&&a.height),p=p||!!a.videoCodec,q=q||!!a.audioCodec,n&&a.audioCodec&& -1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0);var c=a.bitrate+"-"+a.attrs.RESOLUTION+"-"+a.attrs.CODECS;(i=m[c])?i.url.push(a.url):(i=new d.Level(a),m[c]=i,j.push(i)),b&&(b.AUDIO&&Object(h.addGroupId)(i,"audio",b.AUDIO),b.SUBTITLES&&Object(h.addGroupId)(i,"text",b.SUBTITLES))}),(o||p)&&q&&(j=j.filter(function(a){var b=a.videoCodec,c=a.width,d=a.height;return!!b||!!(c&&d)})),j=j.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||Object(g.isCodecSupportedInMp4)(b,"audio"))&&(!c||Object(g.isCodecSupportedInMp4)(c,"video"))}),b.audioTracks&&(k=b.audioTracks.filter(function(a){return!a.audioCodec||Object(g.isCodecSupportedInMp4)(a.audioCodec,"audio")}),Object(h.assignTrackIdsByGroup)(k)),b.subtitles&&(l=b.subtitles,Object(h.assignTrackIdsByGroup)(l)),j.length>0){c=j[0].bitrate,j.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=j;for(var r=0;r<j.length;r++)if(j[r].bitrate===c){this._firstLevel=r,this.log("manifest loaded, "+j.length+" level(s) found, first bitrate: "+c);break}var s=q&&!p,t={levels:j,audioTracks:k,subtitleTracks:l,firstLevel:this._firstLevel,stats:b.stats,audio:q,video:p,altAudio:!s&&k.some(function(a){return!!a.url})};this.hls.trigger(e.Events.MANIFEST_PARSED,t),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:b.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(b,c){if(a.prototype.onError.call(this,b,c),!c.fatal){var d,e=c.context,g=this._levels[this.currentLevelIndex];if(e&&(e.type===j.PlaylistContextType.AUDIO_TRACK&&g.audioGroupIds&&e.groupId===g.audioGroupIds[g.urlId]||e.type===j.PlaylistContextType.SUBTITLE_TRACK&&g.textGroupIds&&e.groupId===g.textGroupIds[g.urlId])){this.redundantFailover(this.currentLevelIndex);return}var h=!1,i=!0;switch(c.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:if(c.frag){var k=this._levels[c.frag.level];k?(k.fragmentError++,k.fragmentError>this.hls.config.fragLoadingMaxRetry&&(d=c.frag.level)):d=c.frag.level}break;case f.ErrorDetails.LEVEL_LOAD_ERROR:case f.ErrorDetails.LEVEL_LOAD_TIMEOUT:e&&(e.deliveryDirectives&&(i=!1),d=e.level),h=!0;break;case f.ErrorDetails.REMUX_ALLOC_ERROR:d=c.level,h=!0}void 0!==d&&this.recoverLevel(c,d,h,i)}},r.recoverLevel=function(a,b,c,d){var e=a.details,f=this._levels[b];if(f.loadError++,c){if(this.retryLoadingOrFail(a))a.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(d){var g=f.url.length;if(g>1&&f.loadError<g)a.levelRetry=!0,this.redundantFailover(b);else if(-1===this.manualLevelIndex){var h=0===b?this._levels.length-1:b-1;this.currentLevelIndex!==h&&0===this._levels[h].loadError&&(this.warn(e+": switch to "+h),a.levelRetry=!0,this.hls.nextAutoLevel=h)}}},r.redundantFailover=function(a){var b=this._levels[a],c=b.url.length;if(c>1){var d=(b.urlId+1)%c;this.warn("Switching to redundant URL-id "+d),this._levels.forEach(function(a){a.urlId=d}),this.level=a}},r.onFragLoaded=function(a,b){var c=b.frag;if(void 0!==c&&c.type===j.PlaylistLevelType.MAIN){var d=this._levels[c.level];void 0!==d&&(d.fragmentError=0,d.loadError=0)}},r.onLevelLoaded=function(a,b){var c,d,e=b.level,f=b.details,g=this._levels[e];if(!g){this.warn("Invalid level index "+e),null!==(d=b.deliveryDirectives)&& void 0!==d&&d.skip&&(f.deltaUpdateFailed=!0);return}e===this.currentLevelIndex?(0===g.fragmentError&&(g.loadError=0,this.retryCount=0),this.playlistLoaded(e,b,g.details)):null!==(c=b.deliveryDirectives)&& void 0!==c&&c.skip&&(f.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(a,b){var c=this.hls.levels[this.currentLevelIndex];if(c&&c.audioGroupIds){for(var d=-1,e=this.hls.audioTracks[b.id].groupId,f=0;f<c.audioGroupIds.length;f++)if(c.audioGroupIds[f]===e){d=f;break}d!==c.urlId&&(c.urlId=d,this.startLoad())}},r.loadPlaylist=function(a){var b=this.currentLevelIndex,c=this._levels[b];if(this.canLoad&&c&&c.url.length>0){var d=c.urlId,f=c.url[d];if(a)try{f=a.addDirectives(f)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Attempt loading level index "+b+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+d+" "+f),this.clearTimer(),this.hls.trigger(e.Events.LEVEL_LOADING,{url:f,level:b,id:d,deliveryDirectives:a||null})}},r.removeLevel=function(a,b){var c=function(a,c){return c!==b},d=this._levels.filter(function(d,e){return e!==a||d.url.length>1&& void 0!==b&&(d.url=d.url.filter(c),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(c)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(c)),d.urlId=0,!0)}).map(function(a,b){var c=a.details;return null!=c&&c.fragments&&c.fragments.forEach(function(a){a.level=b}),a});this._levels=d,this.hls.trigger(e.Events.LEVELS_UPDATED,{levels:d})},o=b,p=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var b,c=this._levels;if(0!==c.length&&(this.currentLevelIndex!==a||null===(b=c[a])|| void 0===b||!b.details)){if(a<0||a>=c.length){var d=a<0;if(this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:d,reason:"invalid level idx"}),d)return;a=Math.min(a,c.length-1)}this.clearTimer();var g=this.currentLevelIndex,h=c[g],i=c[a];this.log("switching to level "+a+" from "+g),this.currentLevelIndex=a;var j=k({},i,{level:a,maxBitrate:i.maxBitrate,uri:i.uri,urlId:i.urlId});delete j._urlId,this.hls.trigger(e.Events.LEVEL_SWITCHING,j);var l=i.details;if(!l||l.live){var m=this.switchParams(i.uri,null==h?void 0:h.details);this.loadPlaylist(m)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)}}],l(o.prototype,p),q&&l(o,q),b}(i.default)},"./src/controller/level-helper.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"addGroupId",function(){return f}),c.d(b,"assignTrackIdsByGroup",function(){return g}),c.d(b,"updatePTS",function(){return h}),c.d(b,"updateFragPTSDTS",function(){return j}),c.d(b,"mergeDetails",function(){return k}),c.d(b,"mapPartIntersection",function(){return l}),c.d(b,"mapFragmentIntersection",function(){return m}),c.d(b,"adjustSliding",function(){return n}),c.d(b,"addSliding",function(){return o}),c.d(b,"computeReloadInterval",function(){return p}),c.d(b,"getFragmentWithSN",function(){return q}),c.d(b,"getPartWith",function(){return r});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../utils/logger */ "./src/utils/logger.ts");function f(a,b,c){switch(b){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(c);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(c)}}function g(a){var b={};a.forEach(function(a){var c=a.groupId||"";a.id=b[c]=b[c]||0,b[c]++})}function h(a,b,c){var d=a[b],e=a[c];i(d,e)}function i(a,b){var c=b.startPTS;if(Object(d.isFiniteNumber)(c)){var e,f=0;b.sn>a.sn?(f=c-a.start,e=a):(f=a.start-c,e=b),e.duration!==f&&(e.duration=f)}else b.sn>a.sn?a.cc===b.cc&&a.minEndPTS?b.start=a.start+(a.minEndPTS-a.start):b.start=a.start+a.duration:b.start=Math.max(a.start-b.duration,0)}function j(a,b,c,f,g,h){f-c<=0&&(e.logger.warn("Fragment should have a positive duration",b),f=c+b.duration,h=g+b.duration);var j,k=c,l=f,m=b.startPTS,n=b.endPTS;if(Object(d.isFiniteNumber)(m)){var o=Math.abs(m-c);Object(d.isFiniteNumber)(b.deltaPTS)?b.deltaPTS=Math.max(o,b.deltaPTS):b.deltaPTS=o,k=Math.max(c,m),c=Math.min(c,m),g=Math.min(g,b.startDTS),l=Math.min(f,n),f=Math.max(f,n),h=Math.max(h,b.endDTS)}b.duration=f-c;var p=c-b.start;b.appendedPTS=f,b.start=b.startPTS=c,b.maxStartPTS=k,b.startDTS=g,b.endPTS=f,b.minEndPTS=l,b.endDTS=h;var q=b.sn;if(!a||q<a.startSN||q>a.endSN)return 0;var r=q-a.startSN,s=a.fragments;for(s[r]=b,j=r;j>0;j--)i(s[j],s[j-1]);for(j=r;j<s.length-1;j++)i(s[j],s[j+1]);return a.fragmentHint&&i(s[s.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,p}function k(a,b){for(var c,f=null,g=a.fragments,h=g.length-1;h>=0;h--){var i=g[h].initSegment;if(i){f=i;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var k=0;if(m(a,b,function(a,e){a.relurl&&(k=a.cc-e.cc),Object(d.isFiniteNumber)(a.startPTS)&&Object(d.isFiniteNumber)(a.endPTS)&&(e.start=e.startPTS=a.startPTS,e.startDTS=a.startDTS,e.appendedPTS=a.appendedPTS,e.maxStartPTS=a.maxStartPTS,e.endPTS=a.endPTS,e.endDTS=a.endDTS,e.minEndPTS=a.minEndPTS,e.duration=a.endPTS-a.startPTS,e.duration&&(c=e),b.PTSKnown=b.alignedSliding=!0),e.elementaryStreams=a.elementaryStreams,e.loader=a.loader,e.stats=a.stats,e.urlId=a.urlId,a.initSegment&&(e.initSegment=a.initSegment,f=a.initSegment)}),f&&(b.fragmentHint?b.fragments.concat(b.fragmentHint):b.fragments).forEach(function(a){var b;a.initSegment&&a.initSegment.relurl!==(null===(b=f)|| void 0===b?void 0:b.relurl)||(a.initSegment=f)}),b.skippedSegments&&(b.deltaUpdateFailed=b.fragments.some(function(a){return!a}),b.deltaUpdateFailed)){e.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var o=b.skippedSegments;o--;)b.fragments.shift();b.startSN=b.fragments[0].sn,b.startCC=b.fragments[0].cc}var p=b.fragments;if(k){e.logger.warn("discontinuity sliding from playlist, take drift into account");for(var q=0;q<p.length;q++)p[q].cc+=k}b.skippedSegments&&(b.startCC=b.fragments[0].cc),l(a.partList,b.partList,function(a,b){b.elementaryStreams=a.elementaryStreams,b.stats=a.stats}),c?j(b,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS):n(a,b),p.length&&(b.totalduration=b.edge-p[0].start),b.driftStartTime=a.driftStartTime,b.driftStart=a.driftStart;var r=b.advancedDateTime;if(b.advanced&&r){var s=b.edge;b.driftStart||(b.driftStartTime=r,b.driftStart=s),b.driftEndTime=r,b.driftEnd=s}else b.driftEndTime=a.driftEndTime,b.driftEnd=a.driftEnd,b.advancedDateTime=a.advancedDateTime}function l(a,b,c){if(a&&b)for(var d=0,e=0,f=a.length;e<=f;e++){var g=a[e],h=b[e+d];g&&h&&g.index===h.index&&g.fragment.sn===h.fragment.sn?c(g,h):d--}}function m(a,b,c){for(var d=b.skippedSegments,e=Math.max(a.startSN,b.startSN)-b.startSN,f=(a.fragmentHint?1:0)+(d?b.endSN:Math.min(a.endSN,b.endSN))-b.startSN,g=b.startSN-a.startSN,h=b.fragmentHint?b.fragments.concat(b.fragmentHint):b.fragments,i=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,j=e;j<=f;j++){var k=i[g+j],l=h[j];d&&!l&&j<d&&(l=b.fragments[j]=k),k&&l&&c(k,l)}}function n(a,b){var c=b.startSN+b.skippedSegments-a.startSN,d=a.fragments;!(c<0)&&!(c>=d.length)&&o(b,d[c].start)}function o(a,b){if(b){for(var c=a.fragments,d=a.skippedSegments;d<c.length;d++)c[d].start+=b;a.fragmentHint&&(a.fragmentHint.start+=b)}}function p(a,b){var c,d=1e3*a.levelTargetDuration,e=d/2,f=a.age,g=f>0&&f<3*d,h=b.loading.end-b.loading.start,i=a.availabilityDelay;return!1===a.updated?g?(c=Math.max(Math.min(e,2*h),333*a.misses),a.availabilityDelay=(a.availabilityDelay||0)+c):c=e:g?(i=Math.min(i||d/2,f),a.availabilityDelay=i,c=i+d-f):c=d-h,Math.round(c)}function q(a,b,c){if(!a||!a.details)return null;var d=a.details,e=d.fragments[b-d.startSN];return e||(e=d.fragmentHint)&&e.sn===b?e:b<d.startSN&&c&&c.sn===b?c:null}function r(a,b,c){if(!a||!a.details)return null;var d=a.details.partList;if(d)for(var e=d.length;e--;){var f=d[e];if(f.index===c&&f.fragment.sn===b)return f}return null}},"./src/controller/stream-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return s});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ./base-stream-controller */ "./src/controller/base-stream-controller.ts"),f=c(/*! ../is-supported */ "./src/is-supported.ts"),g=c(/*! ../events */ "./src/events.ts"),h=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),i=c(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),j=c(/*! ../types/loader */ "./src/types/loader.ts"),k=c(/*! ../loader/fragment */ "./src/loader/fragment.ts"),l=c(/*! ../demux/transmuxer-interface */ "./src/demux/transmuxer-interface.ts"),m=c(/*! ../types/transmuxer */ "./src/types/transmuxer.ts"),n=c(/*! ./gap-controller */ "./src/controller/gap-controller.ts"),o=c(/*! ../errors */ "./src/errors.ts"),p=c(/*! ../utils/logger */ "./src/utils/logger.ts");function q(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function r(a,b){return(r=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var s=function(a){function b(b,c){var d;return(d=a.call(this,b,c,"[stream-controller]")||this).audioCodecSwap=!1,d.gapController=null,d.level=-1,d._forceStartLoad=!1,d.altAudio=!1,d.audioOnly=!1,d.fragPlaying=null,d.onvplaying=null,d.onvseeked=null,d.fragLastKbps=0,d.stalled=!1,d.couldBacktrack=!1,d.audioCodecSwitch=!1,d.videoBuffer=null,d._registerListeners(),d}c=b,s=a,c.prototype=Object.create(s.prototype),c.prototype.constructor=c,r(c,s);var c,s,t,u,v,w=b.prototype;return w._registerListeners=function(){var a=this.hls;a.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(g.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.on(g.Events.ERROR,this.onError,this),a.on(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(g.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},w._unregisterListeners=function(){var a=this.hls;a.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(g.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.off(g.Events.ERROR,this.onError,this),a.off(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(g.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},w.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},w.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(c.config.testBandwidth?(d=0,this.bitrateTest=!0):d=c.nextAutoLevel),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&& -1===a&&(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=e.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this._forceStartLoad=!0,this.state=e.State.STOPPED},w.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},w.doTick=function(){switch(this.state){case e.State.IDLE:this.doTickIdle();break;case e.State.WAITING_LEVEL:var a,b=this.levels,c=this.level,d=null==b?void 0:null===(a=b[c])|| void 0===a?void 0:a.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=e.State.IDLE}break;case e.State.FRAG_LOADING_WAITING_RETRY:var f,g=self.performance.now(),h=this.retryDate;(!h||g>=h||null!==(f=this.media)&& void 0!==f&&f.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=e.State.IDLE)}this.onTickEnd()},w.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},w.doTickIdle=function(){var a,b,c,d=this.hls,f=this.levelLastLoaded,h=this.levels,l=this.media,m=d.config,n=d.nextLoadLevel;if(null!==f&&(l|| !this.startFragRequested&&m.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&h&&h[n]){var o=h[n];this.level=d.nextLoadLevel=n;var p=o.details;if(!p||this.state===e.State.WAITING_LEVEL||p.live&&this.levelLastLoaded!==n){this.state=e.State.WAITING_LEVEL;return}var q=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:l,j.PlaylistLevelType.MAIN);if(null!==q){if(!(q.len>=this.getMaxBufferLength(o.maxBitrate))){if(this._streamEnded(q,p)){var r={};this.altAudio&&(r.type="video"),this.hls.trigger(g.Events.BUFFER_EOS,r),this.state=e.State.ENDED;return}var s=q.end,t=this.getNextFragment(s,p);if(this.couldBacktrack&&!this.fragPrevious&&t&&"initSegment"!==t.sn){var u=t.sn-p.startSN;u>1&&(t=p.fragments[u-1],this.fragmentTracker.removeFragment(t))}if(t&&this.fragmentTracker.getState(t)===i.FragmentState.OK&&this.nextLoadPosition>s){var v=this.audioOnly&&!this.altAudio?k.ElementaryStreamTypes.AUDIO:k.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(l,v,j.PlaylistLevelType.MAIN),t=this.getNextFragment(this.nextLoadPosition,p)}t&&(!t.initSegment||t.initSegment.data||this.bitrateTest||(t=t.initSegment),(null===(b=t.decryptdata)|| void 0===b?void 0:b.keyFormat)!=="identity"||null!==(c=t.decryptdata)&& void 0!==c&&c.key?this.loadFragment(t,p,s):this.loadKey(t,p))}}}},w.loadFragment=function(b,c,d){var e,f=this.fragmentTracker.getState(b);if(this.fragCurrent=b,f===i.FragmentState.BACKTRACKED){var g=this.fragmentTracker.getBacktrackData(b);if(g){this._handleFragmentLoadProgress(g),this._handleFragmentLoadComplete(g);return}f=i.FragmentState.NOT_LOADED}f===i.FragmentState.NOT_LOADED||f===i.FragmentState.PARTIAL?"initSegment"===b.sn?this._loadInitSegment(b):this.bitrateTest?(b.bitrateTest=!0,this.log("Fragment "+b.sn+" of level "+b.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(b)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,b,c,d)):f===i.FragmentState.APPENDING?this.reduceMaxBufferLength(b.duration)&&this.fragmentTracker.removeFragment(b):(null===(e=this.media)|| void 0===e?void 0:e.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},w.getAppendedFrag=function(a){var b=this.fragmentTracker.getAppendedFrag(a,j.PlaylistLevelType.MAIN);return b&&"fragment"in b?b.fragment:b},w.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,j.PlaylistLevelType.MAIN)},w.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.end+.5):null},w.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},w.nextLevelSwitch=function(){var a=this.levels,b=this.media;if(null!=b&&b.readyState){var c,d=this.getAppendedFrag(b.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!b.paused&&a){var e=a[this.hls.nextLoadLevel],f=this.fragLastKbps;c=f&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*f)+1:0}else c=0;var g=this.getBufferedFrag(b.currentTime+c);if(g){var h=this.followingBufferedFrag(g);if(h){this.abortCurrentFrag();var i=h.maxStartPTS?h.maxStartPTS:h.start,j=h.duration,k=Math.max(g.end,i+Math.min(Math.max(j-this.config.maxFragLookUpTolerance,.5*j),.75*j));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},w.abortCurrentFrag=function(){var a=this.fragCurrent;this.fragCurrent=null,null!=a&&a.loader&&a.loader.abort(),this.state===e.State.KEY_LOADING&&(this.state=e.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},w.flushMainBuffer=function(b,c){a.prototype.flushMainBuffer.call(this,b,c,this.altAudio?"video":null)},w.onMediaAttached=function(b,c){a.prototype.onMediaAttached.call(this,b,c);var d=c.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),d.addEventListener("playing",this.onvplaying),d.addEventListener("seeked",this.onvseeked),this.gapController=new n.default(this.config,d,this.fragmentTracker,this.hls)},w.onMediaDetaching=function(){var b=this.media;b&&(b.removeEventListener("playing",this.onvplaying),b.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},w.onMediaPlaying=function(){this.tick()},w.onMediaSeeked=function(){var a=this.media,b=a?a.currentTime:null;Object(d.isFiniteNumber)(b)&&this.log("Media seeked to "+b.toFixed(3)),this.tick()},w.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(g.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},w.onManifestParsed=function(a,b){var c,d=!1,e=!1;b.levels.forEach(function(a){(c=a.audioCodec)&&(-1!==c.indexOf("mp4a.40.2")&&(d=!0),-1!==c.indexOf("mp4a.40.5")&&(e=!0))}),this.audioCodecSwitch=d&&e&&!Object(f.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=b.levels,this.startFragRequested=!1},w.onLevelLoading=function(a,b){var c=this.levels;if(c&&this.state===e.State.IDLE){var d=c[b.level];(!d.details||d.details.live&&this.levelLastLoaded!==b.level||this.waitForCdnTuneIn(d.details))&&(this.state=e.State.WAITING_LEVEL)}},w.onLevelLoaded=function(a,b){var c,d=this.levels,f=b.level,h=b.details,i=h.totalduration;if(!d){this.warn("Levels were reset while loading level "+f);return}this.log("Level "+f+" loaded ["+h.startSN+","+h.endSN+"], cc ["+h.startCC+", "+h.endCC+"] duration:"+i);var j=this.fragCurrent;j&&(this.state===e.State.FRAG_LOADING||this.state===e.State.FRAG_LOADING_WAITING_RETRY)&&j.level!==b.level&&j.loader&&(this.state=e.State.IDLE,j.loader.abort());var k=d[f],l=0;if(h.live||null!==(c=k.details)&& void 0!==c&&c.live){if(h.fragments[0]||(h.deltaUpdateFailed=!0),h.deltaUpdateFailed)return;l=this.alignPlaylists(h,k.details)}if(k.details=h,this.levelLastLoaded=f,this.hls.trigger(g.Events.LEVEL_UPDATED,{details:h,level:f}),this.state===e.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(h))return;this.state=e.State.IDLE}this.startFragRequested?h.live&&this.synchronizeToLiveEdge(h):this.setStartPosition(h,l),this.tick()},w._handleFragmentLoadProgress=function(a){var b,c=a.frag,d=a.part,e=a.payload,f=this.levels;if(!f){this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var g=f[c.level],h=g.details;if(!h){this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset");return}var i=g.videoCodec,k=h.PTSKnown||!h.live,n=null===(b=c.initSegment)|| void 0===b?void 0:b.data,o=this._getAudioCodec(g),p=this.transmuxer=this.transmuxer||new l.default(this.hls,j.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),q=d?d.index:-1,r=new m.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,e.byteLength,q,-1!==q),s=this.initPTS[c.cc];p.push(e,n,o,i,c,d,h.totalduration,k,r,s)},w.onAudioTrackSwitching=function(a,b){var c=this.altAudio,d=!!b.url,e=b.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;null!=f&&f.loader&&(this.log("Switching to main audio track, cancel main fragment load"),f.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var h=this.hls;c&&h.trigger(g.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:e})}},w.onAudioTrackSwitched=function(a,b){var c=b.id,d=!!this.hls.audioTracks[c].url;if(d){var e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=d,this.tick()},w.onBufferCreated=function(a,b){var c,d,e=b.tracks,f=!1;for(var g in e){var h=e[g];if("main"===h.id){if(d=g,c=h,"video"===g){var i=e[g];i&&(this.videoBuffer=i.buffer)}}else f=!0}f&&c?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},w.onFragBuffered=function(a,b){var c=b.frag,d=b.part;if(!c||c.type===j.PlaylistLevelType.MAIN){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(d?" p: "+d.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),this.state===e.State.PARSED&&(this.state=e.State.IDLE);return}var f=d?d.stats:c.stats;this.fragLastKbps=Math.round(8*f.total/(f.buffering.end-f.loading.first)),"initSegment"!==c.sn&&(this.fragPrevious=c),this.fragBufferedComplete(c,d)}},w.onError=function(a,b){switch(b.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(j.PlaylistLevelType.MAIN,b);break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state===e.State.ERROR||(b.fatal?(this.warn(""+b.details),this.state=e.State.ERROR):b.levelRetry||this.state!==e.State.WAITING_LEVEL||(this.state=e.State.IDLE));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if("main"===b.parent&&(this.state===e.State.PARSING||this.state===e.State.PARSED)){var c=!0,d=this.getFwdBufferInfo(this.media,j.PlaylistLevelType.MAIN);d&&d.len>.5&&(c=!this.reduceMaxBufferLength(d.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},w.checkBuffer=function(){var a=this.media,b=this.gapController;if(a&&b&&a.readyState){var c=h.BufferHelper.getBuffered(a);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):b.poll(this.lastCurrentTime),this.lastCurrentTime=a.currentTime}},w.onFragLoadEmergencyAborted=function(){this.state=e.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},w.onBufferFlushed=function(a,b){var c=b.type;if(c!==k.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(c===k.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,c,j.PlaylistLevelType.MAIN)}},w.onLevelsUpdated=function(a,b){this.levels=b.levels},w.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},w.seekToStartPos=function(){var a=this.media,b=a.currentTime,c=this.startPosition;if(c>=0&&b<c){if(a.seeking){p.logger.log("could not seek to "+c+", already seeking at "+b);return}var d=h.BufferHelper.getBuffered(a),e=(d.length?d.start(0):0)-c;e>0&&(e<this.config.maxBufferHole||e<this.config.maxFragLookUpTolerance)&&(p.logger.log("adjusting start position by "+e+" to match buffer start"),c+=e,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+b),a.currentTime=c}},w._getAudioCodec=function(a){var b=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&b&&(this.log("Swapping audio codec"),b=-1!==b.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),b},w._loadBitrateTestFrag=function(a){var b=this;this._doFragLoad(a).then(function(c){var d=b.hls;if(!(!c||d.nextLoadLevel||b.fragContextChanged(a))){b.fragLoadError=0,b.state=e.State.IDLE,b.startFragRequested=!1,b.bitrateTest=!1;var f=a.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),d.trigger(g.Events.FRAG_LOADED,c)}})},w._handleTransmuxComplete=function(a){var b,c="main",f=this.hls,h=a.remuxResult,i=a.chunkMeta,j=this.getCurrentContext(i);if(!j){this.warn("The loading context changed while buffering fragment "+i.sn+" of level "+i.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(i.level);return}var l=j.frag,m=j.part,n=j.level,o=h.video,p=h.text,q=h.id3,r=h.initSegment,s=this.altAudio?void 0:h.audio;if(!this.fragContextChanged(l)){if(this.state=e.State.PARSING,r){r.tracks&&(this._bufferInitSegment(n,r.tracks,l,i),f.trigger(g.Events.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:c,tracks:r.tracks}));var t=r.initPTS,u=r.timescale;Object(d.isFiniteNumber)(t)&&(this.initPTS[l.cc]=t,f.trigger(g.Events.INIT_PTS_FOUND,{frag:l,id:c,initPTS:t,timescale:u}))}if(o&& !1!==h.independent){if(n.details){var v=o.startPTS,w=o.endPTS,x=o.startDTS,y=o.endDTS;if(m)m.elementaryStreams[o.type]={startPTS:v,endPTS:w,startDTS:x,endDTS:y};else if(o.firstKeyFrame&&o.independent&&(this.couldBacktrack=!0),o.dropped&&o.independent){if(this.getLoadPosition()+this.config.maxBufferHole<v){this.backtrack(l);return}l.setElementaryStreamInfo(o.type,l.start,w,l.start,y,!0)}l.setElementaryStreamInfo(o.type,v,w,x,y),this.bufferFragmentData(o,l,m,i)}}else if(!1===h.independent){this.backtrack(l);return}if(s){var z=s.startPTS,A=s.endPTS,B=s.startDTS,C=s.endDTS;m&&(m.elementaryStreams[k.ElementaryStreamTypes.AUDIO]={startPTS:z,endPTS:A,startDTS:B,endDTS:C}),l.setElementaryStreamInfo(k.ElementaryStreamTypes.AUDIO,z,A,B,C),this.bufferFragmentData(s,l,m,i)}if(null!=q&&null!==(b=q.samples)&& void 0!==b&&b.length){var D={frag:l,id:c,samples:q.samples};f.trigger(g.Events.FRAG_PARSING_METADATA,D)}if(p){var E={frag:l,id:c,samples:p.samples};f.trigger(g.Events.FRAG_PARSING_USERDATA,E)}}},w._bufferInitSegment=function(a,b,c,d){var f=this;if(this.state===e.State.PARSING){this.audioOnly=!!b.audio&&!b.video,this.altAudio&&!this.audioOnly&&delete b.audio;var h=b.audio,i=b.video,j=b.audiovideo;if(h){var k=a.audioCodec,l=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(k&&(k=-1!==k.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==h.metadata.channelCount&& -1===l.indexOf("firefox")&&(k="mp4a.40.5")),-1!==l.indexOf("android")&&"audio/mpeg"!==h.container&&(k="mp4a.40.2",this.log("Android: force audio codec to "+k)),a.audioCodec&&a.audioCodec!==k&&this.log('Swapping manifest audio codec "'+a.audioCodec+'" for "'+k+'"'),h.levelCodec=k,h.id="main",this.log("Init audio buffer, container:"+h.container+", codecs[selected/level/parsed]=["+(k||"")+"/"+(a.audioCodec||"")+"/"+h.codec+"]")}i&&(i.levelCodec=a.videoCodec,i.id="main",this.log("Init video buffer, container:"+i.container+", codecs[level/parsed]=["+(a.videoCodec||"")+"/"+i.codec+"]")),j&&this.log("Init audiovideo buffer, container:"+j.container+", codecs[level/parsed]=["+(a.attrs.CODECS||"")+"/"+j.codec+"]"),this.hls.trigger(g.Events.BUFFER_CODECS,b),Object.keys(b).forEach(function(a){var e=b[a].initSegment;null!=e&&e.byteLength&&f.hls.trigger(g.Events.BUFFER_APPENDING,{type:a,data:e,frag:c,part:null,chunkMeta:d,parent:c.type})}),this.tick()}},w.backtrack=function(a){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(a);var b=this.fragmentTracker.backtrack(a);this.fragPrevious=null,this.nextLoadPosition=a.start,b?this.resetFragmentLoading(a):this.state=e.State.BACKTRACKING},w.checkFragmentChanged=function(){var a=this.media,b=null;if(a&&a.readyState>1&& !1===a.seeking){var c=a.currentTime;if(h.BufferHelper.isBuffered(a,c)?b=this.getAppendedFrag(c):h.BufferHelper.isBuffered(a,c+.1)&&(b=this.getAppendedFrag(c+.1)),b){var d=this.fragPlaying,e=b.level;d&&b.sn===d.sn&&d.level===e&&b.urlId===d.urlId||(this.hls.trigger(g.Events.FRAG_CHANGED,{frag:b}),d&&d.level===e||this.hls.trigger(g.Events.LEVEL_SWITCHED,{level:e}),this.fragPlaying=b)}}},t=b,u=[{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getAppendedFrag(a.currentTime);if(b)return b.level}return -1}},{key:"nextBufferedFrag",get:function(){var a=this.media;if(!a)return null;var b=this.getAppendedFrag(a.currentTime);return this.followingBufferedFrag(b)}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}],q(t.prototype,u),v&&q(t,v),b}(e.default)},"./src/controller/subtitle-stream-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"SubtitleStreamController",function(){return o});var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../utils/buffer-helper */ "./src/utils/buffer-helper.ts"),f=c(/*! ./fragment-finders */ "./src/controller/fragment-finders.ts"),g=c(/*! ../utils/discontinuities */ "./src/utils/discontinuities.ts"),h=c(/*! ./level-helper */ "./src/controller/level-helper.ts"),i=c(/*! ./fragment-tracker */ "./src/controller/fragment-tracker.ts"),j=c(/*! ./base-stream-controller */ "./src/controller/base-stream-controller.ts"),k=c(/*! ../types/loader */ "./src/types/loader.ts"),l=c(/*! ../types/level */ "./src/types/level.ts");function m(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function n(a,b){return(n=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var o=function(a){function b(b,c){var d;return(d=a.call(this,b,c,"[subtitle-stream-controller]")||this).levels=[],d.currentTrackId=-1,d.tracksBuffered=[],d.mainDetails=null,d._registerListeners(),d}c=b,o=a,c.prototype=Object.create(o.prototype),c.prototype.constructor=c,n(c,o);var c,o,p,q,r,s=b.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var a=this.hls;a.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(d.Events.ERROR,this.onError,this),a.on(d.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(d.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(d.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(d.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var a=this.hls;a.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(d.Events.ERROR,this.onError,this),a.off(d.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(d.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(d.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(d.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(d.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.startLoad=function(){this.stopLoad(),this.state=j.State.IDLE,this.setInterval(500),this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(a,b){this.mainDetails=b.details},s.onSubtitleFragProcessed=function(a,b){var c,d=b.frag,e=b.success;if(this.fragPrevious=d,this.state=j.State.IDLE,e){var f=this.tracksBuffered[this.currentTrackId];if(f){for(var g=d.start,h=0;h<f.length;h++)if(g>=f[h].start&&g<=f[h].end){c=f[h];break}var i=d.start+d.duration;c?c.end=i:(c={start:g,end:i},f.push(c)),this.fragmentTracker.fragBuffered(d)}}},s.onBufferFlushing=function(a,b){var c=b.startOffset,d=b.endOffset;if(0===c&&d!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,f=this.levels;if(!f.length||!f[e]||!f[e].details)return;var g=d-f[e].details.targetduration;if(g<=0)return;b.endOffsetSubtitles=Math.max(0,g),this.tracksBuffered.forEach(function(a){for(var b=0;b<a.length;){if(a[b].end<=g){a.shift();continue}if(a[b].start<g)a[b].start=g;else break;b++}}),this.fragmentTracker.removeFragmentsInRange(c,g,k.PlaylistLevelType.SUBTITLE)}},s.onError=function(a,b){var c,d=b.frag;d&&d.type===k.PlaylistLevelType.SUBTITLE&&(null!==(c=this.fragCurrent)&& void 0!==c&&c.loader&&this.fragCurrent.loader.abort(),this.state=j.State.IDLE)},s.onSubtitleTracksUpdated=function(a,b){var c=this,d=b.subtitleTracks;this.tracksBuffered=[],this.levels=d.map(function(a){return new l.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){c.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(a,b){if(this.currentTrackId=b.id,!this.levels.length|| -1===this.currentTrackId){this.clearInterval();return}var c=this.levels[this.currentTrackId];null!=c&&c.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,c&&this.setInterval(500)},s.onSubtitleTrackLoaded=function(a,b){var c,d=b.details,e=b.id,i=this.currentTrackId,k=this.levels;if(k.length){var l=k[i];if(!(e>=k.length)&&e===i&&l){if(this.mediaBuffer=this.mediaBufferTimeRanges,d.live||null!==(c=l.details)&& void 0!==c&&c.live){var m=this.mainDetails;if(d.deltaUpdateFailed||!m)return;var n=m.fragments[0];l.details?0===this.alignPlaylists(d,l.details)&&n&&Object(h.addSliding)(d,n.start):d.hasProgramDateTime&&m.hasProgramDateTime?Object(g.alignMediaPlaylistByPDT)(d,m):n&&Object(h.addSliding)(d,n.start)}l.details=d,this.levelLastLoaded=e,this.tick(),d.live&&!this.fragCurrent&&this.media&&this.state===j.State.IDLE&&(Object(f.findFragmentByPTS)(null,d.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}}},s._handleFragmentLoadComplete=function(a){var b=a.frag,c=a.payload,e=b.decryptdata,f=this.hls;if(!this.fragContextChanged(b)&&c&&c.byteLength>0&&e&&e.key&&e.iv&&"AES-128"===e.method){var g=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(c),e.key.buffer,e.iv.buffer).then(function(a){var c=performance.now();f.trigger(d.Events.FRAG_DECRYPTED,{frag:b,payload:a,stats:{tstart:g,tdecrypt:c}})})}},s.doTick=function(){if(!this.media){this.state=j.State.IDLE;return}if(this.state===j.State.IDLE){var a,b,c=this.currentTrackId,d=this.levels;if(!d.length||!d[c]||!d[c].details)return;var g,h=d[c].details,k=h.targetduration,l=this.config,m=this.media,n=e.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,m.currentTime-k,l.maxBufferHole),o=n.end;if(n.len>this.getMaxBufferLength()+k)return;console.assert(h,"Subtitle track details are defined on idle subtitle stream controller tick");var p=h.fragments,q=p.length,r=h.edge,s=this.fragPrevious;if(o<r){var t=l.maxFragLookUpTolerance;(b=Object(f.findFragmentByPTS)(s,p,o,t))||!s||!(s.start<p[0].start)||(b=p[0])}else b=p[q-1];null!==(a=b)&& void 0!==a&&a.encrypted?this.loadKey(b,h):b&&this.fragmentTracker.getState(b)===i.FragmentState.NOT_LOADED&&this.loadFragment(b,h,o)}},s.loadFragment=function(b,c,d){this.fragCurrent=b,a.prototype.loadFragment.call(this,b,c,d)},p=b,q=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}],m(p.prototype,q),r&&m(p,r),b}(j.default)},"./src/controller/subtitle-track-controller.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../utils/texttrack-utils */ "./src/utils/texttrack-utils.ts"),f=c(/*! ./base-playlist-controller */ "./src/controller/base-playlist-controller.ts"),g=c(/*! ../types/loader */ "./src/types/loader.ts");function h(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function i(a,b){return(i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var j=function(a){function b(b){var c;return(c=a.call(this,b,"[subtitle-track-controller]")||this).media=null,c.tracks=[],c.groupId=null,c.tracksInGroup=[],c.trackId=-1,c.selectDefaultTrack=!0,c.queuedDefaultTrack=-1,c.trackChangeListener=function(){return c.onTextTracksChanged()},c.asyncPollTrackChange=function(){return c.pollTrackChange(0)},c.useTextTrackPolling=!1,c.subtitlePollingInterval=-1,c.subtitleDisplay=!0,c.registerListeners(),c}c=b,f=a,c.prototype=Object.create(f.prototype),c.prototype.constructor=c,i(c,f);var c,f,j,l,m,n=b.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,a.prototype.destroy.call(this)},n.registerListeners=function(){var a=this.hls;a.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(d.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(d.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(d.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(d.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var a=this.hls;a.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(d.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(d.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(d.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(d.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(d.Events.ERROR,this.onError,this)},n.onMediaAttached=function(a,b){this.media=b.media,this.media&&(this.queuedDefaultTrack> -1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(a){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,a)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId> -1&&(this.queuedDefaultTrack=this.trackId),k(this.media.textTracks).forEach(function(a){Object(e.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(a,b){this.tracks=b.subtitleTracks},n.onSubtitleTrackLoaded=function(a,b){var c=b.id,d=b.details,e=this.trackId,f=this.tracksInGroup[e];if(!f){this.warn("Invalid subtitle track id "+c);return}var g=f.details;f.details=b.details,this.log("subtitle track "+c+" loaded ["+d.startSN+"-"+d.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,b,g))},n.onLevelLoading=function(a,b){this.switchLevel(b.level)},n.onLevelSwitching=function(a,b){this.switchLevel(b.level)},n.switchLevel=function(a){var b=this.hls.levels[a];if(null!=b&&b.textGroupIds){var c=b.textGroupIds[b.urlId];if(this.groupId!==c){var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,f=this.tracks.filter(function(a){return!c||a.groupId===c});this.tracksInGroup=f;var g=this.findTrackId(null==e?void 0:e.name)||this.findTrackId();this.groupId=c;var h={subtitleTracks:f};this.log("Updating subtitle tracks, "+f.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(d.Events.SUBTITLE_TRACKS_UPDATED,h),-1!==g&&this.setSubtitleTrack(g,e)}}},n.findTrackId=function(a){for(var b=this.tracksInGroup,c=0;c<b.length;c++){var d=b[c];if((!this.selectDefaultTrack||d.default)&&(!a||a===d.name))return d.id}return -1},n.onError=function(b,c){a.prototype.onError.call(this,b,c),!c.fatal&&c.context&&c.context.type===g.PlaylistContextType.SUBTITLE_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},n.loadPlaylist=function(a){var b=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(b)){var c=b.id,e=b.groupId,f=b.url;if(a)try{f=a.addDirectives(f)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Loading subtitle playlist for id "+c),this.hls.trigger(d.Events.SUBTITLE_TRACK_LOADING,{url:f,id:c,groupId:e,deliveryDirectives:a||null})}},n.toggleTrackModes=function(a){var b=this,c=this.media,d=this.subtitleDisplay,e=this.trackId;if(c){var f=k(c.textTracks),g=f.filter(function(a){return a.groupId===b.groupId});if(-1===a)[].slice.call(f).forEach(function(a){a.mode="disabled"});else{var h=g[e];h&&(h.mode="disabled")}var i=g[a];i&&(i.mode=d?"showing":"hidden")}},n.setSubtitleTrack=function(a,b){var c,e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=a;return}if(this.trackId!==a&&this.toggleTrackModes(a),(this.trackId!==a|| -1!==a&&(null===(c=e[a])|| void 0===c||!c.details))&&!(a< -1)&&!(a>=e.length)){this.clearTimer();var f=e[a];if(this.log("Switching to subtitle track "+a),this.trackId=a,f){var g=f.id,h=f.groupId,i=void 0===h?"":h,j=f.name,k=f.type,l=f.url;this.hls.trigger(d.Events.SUBTITLE_TRACK_SWITCH,{id:g,groupId:i,name:j,type:k,url:l});var m=this.switchParams(f.url,null==b?void 0:b.details);this.loadPlaylist(m)}else this.hls.trigger(d.Events.SUBTITLE_TRACK_SWITCH,{id:a})}},n.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var a=-1,b=k(this.media.textTracks),c=0;c<b.length;c++)if("hidden"===b[c].mode)a=c;else if("showing"===b[c].mode){a=c;break}this.subtitleTrack!==a&&(this.subtitleTrack=a)}},j=b,l=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1;var b=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(a,b)}}],h(j.prototype,l),m&&h(j,m),b}(f.default);function k(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"subtitles"===d.kind&&d.label&&b.push(a[c])}return b}b.default=j},"./src/controller/timeline-controller.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"TimelineController",function(){return m});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../utils/cea-608-parser */ "./src/utils/cea-608-parser.ts"),g=c(/*! ../utils/output-filter */ "./src/utils/output-filter.ts"),h=c(/*! ../utils/webvtt-parser */ "./src/utils/webvtt-parser.ts"),i=c(/*! ../utils/texttrack-utils */ "./src/utils/texttrack-utils.ts"),j=c(/*! ../utils/imsc1-ttml-parser */ "./src/utils/imsc1-ttml-parser.ts"),k=c(/*! ../types/loader */ "./src/types/loader.ts"),l=c(/*! ../utils/logger */ "./src/utils/logger.ts"),m=function(){function a(a){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=p(),this.captionsProperties=void 0,this.hls=a,this.config=a.config,this.Cues=a.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var b=new g.default(this,"textTrack1"),c=new g.default(this,"textTrack2"),d=new g.default(this,"textTrack3"),h=new g.default(this,"textTrack4");this.cea608Parser1=new f.default(1,b,c),this.cea608Parser2=new f.default(3,d,h)}a.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(e.Events.FRAG_LOADING,this.onFragLoading,this),a.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.on(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.on(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var b=a.prototype;return b.destroy=function(){var a=this.hls;a.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(e.Events.FRAG_LOADING,this.onFragLoading,this),a.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.off(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.off(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},b.addCues=function(a,b,c,d,f){for(var g=!1,h=f.length;h--;){var i=f[h],j=o(i[0],i[1],b,c);if(j>=0&&(i[0]=Math.min(i[0],b),i[1]=Math.max(i[1],c),g=!0,j/(c-b)>.5))return}if(g||f.push([b,c]),this.config.renderTextTracksNatively){var k=this.captionsTracks[a];this.Cues.newCue(k,b,c,d)}else{var l=this.Cues.newCue(null,b,c,d);this.hls.trigger(e.Events.CUES_PARSED,{type:"captions",cues:l,track:a})}},b.onInitPtsFound=function(a,b){var c=this,d=b.frag,f=b.id,g=b.initPTS,h=b.timescale,i=this.unparsedVttFrags;"main"===f&&(this.initPTS[d.cc]=g,this.timescale[d.cc]=h),i.length&&(this.unparsedVttFrags=[],i.forEach(function(a){c.onFragLoaded(e.Events.FRAG_LOADED,a)}))},b.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c];if(d[a])return d}return null},b.createCaptionsTrack=function(a){this.config.renderTextTracksNatively?this.createNativeTrack(a):this.createNonNativeTrack(a)},b.createNativeTrack=function(a){if(!this.captionsTracks[a]){var b=this.captionsProperties,c=this.captionsTracks,d=this.media,e=b[a],f=e.label,g=e.languageCode,h=this.getExistingTrack(a);if(h)c[a]=h,Object(i.clearCurrentCues)(c[a]),Object(i.sendAddTrackEvent)(c[a],d);else{var j=this.createTextTrack("captions",f,g);j&&(j[a]=!0,c[a]=j)}}},b.createNonNativeTrack=function(a){if(!this.nonNativeCaptionsTracks[a]){var b=this.captionsProperties[a];if(b){var c={_id:a,label:b.label,kind:"captions",default:!!b.media&&!!b.media.default,closedCaptions:b.media};this.nonNativeCaptionsTracks[a]=c,this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[c]})}}},b.createTextTrack=function(a,b,c){var d=this.media;if(d)return d.addTextTrack(a,b,c)},b.onMediaAttaching=function(a,b){this.media=b.media,this._cleanTracks()},b.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){Object(i.clearCurrentCues)(a[b]),delete a[b]}),this.nonNativeCaptionsTracks={}},b.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=p(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},b._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)Object(i.clearCurrentCues)(b[c])}},b.onSubtitleTracksUpdated=function(a,b){var c=this;this.textTracks=[];var d=b.subtitleTracks||[],f=d.some(function(a){return a.textCodec===j.IMSC1_CODEC});if(this.config.enableWebVTT||f&&this.config.enableIMSC1){var g=this.tracks&&d&&this.tracks.length===d.length;if(this.tracks=d||[],this.config.renderTextTracksNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,b){var d;if(b<h.length){for(var e=null,f=0;f<h.length;f++)if(n(h[f],a)){e=h[f];break}e&&(d=e)}d?Object(i.clearCurrentCues)(d):(d=c.createTextTrack("subtitles",a.name,a.lang))&&(d.mode="disabled"),d&&(d.groupId=a.groupId,c.textTracks.push(d))})}else if(!g&&this.tracks&&this.tracks.length){var k=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:k})}}},b.onManifestLoaded=function(a,b){var c=this;this.config.enableCEA708Captions&&b.captions&&b.captions.forEach(function(a){var b=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);if(b){var d="textTrack"+b[1],e=c.captionsProperties[d];e&&(e.label=a.name,a.lang&&(e.languageCode=a.lang),e.media=a)}})},b.onFragLoading=function(a,b){var c=this.cea608Parser1,d=this.cea608Parser2,e=this.lastSn,f=this.lastPartIndex;if(this.enabled&&c&&d&&b.frag.type===k.PlaylistLevelType.MAIN){var g,h,i=b.frag.sn,j=null!=(g=null==b?void 0:null===(h=b.part)|| void 0===h?void 0:h.index)?g:-1;i===e+1||i===e&&j===f+1||(c.reset(),d.reset()),this.lastSn=i,this.lastPartIndex=j}},b.onFragLoaded=function(a,b){var c=b.frag,f=b.payload,g=this.initPTS,h=this.unparsedVttFrags;if(c.type===k.PlaylistLevelType.SUBTITLE){if(f.byteLength){if(!Object(d.isFiniteNumber)(g[c.cc])){h.push(b),g.length&&this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:Error("Missing initial subtitle PTS")});return}var i=c.decryptdata,l="stats"in b;if(null==i||null==i.key||"AES-128"!==i.method||l){var m=this.tracks[c.level],n=this.vttCCs;n[c.cc]||(n[c.cc]={start:c.start,prevCC:this.prevCC,new:!0},this.prevCC=c.cc),m&&m.textCodec===j.IMSC1_CODEC?this._parseIMSC1(c,f):this._parseVTTs(c,f,n)}}else this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:Error("Empty subtitle payload")})}},b._parseIMSC1=function(a,b){var c=this,d=this.hls;Object(j.parseIMSC1)(b,this.initPTS[a.cc],this.timescale[a.cc],function(b){c._appendCues(b,a.level),d.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){l.logger.log("Failed to parse IMSC1: "+b),d.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:b})})},b._parseVTTs=function(a,b,c){var d=this,f=this.hls;Object(h.parseWebVTT)(b,this.initPTS[a.cc],this.timescale[a.cc],c,a.cc,a.start,function(b){d._appendCues(b,a.level),f.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(c){d._fallbackToIMSC1(a,b),l.logger.log("Failed to parse VTT cue: "+c),f.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:c})})},b._fallbackToIMSC1=function(a,b){var c=this,d=this.tracks[a.level];d.textCodec||Object(j.parseIMSC1)(b,this.initPTS[a.cc],this.timescale[a.cc],function(){d.textCodec=j.IMSC1_CODEC,c._parseIMSC1(a,b)},function(){d.textCodec="wvtt"})},b._appendCues=function(a,b){var c=this.hls;if(this.config.renderTextTracksNatively){var d=this.textTracks[b];if("disabled"===d.mode)return;a.forEach(function(a){return Object(i.addCueToTrack)(d,a)})}else{var f=this.tracks[b].default?"default":"subtitles"+b;c.trigger(e.Events.CUES_PARSED,{type:"subtitles",cues:a,track:f})}},b.onFragDecrypted=function(a,b){var c=b.frag;if(c.type===k.PlaylistLevelType.SUBTITLE){if(!Object(d.isFiniteNumber)(this.initPTS[c.cc])){this.unparsedVttFrags.push(b);return}this.onFragLoaded(e.Events.FRAG_LOADED,b)}},b.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},b.onFragParsingUserdata=function(a,b){var c=this.cea608Parser1,d=this.cea608Parser2;if(this.enabled&&c&&d)for(var e=0;e<b.samples.length;e++){var f=b.samples[e].bytes;if(f){var g=this.extractCea608Data(f);c.addData(b.samples[e].pts,g[0]),d.addData(b.samples[e].pts,g[1])}}},b.onBufferFlushing=function(a,b){var c=b.startOffset,d=b.endOffset,e=b.endOffsetSubtitles,f=b.type,g=this.media;if(g&&!(g.currentTime<d)){if(!f||"video"===f){var h=this.captionsTracks;Object.keys(h).forEach(function(a){return Object(i.removeCuesInRange)(h[a],c,d)})}if(this.config.renderTextTracksNatively&&0===c&& void 0!==e){var j=this.textTracks;Object.keys(j).forEach(function(a){return Object(i.removeCuesInRange)(j[a],c,e)})}}},b.extractCea608Data=function(a){for(var b=31&a[0],c=2,d=[[],[]],e=0;e<b;e++){var f=a[c++],g=127&a[c++],h=127&a[c++],i=(4&f)!=0,j=3&f;(0!==g||0!==h)&&i&&(0===j||1===j)&&(d[j].push(g),d[j].push(h))}return d},a}();function n(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function o(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}function p(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(a,b){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=b}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}()},"./src/crypt/aes-decryptor.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"removePadding",function(){return e}),c.d(b,"default",function(){return f});var d=c(/*! ../utils/typed-array */ "./src/utils/typed-array.ts");function e(a){var b=a.byteLength,c=b&&new DataView(a.buffer).getUint8(b-1);return c?Object(d.sliceUint8)(a,0,b-c):a}var f=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var b=a.prototype;return b.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;d<4;d++)c[d]=b.getUint32(4*d);return c},b.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;p<256;p++)p<128?m[p]=p<<1:m[p]=p<<1^283;for(p=0;p<256;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},b.expandKey=function(a){for(var b,c,d,e,f=this.uint8ArrayToUint32Array_(a),g=!0,h=0;h<f.length&&g;)g=f[h]===this.key[h],h++;if(!g){this.key=f;var i=this.keySize=f.length;if(4!==i&&6!==i&&8!==i)throw Error("Invalid aes key size="+i);var j=this.ksRows=(i+6+1)*4,k=this.keySchedule=new Uint32Array(j),l=this.invKeySchedule=new Uint32Array(j),m=this.sBox,n=this.rcon,o=this.invSubMix,p=o[0],q=o[1],r=o[2],s=o[3];for(b=0;b<j;b++){if(b<i){d=k[b]=f[b];continue}e=d,b%i==0?(e=m[(e=e<<8|e>>>24)>>>24]<<24|m[e>>>16&255]<<16|m[e>>>8&255]<<8|m[255&e],e^=n[b/i|0]<<24):i>6&&b%i==4&&(e=m[e>>>24]<<24|m[e>>>16&255]<<16|m[e>>>8&255]<<8|m[255&e]),k[b]=d=(k[b-i]^e)>>>0}for(c=0;c<j;c++)b=j-c,e=3&c?k[b]:k[b-4],c<4||b<=4?l[c]=e:l[c]=p[m[e>>>24]]^q[m[e>>>16&255]]^r[m[e>>>8&255]]^s[m[255&e]],l[c]=l[c]>>>0}},b.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},b.decrypt=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.keySize+6,s=this.invKeySchedule,t=this.invSBox,u=this.invSubMix,v=u[0],w=u[1],x=u[2],y=u[3],z=this.uint8ArrayToUint32Array_(c),A=z[0],B=z[1],C=z[2],D=z[3],E=new Int32Array(a),F=new Int32Array(E.length),G=this.networkToHostOrderSwap;b<E.length;){for(q=1,l=G(E[b]),m=G(E[b+1]),n=G(E[b+2]),o=G(E[b+3]),h=l^s[0],i=o^s[1],j=n^s[2],k=m^s[3],p=4;q<r;q++)d=v[h>>>24]^w[i>>16&255]^x[j>>8&255]^y[255&k]^s[p],e=v[i>>>24]^w[j>>16&255]^x[k>>8&255]^y[255&h]^s[p+1],f=v[j>>>24]^w[k>>16&255]^x[h>>8&255]^y[255&i]^s[p+2],g=v[k>>>24]^w[h>>16&255]^x[i>>8&255]^y[255&j]^s[p+3],h=d,i=e,j=f,k=g,p+=4;d=t[h>>>24]<<24^t[i>>16&255]<<16^t[j>>8&255]<<8^t[255&k]^s[p],e=t[i>>>24]<<24^t[j>>16&255]<<16^t[k>>8&255]<<8^t[255&h]^s[p+1],f=t[j>>>24]<<24^t[k>>16&255]<<16^t[h>>8&255]<<8^t[255&i]^s[p+2],g=t[k>>>24]<<24^t[h>>16&255]<<16^t[i>>8&255]<<8^t[255&j]^s[p+3],F[b]=G(d^A),F[b+1]=G(g^B),F[b+2]=G(f^C),F[b+3]=G(e^D),A=l,B=m,C=n,D=o,b+=4}return F.buffer},a}()},"./src/crypt/decrypter.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return j});var d=c(/*! ./aes-crypto */ "./src/crypt/aes-crypto.ts"),e=c(/*! ./fast-aes-key */ "./src/crypt/fast-aes-key.ts"),f=c(/*! ./aes-decryptor */ "./src/crypt/aes-decryptor.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),i=c(/*! ../utils/typed-array */ "./src/utils/typed-array.ts"),j=function(){function a(a,b,c){var d=(void 0===c?{}:c).removePKCS7Padding,e=void 0===d||d;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=a,this.config=b,this.removePKCS7Padding=e,e)try{var f=self.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch(g){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var b=a.prototype;return b.destroy=function(){this.observer=null},b.isSync=function(){return this.config.enableSoftwareAES},b.flush=function(){var a=this.currentResult;if(!a){this.reset();return}var b=new Uint8Array(a);return(this.reset(),this.removePKCS7Padding)?Object(f.removePadding)(b):b},b.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},b.decrypt=function(a,b,c,d){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(a),b,c);var e=this.flush();e&&d(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(a),b,c).then(d)},b.softwareDecrypt=function(a,b,c){var d=this.currentIV,e=this.currentResult,g=this.remainderData;this.logOnce("JS AES decrypt"),g&&(a=Object(h.appendUint8Array)(g,a),this.remainderData=null);var j=this.getValidChunk(a);if(!j.length)return null;d&&(c=d);var k=this.softwareDecrypter;k||(k=this.softwareDecrypter=new f.default),k.expandKey(b);var l=e;return(this.currentResult=k.decrypt(j.buffer,0,c),this.currentIV=Object(i.sliceUint8)(j,-16).buffer,l)?l:null},b.webCryptoDecrypt=function(a,b,c){var f=this,g=this.subtle;return this.key===b&&this.fastAesKey||(this.key=b,this.fastAesKey=new e.default(g,b)),this.fastAesKey.expandKey().then(function(b){return g?new d.default(g,c).decrypt(a.buffer,b):Promise.reject(Error("web crypto not initialized"))}).catch(function(d){return f.onWebCryptoError(d,a,b,c)})},b.onWebCryptoError=function(a,b,c,d){return g.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",a),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(b,c,d)},b.getValidChunk=function(a){var b=a,c=a.length-a.length%16;return c!==a.length&&(b=Object(i.sliceUint8)(a,0,c),this.remainderData=Object(i.sliceUint8)(a,c)),b},b.logOnce=function(a){this.logEnabled&&(g.logger.log("[decrypter.ts]: "+a),this.logEnabled=!1)},a}()},"./src/crypt/fast-aes-key.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(a,b){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=b}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}()},"./src/demux/aacdemuxer.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./base-audio-demuxer */ "./src/demux/base-audio-demuxer.ts"),e=c(/*! ./adts */ "./src/demux/adts.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g=c(/*! ../demux/id3 */ "./src/demux/id3.ts");function h(a,b){return(h=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var i=function(a){function b(b,c){var d;return(d=a.call(this)||this).observer=void 0,d.config=void 0,d.observer=b,d.config=c,d}c=b,d=a,c.prototype=Object.create(d.prototype),c.prototype.constructor=c,h(c,d);var c,d,i=b.prototype;return i.resetInitSegment=function(b,c,d){a.prototype.resetInitSegment.call(this,b,c,d),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:b,duration:d,inputTimeScale:9e4,dropped:0}},b.probe=function(a){if(!a)return!1;for(var b=(g.getID3Data(a,0)||[]).length,c=a.length;b<c;b++)if(e.probe(a,b))return f.logger.log("ADTS sync word found !"),!0;return!1},i.canParse=function(a,b){return e.canParse(a,b)},i.appendFrame=function(a,b,c){e.initTrackConfig(a,this.observer,b,c,a.manifestCodec);var d=e.appendFrame(a,b,c,this.initPTS,this.frameIndex);if(d&&0===d.missing)return d},b}(d.default);i.minProbeByteLength=9,b.default=i},"./src/demux/adts.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"getAudioConfig",function(){return g}),c.d(b,"isHeaderPattern",function(){return h}),c.d(b,"getHeaderLength",function(){return i}),c.d(b,"getFullFrameLength",function(){return j}),c.d(b,"canGetFrameLength",function(){return k}),c.d(b,"isHeader",function(){return l}),c.d(b,"canParse",function(){return m}),c.d(b,"probe",function(){return n}),c.d(b,"initTrackConfig",function(){return o}),c.d(b,"getFrameDuration",function(){return p}),c.d(b,"parseFrameHeader",function(){return q}),c.d(b,"appendFrame",function(){return r});var d=c(/*! ../utils/logger */ "./src/utils/logger.ts"),e=c(/*! ../errors */ "./src/errors.ts"),f=c(/*! ../events */ "./src/events.ts");function g(a,b,c,g){var h,i,j,k,l=navigator.userAgent.toLowerCase(),m=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];h=((192&b[c+2])>>>6)+1;var n=(60&b[c+2])>>>2;if(n>m.length-1){a.trigger(f.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+n});return}return j=(1&b[c+2])<<2,j|=(192&b[c+3])>>>6,d.logger.log("manifest codec:"+g+", ADTS type:"+h+", samplingIndex:"+n),/firefox/i.test(l)?n>=6?(h=5,k=[,,,,],i=n-3):(h=2,k=[,,],i=n):-1!==l.indexOf("android")?(h=2,k=[,,],i=n):(h=5,k=[,,,,],g&&(-1!==g.indexOf("mp4a.40.29")|| -1!==g.indexOf("mp4a.40.5"))|| !g&&n>=6?i=n-3:((g&& -1!==g.indexOf("mp4a.40.2")&&(n>=6&&1===j||/vivaldi/i.test(l))|| !g&&1===j)&&(h=2,k=[,,]),i=n)),k[0]=h<<3,k[0]|=(14&n)>>1,k[1]|=(1&n)<<7,k[1]|=j<<3,5===h&&(k[1]|=(14&i)>>1,k[2]=(1&i)<<7,k[2]|=8,k[3]=0),{config:k,samplerate:m[n],channelCount:j,codec:"mp4a.40."+h,manifestCodec:g}}function h(a,b){return 255===a[b]&&(246&a[b+1])==240}function i(a,b){return 1&a[b+1]?7:9}function j(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function k(a,b){return b+5<a.length}function l(a,b){return b+1<a.length&&h(a,b)}function m(a,b){return k(a,b)&&h(a,b)&&j(a,b)<=a.length-b}function n(a,b){if(l(a,b)){var c=i(a,b);if(b+c>=a.length)return!1;var d=j(a,b);if(d<=c)return!1;var e=b+d;return e===a.length||l(a,e)}return!1}function o(a,b,c,e,f){if(!a.samplerate){var h=g(b,c,e,f);h&&(a.config=h.config,a.samplerate=h.samplerate,a.channelCount=h.channelCount,a.codec=h.codec,a.manifestCodec=h.manifestCodec,d.logger.log("parsed codec:"+a.codec+", rate:"+h.samplerate+", channels:"+h.channelCount))}}function p(a){return 9216e4/a}function q(a,b,c,d,e){var f=i(a,b),g=j(a,b);if((g-=f)>0)return{headerLength:f,frameLength:g,stamp:c+d*e}}function r(a,b,c,d,e){var f=p(a.samplerate),g=q(b,c,d,e,f);if(g){var h,i=g.frameLength,j=g.headerLength,k=g.stamp,l=j+i,m=Math.max(0,c+l-b.length);m?(h=new Uint8Array(l-j)).set(b.subarray(c+j,b.length),0):h=b.subarray(c+j,c+l);var n={unit:h,pts:k};return m||a.samples.push(n),{sample:n,length:l,missing:m}}}},"./src/demux/base-audio-demuxer.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"initPTSFn",function(){return j});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../demux/id3 */ "./src/demux/id3.ts"),f=c(/*! ./dummy-demuxed-track */ "./src/demux/dummy-demuxed-track.ts"),g=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),h=c(/*! ../utils/typed-array */ "./src/utils/typed-array.ts"),i=function(){function a(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var b=a.prototype;return b.resetInitSegment=function(a,b,c){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},b.resetTimeStamp=function(){},b.resetContiguity=function(){},b.canParse=function(a,b){return!1},b.appendFrame=function(a,b,c){},b.demux=function(a,b){this.cachedData&&(a=Object(g.appendUint8Array)(this.cachedData,a),this.cachedData=null);var c,d,i=e.getID3Data(a,0),k=i?i.length:0,l=this._audioTrack,m=this._id3Track,n=i?e.getTimeStamp(i):void 0,o=a.length;for((0===this.frameIndex||null===this.initPTS)&&(this.initPTS=j(n,b)),i&&i.length>0&&m.samples.push({pts:this.initPTS,dts:this.initPTS,data:i}),d=this.initPTS;k<o;){if(this.canParse(a,k)){var p=this.appendFrame(l,a,k);p?(this.frameIndex++,d=p.sample.pts,k+=p.length,c=k):k=o}else e.canParse(a,k)?(i=e.getID3Data(a,k),m.samples.push({pts:d,dts:d,data:i}),k+=i.length,c=k):k++;if(k===o&&c!==o){var q=Object(h.sliceUint8)(a,c);this.cachedData?this.cachedData=Object(g.appendUint8Array)(this.cachedData,q):this.cachedData=q}}return{audioTrack:l,avcTrack:Object(f.dummyTrack)(),id3Track:m,textTrack:Object(f.dummyTrack)()}},b.demuxSampleAes=function(a,b,c){return Promise.reject(Error("["+this+"] This demuxer does not support Sample-AES decryption"))},b.flush=function(a){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(f.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(f.dummyTrack)()}},b.destroy=function(){},a}(),j=function(a,b){return Object(d.isFiniteNumber)(a)?90*a:9e4*b};b.default=i},"./src/demux/chunk-cache.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(){this.chunks=[],this.dataLength=0}var b=a.prototype;return b.push=function(a){this.chunks.push(a),this.dataLength+=a.length},b.flush=function(){var a,b=this.chunks,c=this.dataLength;return b.length?(a=1===b.length?b[0]:e(b,c),this.reset(),a):new Uint8Array(0)},b.reset=function(){this.chunks.length=0,this.dataLength=0},a}();function e(a,b){for(var c=new Uint8Array(b),d=0,e=0;e<a.length;e++){var f=a[e];c.set(f,d),d+=f.length}return c}},"./src/demux/dummy-demuxed-track.ts":function(a,b,c){"use strict";function d(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}c.r(b),c.d(b,"dummyTrack",function(){return d})},"./src/demux/exp-golomb.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../utils/logger */ "./src/utils/logger.ts"),e=function(){function a(a){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}var b=a.prototype;return b.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},b.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},b.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return(a>32&&d.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),(b=a-b)>0&&this.bitsAvailable)?c<<b|this.readBits(b):c},b.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if((this.word&2147483648>>>a)!=0)return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},b.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},b.readBoolean=function(){return 1===this.readBits(1)},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(a){for(var b,c=8,d=8,e=0;e<a;e++)0!==d&&(d=(c+this.readEG()+256)%256),c=0===d?c:d},b.readSPS=function(){var a,b,c,d=0,e=0,f=0,g=0,h=this.readUByte.bind(this),i=this.readBits.bind(this),j=this.readUEG.bind(this),k=this.readBoolean.bind(this),l=this.skipBits.bind(this),m=this.skipEG.bind(this),n=this.skipUEG.bind(this),o=this.skipScalingList.bind(this);h();var p=h();if(i(5),l(3),h(),n(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var q=j();if(3===q&&l(1),n(),n(),l(1),k())for(c=0,b=3!==q?8:12;c<b;c++)k()&&o(c<6?16:64)}n();var r=j();if(0===r)j();else if(1===r)for(l(1),m(),m(),a=j(),c=0;c<a;c++)m();n(),l(1);var s=j(),t=j(),u=i(1);0===u&&l(1),l(1),k()&&(d=j(),e=j(),f=j(),g=j());var v=[1,1];if(k()&&k()){var w=h();switch(w){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil((s+1)*16-2*d-2*e),height:(2-u)*(t+1)*16-(u?2:4)*(f+g),pixelRatio:v}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}();b.default=e},"./src/demux/id3.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"isHeader",function(){return e}),c.d(b,"isFooter",function(){return f}),c.d(b,"getID3Data",function(){return g}),c.d(b,"canParse",function(){return i}),c.d(b,"getTimeStamp",function(){return j}),c.d(b,"isTimeStampFrame",function(){return k}),c.d(b,"getID3Frames",function(){return m}),c.d(b,"decodeFrame",function(){return n}),c.d(b,"utf8ArrayToStr",function(){return s}),c.d(b,"testables",function(){return t});var d,e=function(a,b){return!!(b+10<=a.length)&&73===a[b]&&68===a[b+1]&&51===a[b+2]&& !!(a[b+3]<255)&&!!(a[b+4]<255)&& !!(a[b+6]<128)&&!!(a[b+7]<128)&&!!(a[b+8]<128)&&!!(a[b+9]<128)},f=function(a,b){return!!(b+10<=a.length)&&51===a[b]&&68===a[b+1]&&73===a[b+2]&& !!(a[b+3]<255)&&!!(a[b+4]<255)&& !!(a[b+6]<128)&&!!(a[b+7]<128)&&!!(a[b+8]<128)&&!!(a[b+9]<128)},g=function(a,b){for(var c=b,d=0;e(a,b);){d+=10;var g=h(a,b+6);d+=g,f(a,b+10)&&(d+=10),b+=d}if(d>0)return a.subarray(c,c+d)},h=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},i=function(a,b){return e(a,b)&&h(a,b+6)+10<=a.length-b},j=function(a){for(var b=m(a),c=0;c<b.length;c++){var d=b[c];if(k(d))return r(d)}},k=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},l=function(a){var b=String.fromCharCode(a[0],a[1],a[2],a[3]),c=h(a,4);return{type:b,size:c,data:a.subarray(10,10+c)}},m=function(a){for(var b=0,c=[];e(a,b);){for(var d=h(a,b+6),g=(b+=10)+d;b+8<g;){var i=l(a.subarray(b)),j=n(i);j&&c.push(j),b+=i.size+10}f(a,b)&&(b+=10)}return c},n=function(a){return"PRIV"===a.type?o(a):"W"===a.type[0]?q(a):p(a)},o=function(a){if(!(a.size<2)){var b=s(a.data,!0),c=new Uint8Array(a.data.subarray(b.length+1));return{key:a.type,info:b,data:c.buffer}}},p=function(a){if(!(a.size<2)){if("TXXX"===a.type){var b=1,c=s(a.data.subarray(b),!0);b+=c.length+1;var d=s(a.data.subarray(b));return{key:a.type,info:c,data:d}}var e=s(a.data.subarray(1));return{key:a.type,data:e}}},q=function(a){if("WXXX"===a.type){if(a.size<2)return;var b=1,c=s(a.data.subarray(b),!0);b+=c.length+1;var d=s(a.data.subarray(b));return{key:a.type,info:c,data:d}}var e=s(a.data);return{key:a.type,data:e}},r=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}},s=function(a,b){void 0===b&&(b=!1);var c,d,e,f=u();if(f){var g=f.decode(a);if(b){var h=g.indexOf("\0");return -1!==h?g.substring(0,h):g}return g.replace(/\0/g,"")}for(var i=a.length,j="",k=0;k<i&&(0!==(c=a[k++])||!b);)if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:j+=String.fromCharCode(c);break;case 12:case 13:j+=String.fromCharCode((31&c)<<6|63&(d=a[k++]));break;case 14:d=a[k++],e=a[k++],j+=String.fromCharCode((15&c)<<12|(63&d)<<6|(63&e)<<0)}return j},t={decodeTextFrame:p};function u(){return d|| void 0===self.TextDecoder||(d=new self.TextDecoder("utf-8")),d}},"./src/demux/mp3demuxer.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./base-audio-demuxer */ "./src/demux/base-audio-demuxer.ts"),e=c(/*! ../demux/id3 */ "./src/demux/id3.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g=c(/*! ./mpegaudio */ "./src/demux/mpegaudio.ts");function h(a,b){return(h=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}var i=function(a){function b(){return a.apply(this,arguments)||this}c=b,d=a,c.prototype=Object.create(d.prototype),c.prototype.constructor=c,h(c,d);var c,d,i=b.prototype;return i.resetInitSegment=function(b,c,d){a.prototype.resetInitSegment.call(this,b,c,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:b,duration:d,inputTimeScale:9e4,dropped:0}},b.probe=function(a){if(!a)return!1;for(var b=(e.getID3Data(a,0)||[]).length,c=a.length;b<c;b++)if(g.probe(a,b))return f.logger.log("MPEG Audio sync word found !"),!0;return!1},i.canParse=function(a,b){return g.canParse(a,b)},i.appendFrame=function(a,b,c){if(null!==this.initPTS)return g.appendFrame(a,b,c,this.initPTS,this.frameIndex)},b}(d.default);i.minProbeByteLength=4,b.default=i},"./src/demux/mp4demuxer.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),e=c(/*! ./dummy-demuxed-track */ "./src/demux/dummy-demuxed-track.ts"),f=function(){function a(a,b){this.remainderData=null,this.config=void 0,this.config=b}var b=a.prototype;return b.resetTimeStamp=function(){},b.resetInitSegment=function(){},b.resetContiguity=function(){},a.probe=function(a){return Object(d.findBox)({data:a,start:0,end:Math.min(a.length,16384)},["moof"]).length>0},b.demux=function(a){var b=a,c=Object(e.dummyTrack)();if(this.config.progressive){this.remainderData&&(b=Object(d.appendUint8Array)(this.remainderData,a));var f=Object(d.segmentValidRange)(b);this.remainderData=f.remainder,c.samples=f.valid||new Uint8Array}else c.samples=b;return{audioTrack:Object(e.dummyTrack)(),avcTrack:c,id3Track:Object(e.dummyTrack)(),textTrack:Object(e.dummyTrack)()}},b.flush=function(){var a=Object(e.dummyTrack)();return a.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(e.dummyTrack)(),avcTrack:a,id3Track:Object(e.dummyTrack)(),textTrack:Object(e.dummyTrack)()}},b.demuxSampleAes=function(a,b,c){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},b.destroy=function(){},a}();f.minProbeByteLength=1024,b.default=f},"./src/demux/mpegaudio.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"appendFrame",function(){return i}),c.d(b,"parseHeader",function(){return j}),c.d(b,"isHeaderPattern",function(){return k}),c.d(b,"isHeader",function(){return l}),c.d(b,"canParse",function(){return m}),c.d(b,"probe",function(){return n});var d=null,e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],f=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],g=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],h=[0,1,1,4];function i(a,b,c,d,e){if(!(c+24>b.length)){var f=j(b,c);if(f&&c+f.frameLength<=b.length){var g=d+e*(9e4*f.samplesPerFrame/f.sampleRate),h={unit:b.subarray(c,c+f.frameLength),pts:g,dts:g};return a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(h),{sample:h,length:f.frameLength,missing:0}}}}function j(a,b){var c=a[b+1]>>3&3,i=a[b+1]>>1&3,j=a[b+2]>>4&15,k=a[b+2]>>2&3;if(1!==c&&0!==j&&15!==j&&3!==k){var l=a[b+2]>>1&1,m=a[b+3]>>6,n=3===c?3-i:3===i?3:4,o=1e3*e[14*n+j-1],p=3===c?0:2===c?1:2,q=f[3*p+k],r=3===m?1:2,s=g[c][i],t=h[i],u=8*s*t,v=Math.floor(s*o/q+l)*t;if(null===d){var w=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);d=w?parseInt(w[1]):0}return d&&d<=87&&2===i&&o>=224e3&&0===m&&(a[b+3]=128|a[b+3]),{sampleRate:q,channelCount:r,frameLength:v,samplesPerFrame:u}}}function k(a,b){return 255===a[b]&&(224&a[b+1])==224&&(6&a[b+1])!=0}function l(a,b){return b+1<a.length&&k(a,b)}function m(a,b){return k(a,b)&&4<=a.length-b}function n(a,b){if(b+1<a.length&&k(a,b)){var c=4,d=j(a,b),e=c;null!=d&&d.frameLength&&(e=d.frameLength);var f=b+e;return f===a.length||l(a,f)}return!1}},"./src/demux/sample-aes.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../crypt/decrypter */ "./src/crypt/decrypter.ts"),e=c(/*! ./tsdemuxer */ "./src/demux/tsdemuxer.ts"),f=function(){function a(a,b,c){this.keyData=void 0,this.decrypter=void 0,this.keyData=c,this.decrypter=new d.default(a,b,{removePKCS7Padding:!1})}var b=a.prototype;return b.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.keyData.key.buffer,this.keyData.iv.buffer,b)},b.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){var g=new Uint8Array(f);e.set(g,16),d||h.decryptAacSamples(a,b+1,c)})},b.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length){c();return}if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},b.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},b.getAvcDecryptedUnit=function(a,b){for(var c=new Uint8Array(b),d=0,e=32;e<a.length-16;e+=160,d+=16)a.set(c.subarray(d,d+16),e);return a},b.decryptAvcSample=function(a,b,c,d,f,g){var h=Object(e.discardEPB)(f.data),i=this.getAvcEncryptedData(h),j=this;this.decryptBuffer(i.buffer,function(e){f.data=j.getAvcDecryptedUnit(h,e),g||j.decryptAvcSamples(a,b,c+1,d)})},b.decryptAvcSamples=function(a,b,c,d){if(a instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;b++,c=0){if(b>=a.length){d();return}for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.data.length<=48)&&(1===f.type||5===f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}();b.default=f},"./src/demux/transmuxer-interface.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return l});var d=c(/*! webworkify-webpack */ "./node_modules/webworkify-webpack/index.js"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../demux/transmuxer */ "./src/demux/transmuxer.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h=c(/*! ../errors */ "./src/errors.ts"),i=c(/*! ../utils/mediasource-helper */ "./src/utils/mediasource-helper.ts"),j=c(/*! eventemitter3 */ "./node_modules/eventemitter3/index.js"),k=Object(i.getMediaSource)()||{isTypeSupported:function(){return!1}},l=function(){function a(a,b,c,i){var l,m=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=a,this.id=b,this.onTransmuxComplete=c,this.onFlush=i;var n=a.config,o=function(b,c){(c=c||{}).frag=m.frag,c.id=m.id,a.trigger(b,c)};this.observer=new j.EventEmitter,this.observer.on(e.Events.FRAG_DECRYPTED,o),this.observer.on(e.Events.ERROR,o);var p={mp4:k.isTypeSupported("video/mp4"),mpeg:k.isTypeSupported("audio/mpeg"),mp3:k.isTypeSupported('audio/mp4; codecs="mp3"')},q=navigator.vendor;if(n.enableWorker&&"undefined"!=typeof Worker){g.logger.log("demuxing in webworker");try{l=this.worker=d(/*! ../demux/transmuxer-worker.ts */ "./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(b){a.trigger(e.Events.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:Error(b.message+"  ("+b.filename+":"+b.lineno+")")})},l.postMessage({cmd:"init",typeSupported:p,vendor:q,id:b,config:JSON.stringify(n)})}catch(r){g.logger.warn("Error in worker:",r),g.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new f.default(this.observer,p,n,q,b),this.worker=null}}else this.transmuxer=new f.default(this.observer,p,n,q,b)}var b=a.prototype;return b.destroy=function(){var a=this.worker;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.worker=null;else{var b=this.transmuxer;b&&(b.destroy(),this.transmuxer=null)}var c=this.observer;c&&c.removeAllListeners(),this.observer=null},b.push=function(a,b,c,d,e,h,i,j,k,l){var m,n,o=this;k.transmuxing.start=self.performance.now();var p=this.transmuxer,q=this.worker,r=h?h.start:e.start,s=e.decryptdata,t=this.frag,u=!(t&&e.cc===t.cc),v=!(t&&k.level===t.level),w=t?k.sn-t.sn:-1,x=this.part?k.part-this.part.index:1,y=!v&&(1===w||0===w&&1===x),z=self.performance.now();(v||w||0===e.stats.parsing.start)&&(e.stats.parsing.start=z),h&&(x||!y)&&(h.stats.parsing.start=z);var A=!(t&&(null===(m=e.initSegment)|| void 0===m?void 0:m.url)===(null===(n=t.initSegment)|| void 0===n?void 0:n.url)),B=new f.TransmuxState(u,y,j,v,r,A);if(!y||u||A){g.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+k.sn+" p: "+k.part+" level: "+k.level+" id: "+k.id+"\n        discontinuity: "+u+"\n        trackSwitch: "+v+"\n        contiguous: "+y+"\n        accurateTimeOffset: "+j+"\n        timeOffset: "+r+"\n        initSegmentChange: "+A);var C=new f.TransmuxConfig(c,d,b,i,l);this.configureTransmuxer(C)}if(this.frag=e,this.part=h,q)q.postMessage({cmd:"demux",data:a,decryptdata:s,chunkMeta:k,state:B},a instanceof ArrayBuffer?[a]:[]);else if(p){var D=p.push(a,s,k,B);Object(f.isPromise)(D)?D.then(function(a){o.handleTransmuxComplete(a)}):this.handleTransmuxComplete(D)}},b.flush=function(a){var b=this;a.transmuxing.start=self.performance.now();var c=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:a});else if(c){var e=c.flush(a);Object(f.isPromise)(e)?e.then(function(c){b.handleFlushResult(c,a)}):this.handleFlushResult(e,a)}},b.handleFlushResult=function(a,b){var c=this;a.forEach(function(a){c.handleTransmuxComplete(a)}),this.onFlush(b)},b.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(b.data);break;case"flush":this.onFlush(b.data);break;default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},b.configureTransmuxer=function(a){var b=this.worker,c=this.transmuxer;b?b.postMessage({cmd:"configure",config:a}):c&&c.configure(a)},b.handleTransmuxComplete=function(a){a.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(a)},a}()},"./src/demux/transmuxer-worker.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return h});var d=c(/*! ../demux/transmuxer */ "./src/demux/transmuxer.ts"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g=c(/*! eventemitter3 */ "./node_modules/eventemitter3/index.js");function h(a){var b=new g.EventEmitter,c=function(b,c){a.postMessage({event:b,data:c})};b.on(e.Events.FRAG_DECRYPTED,c),b.on(e.Events.ERROR,c),a.addEventListener("message",function(e){var g=e.data;switch(g.cmd){case"init":var h=JSON.parse(g.config);a.transmuxer=new d.default(b,g.typeSupported,h,g.vendor,g.id),Object(f.enableLogs)(h.debug),c("init",null);break;case"configure":a.transmuxer.configure(g.config);break;case"demux":var j=a.transmuxer.push(g.data,g.decryptdata,g.chunkMeta,g.state);Object(d.isPromise)(j)?j.then(function(b){i(a,b)}):i(a,j);break;case"flush":var l=g.chunkMeta,m=a.transmuxer.flush(l);Object(d.isPromise)(m)?m.then(function(b){k(a,b,l)}):k(a,m,l)}})}function i(a,b){if(!l(b.remuxResult)){var c=[],d=b.remuxResult,e=d.audio,f=d.video;e&&j(c,e),f&&j(c,f),a.postMessage({event:"transmuxComplete",data:b},c)}}function j(a,b){b.data1&&a.push(b.data1.buffer),b.data2&&a.push(b.data2.buffer)}function k(a,b,c){b.forEach(function(b){i(a,b)}),a.postMessage({event:"flush",data:c})}function l(a){return!a.audio&&!a.video&&!a.text&&!a.id3&&!a.initSegment}},"./src/demux/transmuxer.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return t}),c.d(b,"isPromise",function(){return w}),c.d(b,"TransmuxConfig",function(){return x}),c.d(b,"TransmuxState",function(){return y});var d,e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../errors */ "./src/errors.ts"),g=c(/*! ../crypt/decrypter */ "./src/crypt/decrypter.ts"),h=c(/*! ../demux/aacdemuxer */ "./src/demux/aacdemuxer.ts"),i=c(/*! ../demux/mp4demuxer */ "./src/demux/mp4demuxer.ts"),j=c(/*! ../demux/tsdemuxer */ "./src/demux/tsdemuxer.ts"),k=c(/*! ../demux/mp3demuxer */ "./src/demux/mp3demuxer.ts"),l=c(/*! ../remux/mp4-remuxer */ "./src/remux/mp4-remuxer.ts"),m=c(/*! ../remux/passthrough-remuxer */ "./src/remux/passthrough-remuxer.ts"),n=c(/*! ./chunk-cache */ "./src/demux/chunk-cache.ts"),o=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),p=c(/*! ../utils/logger */ "./src/utils/logger.ts");try{d=self.performance.now.bind(self.performance)}catch(q){p.logger.debug("Unable to use Performance API on this environment"),d=self.Date.now}var r=[{demux:j.default,remux:l.default},{demux:i.default,remux:m.default},{demux:h.default,remux:l.default},{demux:k.default,remux:l.default}],s=1024;r.forEach(function(a){s=Math.max(s,a.demux.minProbeByteLength)});var t=function(){function a(a,b,c,d,e){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new n.default,this.observer=a,this.typeSupported=b,this.config=c,this.vendor=d,this.id=e}var b=a.prototype;return b.configure=function(a){this.transmuxConfig=a,this.decrypter&&this.decrypter.reset()},b.push=function(a,b,c,e){var f=this,g=c.transmuxing;g.executeStart=d();var h=new Uint8Array(a),i=this.cache,j=this.config,k=this.currentTransmuxState,l=this.transmuxConfig;e&&(this.currentTransmuxState=e);var m=u(h,b);if(m&&"AES-128"===m.method){var n=this.getDecrypter();if(!j.enableSoftwareAES)return this.decryptionPromise=n.webCryptoDecrypt(h,m.key.buffer,m.iv.buffer).then(function(a){var b=f.push(a,null,c);return f.decryptionPromise=null,b}),this.decryptionPromise;var p=n.softwareDecrypt(h,m.key.buffer,m.iv.buffer);if(!p)return g.executeEnd=d(),v(c);h=new Uint8Array(p)}var q=e||k,r=q.contiguous,s=q.discontinuity,t=q.trackSwitch,w=q.accurateTimeOffset,x=q.timeOffset,y=q.initSegmentChange,z=l.audioCodec,A=l.videoCodec,B=l.defaultInitPts,C=l.duration,D=l.initSegmentData;if((s||t||y)&&this.resetInitSegment(D,z,A,C),(s||y)&&this.resetInitialTimestamp(B),r||this.resetContiguity(),this.needsProbing(h,s,t)){if(i.dataLength){var E=i.flush();h=Object(o.appendUint8Array)(E,h)}this.configureTransmuxer(h,l)}var F=this.transmux(h,m,x,w,c),G=this.currentTransmuxState;return G.contiguous=!0,G.discontinuity=!1,G.trackSwitch=!1,g.executeEnd=d(),F},b.flush=function(a){var b=this,c=a.transmuxing;c.executeStart=d();var g=this.decrypter,h=this.cache,i=this.currentTransmuxState,j=this.decryptionPromise;if(j)return j.then(function(){return b.flush(a)});var k=[],l=i.timeOffset;if(g){var m=g.flush();m&&k.push(this.push(m,null,a))}var n=h.dataLength;h.reset();var o=this.demuxer,p=this.remuxer;if(!o||!p)return n>=s&&this.observer.emit(e.Events.ERROR,e.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=d(),[v(a)];var q=o.flush(l);return w(q)?q.then(function(c){return b.flushRemux(k,c,a),k}):(this.flushRemux(k,q,a),k)},b.flushRemux=function(a,b,c){var e=b.audioTrack,f=b.avcTrack,g=b.id3Track,h=b.textTrack,i=this.currentTransmuxState,j=i.accurateTimeOffset,k=i.timeOffset;p.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part> -1?" p: "+c.part:"")+" of level "+c.level);var l=this.remuxer.remux(e,f,g,h,k,j,!0,this.id);a.push({remuxResult:l,chunkMeta:c}),c.transmuxing.executeEnd=d()},b.resetInitialTimestamp=function(a){var b=this.demuxer,c=this.remuxer;b&&c&&(b.resetTimeStamp(a),c.resetTimeStamp(a))},b.resetContiguity=function(){var a=this.demuxer,b=this.remuxer;a&&b&&(a.resetContiguity(),b.resetNextTimestamp())},b.resetInitSegment=function(a,b,c,d){var e=this.demuxer,f=this.remuxer;e&&f&&(e.resetInitSegment(b,c,d),f.resetInitSegment(a,b,c))},b.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},b.transmux=function(a,b,c,d,e){var f;return b&&"SAMPLE-AES"===b.method?this.transmuxSampleAes(a,b,c,d,e):this.transmuxUnencrypted(a,c,d,e)},b.transmuxUnencrypted=function(a,b,c,d){var e=this.demuxer.demux(a,b,!1,!this.config.progressive),f=e.audioTrack,g=e.avcTrack,h=e.id3Track,i=e.textTrack,j=this.remuxer.remux(f,g,h,i,b,c,!1,this.id);return{remuxResult:j,chunkMeta:d}},b.transmuxSampleAes=function(a,b,c,d,e){var f=this;return this.demuxer.demuxSampleAes(a,b,c).then(function(a){return{remuxResult:f.remuxer.remux(a.audioTrack,a.avcTrack,a.id3Track,a.textTrack,c,d,!1,f.id),chunkMeta:e}})},b.configureTransmuxer=function(a,b){for(var c,d=this.config,e=this.observer,f=this.typeSupported,g=this.vendor,h=b.audioCodec,j=b.defaultInitPts,k=b.duration,l=b.initSegmentData,n=b.videoCodec,o=0,q=r.length;o<q;o++)if(r[o].demux.probe(a)){c=r[o];break}c||(p.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),c={demux:i.default,remux:m.default});var s=this.demuxer,t=this.remuxer,u=c.remux,v=c.demux;t&&t instanceof u||(this.remuxer=new u(e,d,f,g)),s&&s instanceof v||(this.demuxer=new v(e,d,f),this.probe=v.probe),this.resetInitSegment(l,h,n,k),this.resetInitialTimestamp(j)},b.needsProbing=function(a,b,c){return!this.demuxer||!this.remuxer||b||c},b.getDecrypter=function(){var a=this.decrypter;return a||(a=this.decrypter=new g.default(this.observer,this.config)),a},a}();function u(a,b){var c=null;return a.byteLength>0&&null!=b&&null!=b.key&&null!==b.iv&&null!=b.method&&(c=b),c}var v=function(a){return{remuxResult:{},chunkMeta:a}};function w(a){return"then"in a&&a.then instanceof Function}var x=function(a,b,c,d,e){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=b,this.initSegmentData=c,this.duration=d,this.defaultInitPts=e},y=function(a,b,c,d,e,f){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=a,this.contiguous=b,this.accurateTimeOffset=c,this.trackSwitch=d,this.timeOffset=e,this.initSegmentChange=f}},"./src/demux/tsdemuxer.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"discardEPB",function(){return u});var d=c(/*! ./adts */ "./src/demux/adts.ts"),e=c(/*! ./mpegaudio */ "./src/demux/mpegaudio.ts"),f=c(/*! ./exp-golomb */ "./src/demux/exp-golomb.ts"),g=c(/*! ./id3 */ "./src/demux/id3.ts"),h=c(/*! ./sample-aes */ "./src/demux/sample-aes.ts"),i=c(/*! ../events */ "./src/events.ts"),j=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),k=c(/*! ../utils/logger */ "./src/utils/logger.ts"),l=c(/*! ../errors */ "./src/errors.ts"),m={video:1,audio:2,id3:3,text:4},n=function(){function a(a,b,c){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=b,this.typeSupported=c}a.probe=function(b){var c=a.syncOffset(b);return!(c<0)&&(c&&k.logger.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),!0)},a.syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;c<b;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return -1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:m[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===a?b:void 0}};var b=a.prototype;return b.resetInitSegment=function(b,c,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",d),this._audioTrack=a.createTrack("audio",d),this._id3Track=a.createTrack("id3",d),this._txtTrack=a.createTrack("text",d),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=b,this.videoCodec=c,this._duration=d},b.resetTimeStamp=function(){},b.resetContiguity=function(){var a=this._audioTrack,b=this._avcTrack,c=this._id3Track;a&&(a.pesData=null),b&&(b.pesData=null),c&&(c.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},b.demux=function(b,c,d,e){void 0===d&&(d=!1),void 0===e&&(e=!1),d||(this.sampleAes=null);var f,g=this._avcTrack,h=this._audioTrack,m=this._id3Track,n=g.pid,o=g.pesData,s=h.pid,t=m.pid,u=h.pesData,v=m.pesData,w=!1,x=this.pmtParsed,y=this._pmtId,z=b.length;if(this.remainderData&&(z=(b=Object(j.appendUint8Array)(this.remainderData,b)).length,this.remainderData=null),z<188&&!e)return this.remainderData=b,{audioTrack:h,avcTrack:g,id3Track:m,textTrack:this._txtTrack};var A=Math.max(0,a.syncOffset(b));(z-=(z+A)%188)<b.byteLength&&!e&&(this.remainderData=new Uint8Array(b.buffer,z,b.buffer.byteLength-z));for(var B=0,C=A;C<z;C+=188)if(71===b[C]){var D=!!(64&b[C+1]),E=((31&b[C+1])<<8)+b[C+2],F=(48&b[C+3])>>4,G=void 0;if(F>1){if((G=C+5+b[C+4])===C+188)continue}else G=C+4;switch(E){case n:D&&(o&&(f=r(o))&&this.parseAVCPES(f,!1),o={data:[],size:0}),o&&(o.data.push(b.subarray(G,C+188)),o.size+=C+188-G);break;case s:D&&(u&&(f=r(u))&&(h.isAAC?this.parseAACPES(f):this.parseMPEGPES(f)),u={data:[],size:0}),u&&(u.data.push(b.subarray(G,C+188)),u.size+=C+188-G);break;case t:D&&(v&&(f=r(v))&&this.parseID3PES(f),v={data:[],size:0}),v&&(v.data.push(b.subarray(G,C+188)),v.size+=C+188-G);break;case 0:D&&(G+=b[G]+1),y=this._pmtId=p(b,G);break;case y:D&&(G+=b[G]+1);var H=q(b,G,!0===this.typeSupported.mpeg|| !0===this.typeSupported.mp3,d);(n=H.avc)>0&&(g.pid=n),(s=H.audio)>0&&(h.pid=s,h.isAAC=H.isAAC),(t=H.id3)>0&&(m.pid=t),w&&!x&&(k.logger.log("reparse from beginning"),w=!1,C=A-188),x=this.pmtParsed=!0;break;case 17:case 8191:break;default:w=!0}}else B++;B>0&&this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+B+" TS packet/s that do not start with 0x47"}),g.pesData=o,h.pesData=u,m.pesData=v;var I={audioTrack:h,avcTrack:g,id3Track:m,textTrack:this._txtTrack};return e&&this.extractRemainingSamples(I),I},b.flush=function(){var a,b=this.remainderData;return(this.remainderData=null,a=b?this.demux(b,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(a),this.sampleAes)?this.decrypt(a,this.sampleAes):a},b.extractRemainingSamples=function(a){var b,c=a.audioTrack,d=a.avcTrack,e=a.id3Track,f=d.pesData,g=c.pesData,h=e.pesData;f&&(b=r(f))?(this.parseAVCPES(b,!0),d.pesData=null):d.pesData=f,g&&(b=r(g))?(c.isAAC?this.parseAACPES(b):this.parseMPEGPES(b),c.pesData=null):(null!=g&&g.size&&k.logger.log("last AAC PES packet truncated,might overlap between fragments"),c.pesData=g),h&&(b=r(h))?(this.parseID3PES(b),e.pesData=null):e.pesData=h},b.demuxSampleAes=function(a,b,c){var d=this.demux(a,c,!0,!this.config.progressive),e=this.sampleAes=new h.default(this.observer,this.config,b);return this.decrypt(d,e)},b.decrypt=function(a,b){return new Promise(function(c){var d=a.audioTrack,e=a.avcTrack;d.samples&&d.isAAC?b.decryptAacSamples(d.samples,0,function(){e.samples?b.decryptAvcSamples(e.samples,0,0,function(){c(a)}):c(a)}):e.samples&&b.decryptAvcSamples(e.samples,0,0,function(){c(a)})})},b.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},b.parseAVCPES=function(a,b){var c,d=this,e=this._avcTrack,h=this.parseAVCNALu(a.data),i=this.avcSample,j=!1;a.data=null,i&&h.length&&!e.audFound&&(s(i,e),i=this.avcSample=o(!1,a.pts,a.dts,"")),h.forEach(function(b){switch(b.type){case 1:c=!0,i||(i=d.avcSample=o(!0,a.pts,a.dts,"")),i.frame=!0;var h=b.data;if(j&&h.length>4){var k=new f.default(h).readSliceType();(2===k||4===k||7===k||9===k)&&(i.key=!0)}break;case 5:c=!0,i||(i=d.avcSample=o(!0,a.pts,a.dts,"")),i.key=!0,i.frame=!0;break;case 6:c=!0;var l=new f.default(u(b.data));l.readUByte();for(var m=0,n=0,p=!1,q=0;!p&&l.bytesAvailable>1;){m=0;do m+=q=l.readUByte();while(255===q);n=0;do n+=q=l.readUByte();while(255===q);if(4===m&&0!==l.bytesAvailable){if(p=!0,181===l.readUByte()&&49===l.readUShort()&&1195456820===l.readUInt()&&3===l.readUByte()){for(var r=l.readUByte(),v=l.readUByte(),w=31&r,x=[r,v],y=0;y<w;y++)x.push(l.readUByte()),x.push(l.readUByte()),x.push(l.readUByte());t(d._txtTrack.samples,{type:3,pts:a.pts,bytes:x})}}else if(5===m&&0!==l.bytesAvailable){if(p=!0,n>16){for(var z=[],A=0;A<16;A++)z.push(l.readUByte().toString(16)),(3===A||5===A||7===A||9===A)&&z.push("-");for(var B=n-16,C=new Uint8Array(B),D=0;D<B;D++)C[D]=l.readUByte();t(d._txtTrack.samples,{pts:a.pts,payloadType:m,uuid:z.join(""),userData:Object(g.utf8ArrayToStr)(C),userDataBytes:C})}}else if(n<l.bytesAvailable)for(var E=0;E<n;E++)l.readUByte()}break;case 7:if(c=!0,j=!0,!e.sps){var F=new f.default(b.data).readSPS();e.width=F.width,e.height=F.height,e.pixelRatio=F.pixelRatio,e.sps=[b.data],e.duration=d._duration;for(var G=b.data.subarray(1,4),H="avc1.",I=0;I<3;I++){var J=G[I].toString(16);J.length<2&&(J="0"+J),H+=J}e.codec=H}break;case 8:c=!0,e.pps||(e.pps=[b.data]);break;case 9:c=!1,e.audFound=!0,i&&s(i,e),i=d.avcSample=o(!1,a.pts,a.dts,"");break;case 12:c=!1;break;default:c=!1,i&&(i.debug+="unknown NAL "+b.type+" ")}i&&c&&i.units.push(b)}),b&&i&&(s(i,e),this.avcSample=null)},b.getLastNalUnit=function(){var a,b,c=this.avcSample;if(!c||0===c.units.length){var d=this._avcTrack.samples;c=d[d.length-1]}if(null!==(a=c)&& void 0!==a&&a.units){var e=c.units;b=e[e.length-1]}return b},b.parseAVCNALu=function(a){var b,c,d,e=a.byteLength,f=this._avcTrack,g=f.naluState||0,h=g,i=[],j=0,k=-1,l=0;for(-1===g&&(k=0,l=31&a[0],g=0,j=1);j<e;){if(b=a[j++],!g){g=b?0:1;continue}if(1===g){g=b?0:2;continue}if(b){if(1===b){if(k>=0){var m={data:a.subarray(k,j-g-1),type:l};i.push(m)}else{var n=this.getLastNalUnit();if(n&&(h&&j<=4-h&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-h)),(c=j-g-1)>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o,n.state=0}}j<e?(d=31&a[j],k=j,l=d,g=0):g=-1}else g=0}else g=3}if(k>=0&&g>=0){var p={data:a.subarray(k,e),type:l,state:g};i.push(p)}if(0===i.length){var q=this.getLastNalUnit();if(q){var r=new Uint8Array(q.data.byteLength+a.byteLength);r.set(q.data,0),r.set(a,q.data.byteLength),q.data=r}}return f.naluState=g,i},b.parseAACPES=function(a){var b,c,e,f,g,h=0,j=this._audioTrack,m=this.aacOverFlow,n=a.data;if(m){this.aacOverFlow=null;var o=m.sample.unit.byteLength,p=Math.min(m.missing,o),q=o-p;m.sample.unit.set(n.subarray(0,p),q),j.samples.push(m.sample),h=m.missing}for(b=h,c=n.length;b<c-1&&!d.isHeader(n,b);b++);if(b===h||(b<c-1?(e="AAC PES did not start with ADTS header,offset:"+b,f=!1):(e="no ADTS header found in AAC PES",f=!0),k.logger.warn("parsing error:"+e),this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:f,reason:e}),!f)){if(d.initTrackConfig(j,this.observer,n,b,this.audioCodec),void 0!==a.pts)g=a.pts;else if(m){var r=d.getFrameDuration(j.samplerate);g=m.sample.pts+r}else{k.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var s=0;b<c;){if(d.isHeader(n,b)){if(b+5<c){var t=d.appendFrame(j,n,b,g,s);if(t){if(t.missing)this.aacOverFlow=t;else{b+=t.length,s++;continue}}}break}b++}}},b.parseMPEGPES=function(a){var b=a.data,c=b.length,d=0,f=0,g=a.pts;if(void 0===g){k.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;f<c;)if(e.isHeader(b,f)){var h=e.appendFrame(this._audioTrack,b,f,g,d);if(h)f+=h.length,d++;else break}else f++},b.parseID3PES=function(a){if(void 0===a.pts){k.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(a)},a}();function o(a,b,c,d){return{key:a,frame:!1,pts:b,dts:c,units:[],debug:d,length:0}}function p(a,b){return(31&a[b+10])<<8|a[b+11]}function q(a,b,c,d){var e={audio:-1,avc:-1,id3:-1,isAAC:!0},f=(15&a[b+1])<<8|a[b+2],g=b+3+f-4,h=(15&a[b+10])<<8|a[b+11];for(b+=12+h;b<g;){var i=(31&a[b+1])<<8|a[b+2];switch(a[b]){case 207:if(!d){k.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===e.audio&&(e.audio=i);break;case 21:-1===e.id3&&(e.id3=i);break;case 219:if(!d){k.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===e.avc&&(e.avc=i);break;case 3:case 4:c?-1===e.audio&&(e.audio=i,e.isAAC=!1):k.logger.log("MPEG audio found, not supported in this browser");break;case 36:k.logger.warn("Unsupported HEVC stream type found")}b+=((15&a[b+3])<<8|a[b+4])+5}return e}function r(a){var b,c,d,e,f,g=0,h=a.data;if(!a||0===a.size)return null;for(;h[0].length<19&&h.length>1;){var i=new Uint8Array(h[0].length+h[1].length);i.set(h[0]),i.set(h[1],h[0].length),h[0]=i,h.splice(1,1)}if(1===((b=h[0])[0]<<16)+(b[1]<<8)+b[2]){if((c=(b[4]<<8)+b[5])&&c>a.size-6)return null;var j=b[7];192&j&&(e=(14&b[9])*536870912+(255&b[10])*4194304+(254&b[11])*16384+(255&b[12])*128+(254&b[13])/2,64&j?e-(f=(14&b[14])*536870912+(255&b[15])*4194304+(254&b[16])*16384+(255&b[17])*128+(254&b[18])/2)>54e5&&(k.logger.warn(Math.round((e-f)/9e4)+"s delta between PTS and DTS, align them"),e=f):f=e);var l=(d=b[8])+9;if(a.size<=l)return null;a.size-=l;for(var m=new Uint8Array(a.size),n=0,o=h.length;n<o;n++){var p=(b=h[n]).byteLength;if(l){if(l>p){l-=p;continue}b=b.subarray(l),p-=l,l=0}m.set(b,g),g+=p}return c&&(c-=d+3),{data:m,pts:e,dts:f,len:c}}return null}function s(a,b){if(a.units.length&&a.frame){if(void 0===a.pts){var c=b.samples,d=c.length;if(d){var e=c[d-1];a.pts=e.pts,a.dts=e.dts}else{b.dropped++;return}}b.samples.push(a)}a.debug.length&&k.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function t(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}function u(a){for(var b=a.byteLength,c=[],d=1;d<b-2;)0===a[d]&&0===a[d+1]&&3===a[d+2]?(c.push(d+2),d+=2):d++;if(0===c.length)return a;var e=b-c.length,f=new Uint8Array(e),g=0;for(d=0;d<e;g++,d++)g===c[0]&&(g++,c.shift()),f[d]=a[g];return f}n.minProbeByteLength=188,b.default=n},"./src/errors.ts":function(a,b,c){"use strict";var d,e,f,g;c.r(b),c.d(b,"ErrorTypes",function(){return d}),c.d(b,"ErrorDetails",function(){return e}),(f=d||(d={})).NETWORK_ERROR="networkError",f.MEDIA_ERROR="mediaError",f.KEY_SYSTEM_ERROR="keySystemError",f.MUX_ERROR="muxError",f.OTHER_ERROR="otherError",(g=e||(e={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",g.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",g.KEY_SYSTEM_NO_SESSION="keySystemNoSession",g.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",g.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",g.MANIFEST_LOAD_ERROR="manifestLoadError",g.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",g.MANIFEST_PARSING_ERROR="manifestParsingError",g.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",g.LEVEL_EMPTY_ERROR="levelEmptyError",g.LEVEL_LOAD_ERROR="levelLoadError",g.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",g.LEVEL_SWITCH_ERROR="levelSwitchError",g.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",g.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",g.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",g.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",g.FRAG_LOAD_ERROR="fragLoadError",g.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",g.FRAG_DECRYPT_ERROR="fragDecryptError",g.FRAG_PARSING_ERROR="fragParsingError",g.REMUX_ALLOC_ERROR="remuxAllocError",g.KEY_LOAD_ERROR="keyLoadError",g.KEY_LOAD_TIMEOUT="keyLoadTimeOut",g.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",g.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",g.BUFFER_APPEND_ERROR="bufferAppendError",g.BUFFER_APPENDING_ERROR="bufferAppendingError",g.BUFFER_STALLED_ERROR="bufferStalledError",g.BUFFER_FULL_ERROR="bufferFullError",g.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",g.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",g.INTERNAL_EXCEPTION="internalException",g.INTERNAL_ABORTED="aborted",g.UNKNOWN="unknown"},"./src/events.ts":function(a,b,c){"use strict";var d,e;c.r(b),c.d(b,"Events",function(){return d}),(e=d||(d={})).MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return s});var d=c(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js"),e=c(/*! ./loader/playlist-loader */ "./src/loader/playlist-loader.ts"),f=c(/*! ./loader/key-loader */ "./src/loader/key-loader.ts"),g=c(/*! ./controller/id3-track-controller */ "./src/controller/id3-track-controller.ts"),h=c(/*! ./controller/latency-controller */ "./src/controller/latency-controller.ts"),i=c(/*! ./controller/level-controller */ "./src/controller/level-controller.ts"),j=c(/*! ./controller/fragment-tracker */ "./src/controller/fragment-tracker.ts"),k=c(/*! ./controller/stream-controller */ "./src/controller/stream-controller.ts"),l=c(/*! ./is-supported */ "./src/is-supported.ts"),m=c(/*! ./utils/logger */ "./src/utils/logger.ts"),n=c(/*! ./config */ "./src/config.ts"),o=c(/*! eventemitter3 */ "./node_modules/eventemitter3/index.js"),p=c(/*! ./events */ "./src/events.ts"),q=c(/*! ./errors */ "./src/errors.ts");function r(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var s=function(){function a(b){void 0===b&&(b={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new o.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var c=this.config=Object(n.mergeConfig)(a.DefaultConfig,b);this.userConfig=b,Object(m.enableLogs)(c.debug),this._autoLevelCapping=-1,c.progressive&&Object(n.enableStreamingMode)(c);var d=c.abrController,l=c.bufferController,p=c.capLevelController,q=c.fpsController,r=this.abrController=new d(this),s=this.bufferController=new l(this),t=this.capLevelController=new p(this),u=new q(this),v=new e.default(this),w=new f.default(this),x=new g.default(this),y=this.levelController=new i.default(this),z=new j.FragmentTracker(this),A=this.streamController=new k.default(this,z);t.setStreamController(A),u.setStreamController(A);var B=[y,A];this.networkControllers=B;var C=[v,w,r,s,t,u,x,z];this.audioTrackController=this.createController(c.audioTrackController,null,B),this.createController(c.audioStreamController,z,B),this.subtitleTrackController=this.createController(c.subtitleTrackController,null,B),this.createController(c.subtitleStreamController,z,B),this.createController(c.timelineController,null,C),this.emeController=this.createController(c.emeController,null,C),this.cmcdController=this.createController(c.cmcdController,null,C),this.latencyController=this.createController(h.default,null,C),this.coreComponents=C}a.isSupported=function(){return Object(l.isSupported)()};var b,c,s,t=a.prototype;return t.createController=function(a,b,c){if(a){var d=b?new a(this,b):new a(this);return c&&c.push(d),d}return null},t.on=function(a,b,c){void 0===c&&(c=this),this._emitter.on(a,b,c)},t.once=function(a,b,c){void 0===c&&(c=this),this._emitter.once(a,b,c)},t.removeAllListeners=function(a){this._emitter.removeAllListeners(a)},t.off=function(a,b,c,d){void 0===c&&(c=this),this._emitter.off(a,b,c,d)},t.listeners=function(a){return this._emitter.listeners(a)},t.emit=function(a,b,c){return this._emitter.emit(a,b,c)},t.trigger=function(a,b){if(this.config.debug)return this.emit(a,a,b);try{return this.emit(a,a,b)}catch(c){m.logger.error("An internal error happened while handling event "+a+'. Error message: "'+c.message+'". Here is a stacktrace:',c),this.trigger(p.Events.ERROR,{type:q.ErrorTypes.OTHER_ERROR,details:q.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,error:c})}return!1},t.listenerCount=function(a){return this._emitter.listenerCount(a)},t.destroy=function(){m.logger.log("destroy"),this.trigger(p.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(a){return a.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(a){return a.destroy()}),this.coreComponents.length=0},t.attachMedia=function(a){m.logger.log("attachMedia"),this._media=a,this.trigger(p.Events.MEDIA_ATTACHING,{media:a})},t.detachMedia=function(){m.logger.log("detachMedia"),this.trigger(p.Events.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(a){this.stopLoad();var b=this.media,c=this.url,e=this.url=d.buildAbsoluteURL(self.location.href,a,{alwaysNormalize:!0});m.logger.log("loadSource:"+e),b&&c&&c!==e&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(b)),this.trigger(p.Events.MANIFEST_LOADING,{url:a})},t.startLoad=function(a){void 0===a&&(a=-1),m.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},t.stopLoad=function(){m.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},t.swapAudioCodec=function(){m.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){m.logger.log("recoverMediaError");var a=this._media;this.detachMedia(),a&&this.attachMedia(a)},t.removeLevel=function(a,b){void 0===b&&(b=0),this.levelController.removeLevel(a,b)},b=a,c=[{key:"levels",get:function(){var a;return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){m.logger.log("set currentLevel:"+a),this.loadLevel=a,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){m.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){m.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){m.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){m.logger.log("set startLevel:"+a),-1!==a&&(a=Math.max(a,this.minAutoLevel)),this.levelController.startLevel=a}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(a){var b=!!a;b!==this.config.capLevelToPlayerSize&&(b?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=b)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){this._autoLevelCapping!==a&&(m.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a)}},{key:"bandwidthEstimate",get:function(){var a=this.abrController.bwEstimator;return a?a.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return -1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var a=this.levels,b=this.config.minAutoBitrate;if(!a)return 0;for(var c=a.length,d=0;d<c;d++)if(a[d].maxBitrate>b)return d;return 0}},{key:"maxAutoLevel",get:function(){var a,b=this.levels,c=this.autoLevelCapping;return -1===c&&b&&b.length?b.length-1:c}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(a){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return!!a&&a.subtitleDisplay},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(a){this.config.lowLatencyMode=a}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],s=[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return p.Events}},{key:"ErrorTypes",get:function(){return q.ErrorTypes}},{key:"ErrorDetails",get:function(){return q.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:n.hlsDefaultConfig},set:function(b){a.defaultConfig=b}}],c&&r(b.prototype,c),s&&r(b,s),a}();s.defaultConfig=void 0},"./src/is-supported.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"isSupported",function(){return f}),c.d(b,"changeTypeSupported",function(){return g});var d=c(/*! ./utils/mediasource-helper */ "./src/utils/mediasource-helper.ts");function e(){return self.SourceBuffer||self.WebKitSourceBuffer}function f(){var a=Object(d.getMediaSource)();if(!a)return!1;var b=e(),c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),f=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!f}function g(){var a,b=e();return"function"==typeof(null==b?void 0:null===(a=b.prototype)|| void 0===a?void 0:a.changeType)}},"./src/loader/fragment-loader.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return l}),c.d(b,"LoadError",function(){return n});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../errors */ "./src/errors.ts");function f(a){var b="function"==typeof Map?new Map:void 0;return(f=function(a){if(null===a||!i(a))return a;if("function"!=typeof a)throw TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}function c(){return g(a,arguments,k(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),j(c,a)})(a)}function g(a,b,c){return(g=h()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);var e=new(Function.bind.apply(a,d));return c&&j(e,c.prototype),e}).apply(null,arguments)}function h(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function i(a){return -1!==Function.toString.call(a).indexOf("[native code]")}function j(a,b){return(j=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function k(a){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}var l=function(){function a(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var b=a.prototype;return b.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},b.abort=function(){this.loader&&this.loader.abort()},b.load=function(a,b){var c=this,d=a.url;if(!d)return Promise.reject(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(d?"part list":"url")));this.abort();var f=this.config,g=f.fLoader,h=f.loader;return new Promise(function(d,i){c.loader&&c.loader.destroy();var j=c.loader=a.loader=g?new g(f):new h(f),k=m(a),l={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout,highWaterMark:131072};a.stats=j.stats,j.load(k,l,{onSuccess:function(b,e,f,g){c.resetLoader(a,j),d({frag:a,part:null,payload:b.data,networkDetails:g})},onError:function(b,d,f){c.resetLoader(a,j),i(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:b,networkDetails:f}))},onAbort:function(b,d,f){c.resetLoader(a,j),i(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:f}))},onTimeout:function(b,d,f){c.resetLoader(a,j),i(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:f}))},onProgress:function(c,d,e,f){b&&b({frag:a,part:null,payload:e,networkDetails:f})}})})},b.loadPart=function(a,b,c){var d=this;this.abort();var f=this.config,g=f.fLoader,h=f.loader;return new Promise(function(i,j){d.loader&&d.loader.destroy();var k=d.loader=a.loader=g?new g(f):new h(f),l=m(a,b),o={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout,highWaterMark:131072};b.stats=k.stats,k.load(l,o,{onSuccess:function(e,f,g,h){d.resetLoader(a,k),d.updateStatsFromPart(a,b);var j={frag:a,part:b,payload:e.data,networkDetails:h};c(j),i(j)},onError:function(c,f,g){d.resetLoader(a,k),j(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:b,response:c,networkDetails:g}))},onAbort:function(c,f,g){a.stats.aborted=b.stats.aborted,d.resetLoader(a,k),j(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:b,networkDetails:g}))},onTimeout:function(c,f,g){d.resetLoader(a,k),j(new n({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:b,networkDetails:g}))}})})},b.updateStatsFromPart=function(a,b){var c=a.stats,d=b.stats,e=d.total;if(c.loaded+=d.loaded,e){var f=Math.round(a.duration/b.duration),g=Math.min(Math.round(c.loaded/e),f),h=(f-g)*Math.round(c.loaded/g);c.total=c.loaded+h}else c.total=Math.max(c.loaded,c.total);var i=c.loading,j=d.loading;i.start?i.first+=j.first-j.start:(i.start=j.start,i.first=j.first),i.end=j.end},b.resetLoader=function(a,b){a.loader=null,this.loader===b&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),b.destroy()},a}();function m(a,b){void 0===b&&(b=null);var c=b||a,e={frag:a,part:b,responseType:"arraybuffer",url:c.url,headers:{},rangeStart:0,rangeEnd:0},f=c.byteRangeStartOffset,g=c.byteRangeEndOffset;return Object(d.isFiniteNumber)(f)&&Object(d.isFiniteNumber)(g)&&(e.rangeStart=f,e.rangeEnd=g),e}var n=function(a){var b,c;function d(b){for(var c,d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return(c=a.call.apply(a,[this].concat(e))||this).data=void 0,c.data=b,c}return b=d,c=a,b.prototype=Object.create(c.prototype),b.prototype.constructor=b,j(b,c),d}(f(Error))},"./src/loader/fragment.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"ElementaryStreamTypes",function(){return e}),c.d(b,"BaseSegment",function(){return o}),c.d(b,"Fragment",function(){return p}),c.d(b,"Part",function(){return q});var d,e,f=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),g=c(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js"),h=c(/*! ../utils/logger */ "./src/utils/logger.ts"),i=c(/*! ./level-key */ "./src/loader/level-key.ts"),j=c(/*! ./load-stats */ "./src/loader/load-stats.ts");function k(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,l(a,b)}function l(a,b){return(l=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function m(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function n(a,b,c){return b&&m(a.prototype,b),c&&m(a,c),a}(d=e||(e={})).AUDIO="audio",d.VIDEO="video",d.AUDIOVIDEO="audiovideo";var o=function(){function a(a){var b;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((b={})[e.AUDIO]=null,b[e.VIDEO]=null,b[e.AUDIOVIDEO]=null,b),this.baseurl=a}return a.prototype.setByteRange=function(a,b){var c=a.split("@",2),d=[];1===c.length?d[0]=b?b.byteRangeEndOffset:0:d[0]=parseInt(c[1]),d[1]=parseInt(c[0])+d[0],this._byteRange=d},n(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(g.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(a){this._url=a}}]),a}(),p=function(a){function b(b,c){var d;return(d=a.call(this,c)||this)._decryptdata=null,d.rawProgramDateTime=null,d.programDateTime=null,d.tagList=[],d.duration=0,d.sn=0,d.levelkey=void 0,d.type=void 0,d.loader=null,d.level=-1,d.cc=0,d.startPTS=void 0,d.endPTS=void 0,d.appendedPTS=void 0,d.startDTS=void 0,d.endDTS=void 0,d.start=0,d.deltaPTS=void 0,d.maxStartPTS=void 0,d.minEndPTS=void 0,d.stats=new j.LoadStats,d.urlId=0,d.data=void 0,d.bitrateTest=!1,d.title=null,d.initSegment=null,d.type=b,d}k(b,a);var c=b.prototype;return c.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b},c.setDecryptDataFromLevelKey=function(a,b){var c=a;return(null==a?void 0:a.method)==="AES-128"&&a.uri&&!a.iv&&((c=i.LevelKey.fromURI(a.uri)).method=a.method,c.iv=this.createInitializationVector(b),c.keyFormat="identity"),c},c.setElementaryStreamInfo=function(a,b,c,d,e,f){void 0===f&&(f=!1);var g=this.elementaryStreams,h=g[a];if(!h){g[a]={startPTS:b,endPTS:c,startDTS:d,endDTS:e,partial:f};return}h.startPTS=Math.min(h.startPTS,b),h.endPTS=Math.max(h.endPTS,c),h.startDTS=Math.min(h.startDTS,d),h.endDTS=Math.max(h.endDTS,e)},c.clearElementaryStreamInfo=function(){var a=this.elementaryStreams;a[e.AUDIO]=null,a[e.VIDEO]=null,a[e.AUDIOVIDEO]=null},n(b,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var a=this.sn;"number"!=typeof a&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&h.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),a=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,a)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(f.isFiniteNumber)(this.programDateTime))return null;var a=Object(f.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*a}},{key:"encrypted",get:function(){var a;return null!==(a=this.decryptdata)&& void 0!==a&&!!a.keyFormat&&!!this.decryptdata.uri}}]),b}(o),q=function(a){function b(b,c,d,e,f){(g=a.call(this,d)||this).fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new j.LoadStats,g.duration=b.decimalFloatingPoint("DURATION"),g.gap=b.bool("GAP"),g.independent=b.bool("INDEPENDENT"),g.relurl=b.enumeratedString("URI"),g.fragment=c,g.index=e;var g,h=b.enumeratedString("BYTERANGE");return h&&g.setByteRange(h,f),f&&(g.fragOffset=f.fragOffset+f.duration),g}return k(b,a),n(b,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var a=this.elementaryStreams;return!!(a.audio||a.video||a.audiovideo)}}]),b}(o)},"./src/loader/key-loader.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return g});var d=c(/*! ../events */ "./src/events.ts"),e=c(/*! ../errors */ "./src/errors.ts"),f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g=function(){function a(a){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=a,this._registerListeners()}var b=a.prototype;return b._registerListeners=function(){this.hls.on(d.Events.KEY_LOADING,this.onKeyLoading,this)},b._unregisterListeners=function(){this.hls.off(d.Events.KEY_LOADING,this.onKeyLoading)},b.destroy=function(){for(var a in this._unregisterListeners(),this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={}},b.onKeyLoading=function(a,b){var c=b.frag,e=c.type,g=this.loaders[e];if(!c.decryptdata){f.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var h=c.decryptdata.uri;if(h!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;if(g&&(f.logger.warn("abort previous key loader for type:"+e),g.abort()),!h){f.logger.warn("key uri is falsy");return}var j=i.loader,k=c.loader=this.loaders[e]=new j(i);this.decrypturl=h,this.decryptkey=null;var l={url:h,frag:c,responseType:"arraybuffer"},m={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};k.load(l,m,n)}else this.decryptkey&&(c.decryptdata.key=this.decryptkey,this.hls.trigger(d.Events.KEY_LOADED,{frag:c}))},b.loadsuccess=function(a,b,c){var e=c.frag;if(!e.decryptdata){f.logger.error("after key load, decryptdata unset");return}this.decryptkey=e.decryptdata.key=new Uint8Array(a.data),e.loader=null,delete this.loaders[e.type],this.hls.trigger(d.Events.KEY_LOADED,{frag:e})},b.loaderror=function(a,b){var c=b.frag,f=c.loader;f&&f.abort(),delete this.loaders[c.type],this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.loadtimeout=function(a,b){var c=b.frag,f=c.loader;f&&f.abort(),delete this.loaders[c.type],this.hls.trigger(d.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},a}()},"./src/loader/level-details.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"LevelDetails",function(){return f});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts");function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var f=function(){var a,b,c;function f(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=a}return f.prototype.reloaded=function(a){if(!a){this.advanced=!0,this.updated=!0;return}var b=this.lastPartSn-a.lastPartSn,c=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!c||!!b,this.advanced=this.endSN>a.endSN||b>0||0===b&&c>0,this.updated||this.advanced?this.misses=Math.floor(.6*a.misses):this.misses=a.misses+1,this.availabilityDelay=a.availabilityDelay},a=f,b=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(d.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var a=this.driftEndTime-this.driftStartTime;return a>0?1e3*(this.driftEnd-this.driftStart)/a:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var a;return null!==(a=this.partList)&& void 0!==a&&a.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var a;return null!==(a=this.fragments)&& void 0!==a&&a.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var a;return null!==(a=this.partList)&& void 0!==a&&a.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var a;return null!==(a=this.partList)&& void 0!==a&&a.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}],e(a.prototype,b),c&&e(a,c),f}()},"./src/loader/level-key.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"LevelKey",function(){return f});var d=c(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js");function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}var f=function(){var a,b,c;function f(a,b){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,b?this._uri=Object(d.buildAbsoluteURL)(a,b,{alwaysNormalize:!0}):this._uri=a}return f.fromURL=function(a,b){return new f(a,b)},f.fromURI=function(a){return new f(a)},a=f,b=[{key:"uri",get:function(){return this._uri}}],e(a.prototype,b),c&&e(a,c),f}()},"./src/loader/load-stats.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"LoadStats",function(){return d});var d=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return q});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! url-toolkit */ "./node_modules/url-toolkit/src/url-toolkit.js"),f=c(/*! ./fragment */ "./src/loader/fragment.ts"),g=c(/*! ./level-details */ "./src/loader/level-details.ts"),h=c(/*! ./level-key */ "./src/loader/level-key.ts"),i=c(/*! ../utils/attr-list */ "./src/utils/attr-list.ts"),j=c(/*! ../utils/logger */ "./src/utils/logger.ts"),k=c(/*! ../utils/codecs */ "./src/utils/codecs.ts"),l=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,n=RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),o=RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),p=/\.(mp4|m4s|m4v|m4a)$/i,q=function(){function a(){}return a.findGroup=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.id===b)return d}},a.convertAVC1ToAVCOTI=function(a){var b=a.split(".");if(b.length>2){var c=b.shift()+".";return c+=parseInt(b.shift()).toString(16),c+=("000"+parseInt(b.shift()).toString(16)).substr(-4)}return a},a.resolve=function(a,b){return e.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},a.parseMasterPlaylist=function(b,c){var d,e=[],f={},g=!1;for(l.lastIndex=0;null!=(d=l.exec(b));)if(d[1]){var h=new i.AttrList(d[1]),j={attrs:h,bitrate:h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),name:h.NAME,url:a.resolve(d[2],c)},k=h.decimalResolution("RESOLUTION");k&&(j.width=k.width,j.height=k.height),r((h.CODECS||"").split(/[ ,]+/).filter(function(a){return a}),j),j.videoCodec&& -1!==j.videoCodec.indexOf("avc1")&&(j.videoCodec=a.convertAVC1ToAVCOTI(j.videoCodec)),e.push(j)}else if(d[3]){var m=new i.AttrList(d[3]);m["DATA-ID"]&&(g=!0,f[m["DATA-ID"]]=m)}return{levels:e,sessionData:g?f:null}},a.parseMasterPlaylistMedia=function(b,c,d,e){void 0===e&&(e=[]);var f,g=[],h=0;for(m.lastIndex=0;null!==(f=m.exec(b));){var j=new i.AttrList(f[1]);if(j.TYPE===d){var k={attrs:j,bitrate:0,id:h++,groupId:j["GROUP-ID"],instreamId:j["INSTREAM-ID"],name:j.NAME||j.LANGUAGE||"",type:d,default:j.bool("DEFAULT"),autoselect:j.bool("AUTOSELECT"),forced:j.bool("FORCED"),lang:j.LANGUAGE,url:j.URI?a.resolve(j.URI,c):""};if(e.length){var l=a.findGroup(e,k.groupId)||e[0];s(k,l,"audioCodec"),s(k,l,"textCodec")}g.push(k)}}return g},a.parseLevelPlaylist=function(a,b,c,k,l){var m=new g.LevelDetails(b),q=m.fragments,r=null,s=0,v=0,w=0,x=0,y=null,z=new f.Fragment(k,b),A=-1,B=!1;for(n.lastIndex=0,m.m3u8=a;null!==(M=n.exec(a));){B&&(B=!1,(z=new f.Fragment(k,b)).start=w,z.sn=s,z.cc=x,z.level=c,r&&(z.initSegment=r,z.rawProgramDateTime=r.rawProgramDateTime));var C=M[1];if(C){z.duration=parseFloat(C);var D=(" "+M[2]).slice(1);z.title=D||null,z.tagList.push(D?["INF",C,D]:["INF",C])}else if(M[3])Object(d.isFiniteNumber)(z.duration)&&(z.start=w,O&&(z.levelkey=O),z.sn=s,z.level=c,z.cc=x,z.urlId=l,q.push(z),z.relurl=(" "+M[3]).slice(1),u(z,y),y=z,w+=z.duration,s++,v=0,B=!0);else if(M[4]){var E=(" "+M[4]).slice(1);y?z.setByteRange(E,y):z.setByteRange(E)}else if(M[5])z.rawProgramDateTime=(" "+M[5]).slice(1),z.tagList.push(["PROGRAM-DATE-TIME",z.rawProgramDateTime]),-1===A&&(A=q.length);else{if(!(M=M[0].match(o))){j.logger.warn("No matches on slow regex match for level playlist!");continue}for(N=1;N<M.length&& void 0===M[N];N++);var F=(" "+M[N]).slice(1),G=(" "+M[N+1]).slice(1),H=M[N+2]?(" "+M[N+2]).slice(1):"";switch(F){case"PLAYLIST-TYPE":m.type=G.toUpperCase();break;case"MEDIA-SEQUENCE":s=m.startSN=parseInt(G);break;case"SKIP":var I=new i.AttrList(G),J=I.decimalInteger("SKIPPED-SEGMENTS");if(Object(d.isFiniteNumber)(J)){m.skippedSegments=J;for(var K=J;K--;)q.unshift(null);s+=J}var L=I.enumeratedString("RECENTLY-REMOVED-DATERANGES");L&&(m.recentlyRemovedDateranges=L.split("	"));break;case"TARGETDURATION":m.targetduration=parseFloat(G);break;case"VERSION":m.version=parseInt(G);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(G||H)&&z.tagList.push(H?[G,H]:[G]);break;case"DIS":x++;case"GAP":z.tagList.push([F]);break;case"BITRATE":z.tagList.push([F,G]);break;case"DISCONTINUITY-SEQ":x=parseInt(G);break;case"KEY":var M,N,O,P,Q=new i.AttrList(G),R=Q.enumeratedString("METHOD"),S=Q.URI,T=Q.hexadecimalInteger("IV"),U=Q.enumeratedString("KEYFORMATVERSIONS"),V=Q.enumeratedString("KEYID"),W=null!=(P=Q.enumeratedString("KEYFORMAT"))?P:"identity",X=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(X.indexOf(W)> -1){j.logger.warn("Keyformat "+W+" is not supported from the manifest");continue}if("identity"!==W)continue;R&&(O=h.LevelKey.fromURL(b,S),S&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(R)>=0&&(O.method=R,O.keyFormat=W,V&&(O.keyID=V),U&&(O.keyFormatVersions=U),O.iv=T));break;case"START":var Y=new i.AttrList(G).decimalFloatingPoint("TIME-OFFSET");Object(d.isFiniteNumber)(Y)&&(m.startTimeOffset=Y);break;case"MAP":var Z=new i.AttrList(G);z.relurl=Z.URI,Z.BYTERANGE&&z.setByteRange(Z.BYTERANGE),z.level=c,z.sn="initSegment",O&&(z.levelkey=O),z.initSegment=null,r=z,B=!0;break;case"SERVER-CONTROL":var $=new i.AttrList(G);m.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),m.holdBack=$.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var _=new i.AttrList(G);m.partTarget=_.decimalFloatingPoint("PART-TARGET");break;case"PART":var aa=m.partList;aa||(aa=m.partList=[]);var ab=v>0?aa[aa.length-1]:void 0,ac=v++,ad=new f.Part(new i.AttrList(G),z,b,ac,ab);aa.push(ad),z.duration+=ad.duration;break;case"PRELOAD-HINT":var ae=new i.AttrList(G);m.preloadHint=ae;break;case"RENDITION-REPORT":var af=new i.AttrList(G);m.renditionReports=m.renditionReports||[],m.renditionReports.push(af);break;default:j.logger.warn("line parsed but not handled: "+M)}}}y&&!y.relurl?(q.pop(),w-=y.duration,m.partList&&(m.fragmentHint=y)):m.partList&&(u(z,y),z.cc=x,m.fragmentHint=z);var ag=q.length,ah=q[0],ai=q[ag-1];if((w+=m.skippedSegments*m.targetduration)>0&&ag&&ai){m.averagetargetduration=w/ag;var aj=ai.sn;m.endSN="initSegment"!==aj?aj:0,ah&&(m.startCC=ah.cc,!ah.initSegment&&m.fragments.every(function(a){var b,c,d;return a.relurl&&(b=a.relurl,p.test(null!=(c=null===(d=e.parseURL(b))|| void 0===d?void 0:d.path)?c:""))})&&(j.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(z=new f.Fragment(k,b)).relurl=ai.relurl,z.level=c,z.sn="initSegment",ah.initSegment=z,m.needSidxRanges=!0))}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(w+=m.fragmentHint.duration),m.totalduration=w,m.endCC=x,A>0&&t(q,A),m},a}();function r(a,b){["video","audio","text"].forEach(function(c){var d=a.filter(function(a){return Object(k.isCodecType)(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return -1===d.indexOf(a)})}}),b.unknownCodecs=a}function s(a,b,c){var d=b[c];d&&(a[c]=d)}function t(a,b){for(var c=a[b],d=b;d--;){var e=a[d];if(!e)return;e.programDateTime=c.programDateTime-1e3*e.duration,c=e}}function u(a,b){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):null!=b&&b.programDateTime&&(a.programDateTime=b.endProgramDateTime),Object(d.isFiniteNumber)(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../events */ "./src/events.ts"),f=c(/*! ../errors */ "./src/errors.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),i=c(/*! ./m3u8-parser */ "./src/loader/m3u8-parser.ts"),j=c(/*! ../types/loader */ "./src/types/loader.ts"),k=c(/*! ../utils/attr-list */ "./src/utils/attr-list.ts");function l(a,b){var c=a.url;return(void 0===c||0===c.indexOf("data:"))&&(c=b.url),c}var m=function(){function a(a){this.hls=void 0,this.loaders=Object.create(null),this.hls=a,this.registerListeners()}var b=a.prototype;return b.registerListeners=function(){var a=this.hls;a.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(e.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(e.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.on(e.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.unregisterListeners=function(){var a=this.hls;a.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(e.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(e.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.off(e.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},b.createInternalLoader=function(a){var b=this.hls.config,c=b.pLoader,d=b.loader,e=new(c||d)(b);return a.loader=e,this.loaders[a.type]=e,e},b.getInternalLoader=function(a){return this.loaders[a.type]},b.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},b.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy(),this.resetInternalLoader(a)}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onManifestLoading=function(a,b){var c=b.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:j.PlaylistContextType.MANIFEST,url:c,deliveryDirectives:null})},b.onLevelLoading=function(a,b){var c=b.id,d=b.level,e=b.url,f=b.deliveryDirectives;this.load({id:c,groupId:null,level:d,responseType:"text",type:j.PlaylistContextType.LEVEL,url:e,deliveryDirectives:f})},b.onAudioTrackLoading=function(a,b){var c=b.id,d=b.groupId,e=b.url,f=b.deliveryDirectives;this.load({id:c,groupId:d,level:null,responseType:"text",type:j.PlaylistContextType.AUDIO_TRACK,url:e,deliveryDirectives:f})},b.onSubtitleTrackLoading=function(a,b){var c=b.id,d=b.groupId,e=b.url,f=b.deliveryDirectives;this.load({id:c,groupId:d,level:null,responseType:"text",type:j.PlaylistContextType.SUBTITLE_TRACK,url:e,deliveryDirectives:f})},b.load=function(a){var b,c,d,e,f,h,i=this.hls.config,k=this.getInternalLoader(a);if(k){var l=k.context;if(l&&l.url===a.url){g.logger.trace("[playlist-loader]: playlist request ongoing");return}g.logger.log("[playlist-loader]: aborting previous loader for type: "+a.type),k.abort()}switch(a.type){case j.PlaylistContextType.MANIFEST:c=i.manifestLoadingMaxRetry,d=i.manifestLoadingTimeOut,e=i.manifestLoadingRetryDelay,f=i.manifestLoadingMaxRetryTimeout;break;case j.PlaylistContextType.LEVEL:case j.PlaylistContextType.AUDIO_TRACK:case j.PlaylistContextType.SUBTITLE_TRACK:c=0,d=i.levelLoadingTimeOut;break;default:c=i.levelLoadingMaxRetry,d=i.levelLoadingTimeOut,e=i.levelLoadingRetryDelay,f=i.levelLoadingMaxRetryTimeout}if(k=this.createInternalLoader(a),null!==(b=a.deliveryDirectives)&& void 0!==b&&b.part&&(a.type===j.PlaylistContextType.LEVEL&&null!==a.level?h=this.hls.levels[a.level].details:a.type===j.PlaylistContextType.AUDIO_TRACK&&null!==a.id?h=this.hls.audioTracks[a.id].details:a.type===j.PlaylistContextType.SUBTITLE_TRACK&&null!==a.id&&(h=this.hls.subtitleTracks[a.id].details),h)){var m=h.partTarget,n=h.targetduration;m&&n&&(d=Math.min(1e3*Math.max(3*m,.8*n),d))}var o={timeout:d,maxRetry:c,retryDelay:e,maxRetryDelay:f,highWaterMark:0},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};k.load(a,o,p)},b.loadsuccess=function(a,b,c,d){if(void 0===d&&(d=null),c.isSidxRequest){this.handleSidxRequest(a,c),this.handlePlaylistLoaded(a,b,c,d);return}this.resetInternalLoader(c.type);var e=a.data;if(0!==e.indexOf("#EXTM3U")){this.handleManifestParsingError(a,c,"no EXTM3U delimiter",d);return}b.parsing.start=performance.now(),e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(a,b,c,d):this.handleMasterPlaylist(a,b,c,d)},b.loaderror=function(a,b,c){void 0===c&&(c=null),this.handleNetworkError(b,c,!1,a)},b.loadtimeout=function(a,b,c){void 0===c&&(c=null),this.handleNetworkError(b,c,!0)},b.handleMasterPlaylist=function(a,b,c,d){var f=this.hls,h=a.data,j=l(a,c),m=i.default.parseMasterPlaylist(h,j),n=m.levels,o=m.sessionData;if(!n.length){this.handleManifestParsingError(a,c,"no level found in manifest",d);return}var p=n.map(function(a){return{id:a.attrs.AUDIO,audioCodec:a.audioCodec}}),q=n.map(function(a){return{id:a.attrs.SUBTITLES,textCodec:a.textCodec}}),r=i.default.parseMasterPlaylistMedia(h,j,"AUDIO",p),s=i.default.parseMasterPlaylistMedia(h,j,"SUBTITLES",q),t=i.default.parseMasterPlaylistMedia(h,j,"CLOSED-CAPTIONS");r.length&&(r.some(function(a){return!a.url})||!n[0].audioCodec||n[0].attrs.AUDIO||(g.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),r.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new k.AttrList({}),bitrate:0,url:""}))),f.trigger(e.Events.MANIFEST_LOADED,{levels:n,audioTracks:r,subtitles:s,captions:t,url:j,stats:b,networkDetails:d,sessionData:o})},b.handleTrackOrLevelPlaylist=function(a,b,c,g){var h=this.hls,m=c.id,n=c.level,o=c.type,p=l(a,c),q=Object(d.isFiniteNumber)(m)?m:0,r=Object(d.isFiniteNumber)(n)?n:q,s=function(a){var b=a.type;switch(b){case j.PlaylistContextType.AUDIO_TRACK:return j.PlaylistLevelType.AUDIO;case j.PlaylistContextType.SUBTITLE_TRACK:return j.PlaylistLevelType.SUBTITLE;default:return j.PlaylistLevelType.MAIN}}(c),t=i.default.parseLevelPlaylist(a.data,p,r,s,q);if(!t.fragments.length){h.trigger(e.Events.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:"number"==typeof c.level?c.level:void 0});return}if(o===j.PlaylistContextType.MANIFEST){var u={attrs:new k.AttrList({}),bitrate:0,details:t,name:"",url:p};h.trigger(e.Events.MANIFEST_LOADED,{levels:[u],audioTracks:[],url:p,stats:b,networkDetails:g,sessionData:null})}if(b.parsing.end=performance.now(),t.needSidxRanges){var v,w=null===(v=t.fragments[0].initSegment)|| void 0===v?void 0:v.url;this.load({url:w,isSidxRequest:!0,type:o,level:n,levelDetails:t,id:m,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}c.levelDetails=t,this.handlePlaylistLoaded(a,b,c,g)},b.handleSidxRequest=function(a,b){var c=Object(h.parseSegmentIndex)(new Uint8Array(a.data));if(c){var d=c.references,e=b.levelDetails;d.forEach(function(a,b){var d=a.info,f=e.fragments[b];0===f.byteRange.length&&f.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),f.initSegment&&f.initSegment.setByteRange(String(c.moovEndOffset)+"@0")})}},b.handleManifestParsingError=function(a,b,c,d){this.hls.trigger(e.Events.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:b.type===j.PlaylistContextType.MANIFEST,url:a.url,reason:c,response:a,context:b,networkDetails:d})},b.handleNetworkError=function(a,b,c,d){void 0===c&&(c=!1),g.logger.warn("[playlist-loader]: A network "+(c?"timeout":"error")+" occurred while loading "+a.type+" level: "+a.level+" id: "+a.id+' group-id: "'+a.groupId+'"');var h=f.ErrorDetails.UNKNOWN,i=!1,k=this.getInternalLoader(a);switch(a.type){case j.PlaylistContextType.MANIFEST:h=c?f.ErrorDetails.MANIFEST_LOAD_TIMEOUT:f.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case j.PlaylistContextType.LEVEL:h=c?f.ErrorDetails.LEVEL_LOAD_TIMEOUT:f.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case j.PlaylistContextType.AUDIO_TRACK:h=c?f.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:f.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case j.PlaylistContextType.SUBTITLE_TRACK:h=c?f.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:f.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1}k&&this.resetInternalLoader(a.type);var l={type:f.ErrorTypes.NETWORK_ERROR,details:h,fatal:i,url:a.url,loader:k,context:a,networkDetails:b};d&&(l.response=d),this.hls.trigger(e.Events.ERROR,l)},b.handlePlaylistLoaded=function(a,b,c,d){var f=c.type,g=c.level,h=c.id,i=c.groupId,k=c.loader,l=c.levelDetails,m=c.deliveryDirectives;if(!(null!=l&&l.targetduration)){this.handleManifestParsingError(a,c,"invalid target duration",d);return}if(k)switch(l.live&&(k.getCacheAge&&(l.ageHeader=k.getCacheAge()||0),(!k.getCacheAge||isNaN(l.ageHeader))&&(l.ageHeader=0)),f){case j.PlaylistContextType.MANIFEST:case j.PlaylistContextType.LEVEL:this.hls.trigger(e.Events.LEVEL_LOADED,{details:l,level:g||0,id:h||0,stats:b,networkDetails:d,deliveryDirectives:m});break;case j.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(e.Events.AUDIO_TRACK_LOADED,{details:l,id:h||0,groupId:i||"",stats:b,networkDetails:d,deliveryDirectives:m});break;case j.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(e.Events.SUBTITLE_TRACK_LOADED,{details:l,id:h||0,groupId:i||"",stats:b,networkDetails:d,deliveryDirectives:m})}},a}();b.default=m},"./src/polyfills/number.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"isFiniteNumber",function(){return d}),c.d(b,"MAX_SAFE_INTEGER",function(){return e});var d=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},e=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){}return a.getSilentFrame=function(a,b){if("mp4a.40.2"===a){if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);else if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},a}();b.default=d},"./src/remux/mp4-generator.ts":function(a,b,c){"use strict";c.r(b);var d=function(){function a(){}return a.init=function(){for(b in a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var b,c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b=8,c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];for(var f=d.length,g=f;f--;)b+=d[f].byteLength;var h=new Uint8Array(b);for(h[0]=b>>24&255,h[1]=b>>16&255,h[2]=b>>8&255,h[3]=255&b,h.set(a,4),f=0,b=8;f<g;f++)h.set(d[f],b),b+=d[f].byteLength;return h},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){var d=Math.floor((c*=b)/4294967296),e=Math.floor(c%4294967296);return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){var d=Math.floor((c*=b)/4294967296),e=Math.floor(c%4294967296),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,f)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(c=0;c<e.length;c++)d=e[c].flags,f[c+4]=d.dependsOn<<4|d.isDependedOn<<2|d.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)e=(d=b.sps[c]).byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)e=(d=b.pps[c]).byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"!==b.type?a.box(a.types.stsd,a.STSD,a.avc1(b)):b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b))},a.tkhd=function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,f=b.height,g=Math.floor(d/4294967296),h=Math.floor(d%4294967296);return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,f>>8&255,255&f,0,0]))},a.traf=function(b,c){var d=a.sdtp(b),e=b.id,f=Math.floor(c/4294967296),g=Math.floor(c%4294967296);return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,255&f,g>>24,g>>16&255,g>>8&255,255&g])),a.trun(b,d.length+16+20+8+16+8+8),d)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)f=(e=j[d]).duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c=a.moov(b),d=new Uint8Array(a.FTYP.byteLength+c.byteLength);return d.set(a.FTYP),d.set(c,a.FTYP.byteLength),d},a}();d.types=void 0,d.HDLR_TYPES=void 0,d.STTS=void 0,d.STSC=void 0,d.STCO=void 0,d.STSZ=void 0,d.VMHD=void 0,d.SMHD=void 0,d.STSD=void 0,d.FTYP=void 0,d.DINF=void 0,b.default=d},"./src/remux/mp4-remuxer.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return r}),c.d(b,"normalizePts",function(){return s});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ./aac-helper */ "./src/remux/aac-helper.ts"),f=c(/*! ./mp4-generator */ "./src/remux/mp4-generator.ts"),g=c(/*! ../events */ "./src/events.ts"),h=c(/*! ../errors */ "./src/errors.ts"),i=c(/*! ../utils/logger */ "./src/utils/logger.ts"),j=c(/*! ../types/loader */ "./src/types/loader.ts"),k=c(/*! ../utils/timescale-conversion */ "./src/utils/timescale-conversion.ts");function l(){return(l=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}var m=1024,n=1152,o=null,p=null,q=!1,r=function(){function a(a,b,c,d){if(void 0===d&&(d=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=b,this.typeSupported=c,this.ISGenerated=!1,null===o){var e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);o=e?parseInt(e[1]):0}if(null===p){var f=navigator.userAgent.match(/Safari\/(\d+)/i);p=f?parseInt(f[1]):0}q=!!o&&o<75|| !!p&&p<600}var b=a.prototype;return b.destroy=function(){},b.resetTimeStamp=function(a){i.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},b.resetNextTimestamp=function(){i.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},b.resetInitSegment=function(){i.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},b.getVideoStartPts=function(a){var b=!1,c=a.reduce(function(a,c){var d=c.pts-a;return d< -4294967296?(b=!0,s(a,c.pts)):d>0?a:c.pts},a[0].pts);return b&&i.logger.debug("PTS rollover detected"),c},b.remux=function(a,b,c,d,e,f,g,h){var k,l,m,n,o,p,q=e,r=e,u=a.pid> -1,v=b.pid> -1,w=b.samples.length,x=a.samples.length>0,y=w>1;if((!u||x)&&(!v||y)||this.ISGenerated||g){this.ISGenerated||(m=this.generateIS(a,b,e));var z=this.isVideoContiguous,A=-1;if(y&&(A=t(b.samples),!z&&this.config.forceKeyFrameOnDiscontinuity)){if(p=!0,A>0){i.logger.warn("[mp4-remuxer]: Dropped "+A+" out of "+w+" video samples due to a missing keyframe");var B=this.getVideoStartPts(b.samples);b.samples=b.samples.slice(A),b.dropped+=A,r+=(b.samples[0].pts-B)/(b.timescale||9e4)}else -1===A&&(i.logger.warn("[mp4-remuxer]: No keyframe found out of "+w+" video samples"),p=!1)}if(this.ISGenerated){if(x&&y){var C=this.getVideoStartPts(b.samples),D=(s(a.samples[0].pts,C)-C)/b.inputTimeScale;q+=Math.max(0,D),r+=Math.max(0,-D)}if(x){if(a.samplerate||(i.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),m=this.generateIS(a,b,e)),l=this.remuxAudio(a,q,this.isAudioContiguous,f,v||y||h===j.PlaylistLevelType.AUDIO?r:void 0),y){var E=l?l.endPTS-l.startPTS:0;b.inputTimeScale||(i.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),m=this.generateIS(a,b,e)),k=this.remuxVideo(b,r,z,E)}}else y&&(k=this.remuxVideo(b,r,z,0));k&&(k.firstKeyFrame=A,k.independent=-1!==A)}}return this.ISGenerated&&(c.samples.length&&(o=this.remuxID3(c,e)),d.samples.length&&(n=this.remuxText(d,e))),{audio:l,video:k,initSegment:m,independent:p,text:n,id3:o}},b.generateIS=function(a,b,c){var e,g,h,i=a.samples,j=b.samples,k=this.typeSupported,l={},m=!Object(d.isFiniteNumber)(this._initPTS),n="audio/mp4";if(m&&(e=g=1/0),a.config&&i.length&&(a.timescale=a.samplerate,!a.isAAC&&(k.mpeg?(n="audio/mpeg",a.codec=""):k.mp3&&(a.codec="mp3")),l.audio={id:"audio",container:n,codec:a.codec,initSegment:!a.isAAC&&k.mpeg?new Uint8Array(0):f.default.initSegment([a]),metadata:{channelCount:a.channelCount}},m&&(h=a.inputTimeScale,e=g=i[0].pts-Math.round(h*c))),b.sps&&b.pps&&j.length&&(b.timescale=b.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:b.codec,initSegment:f.default.initSegment([b]),metadata:{width:b.width,height:b.height}},m)){h=b.inputTimeScale;var o=this.getVideoStartPts(j),p=Math.round(h*c);g=Math.min(g,s(j[0].dts,o)-p),e=Math.min(e,o-p)}if(Object.keys(l).length)return this.ISGenerated=!0,m&&(this._initPTS=e,this._initDTS=g),{tracks:l,initPTS:e,timescale:h}},b.remuxVideo=function(a,b,c,d){var e,j,m,n,p=a.inputTimeScale,r=a.samples,t=[],v=r.length,w=this._initPTS,x=this.nextAvcDts,y=8,z=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,B=0,C=!1;if(!c||null===x){var D=b*p,E=r[0].pts-s(r[0].dts,r[0].pts);x=D-E}for(var F=0;F<v;F++){var G=r[F];if(G.pts=s(G.pts-w,x),G.dts=s(G.dts-w,x),G.dts>G.pts){var H=18e3;B=Math.max(Math.min(B,G.pts-G.dts),-1*H)}G.dts<r[F>0?F-1:F].dts&&(C=!0)}C&&r.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||d}),j=r[0].dts;var I=Math.round(((m=r[r.length-1].dts)-j)/(v-1));if(B<0){if(B< -2*I){i.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(k.toMsFromMpegTsClock)(-I,!0)+" ms");for(var J=B,K=0;K<v;K++)r[K].dts=J=Math.max(J,r[K].pts-I),r[K].pts=Math.max(J,r[K].pts)}else{i.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(k.toMsFromMpegTsClock)(B,!0)+" ms to overcome this issue");for(var L=0;L<v;L++)r[L].dts=r[L].dts+B}j=r[0].dts}if(c){var M=j-x,N=M>I,O=M< -1;if(N||O){N?i.logger.warn("AVC: "+Object(k.toMsFromMpegTsClock)(M,!0)+" ms ("+M+"dts) hole between fragments detected, filling it"):i.logger.warn("AVC: "+Object(k.toMsFromMpegTsClock)(-M,!0)+" ms ("+M+"dts) overlapping between fragments detected"),j=x;var P=r[0].pts-M;r[0].dts=j,r[0].pts=P,i.logger.log("Video: First PTS/DTS adjusted: "+Object(k.toMsFromMpegTsClock)(P,!0)+"/"+Object(k.toMsFromMpegTsClock)(j,!0)+", delta: "+Object(k.toMsFromMpegTsClock)(M,!0)+" ms")}}q&&(j=Math.max(0,j));for(var Q=0,R=0,S=0;S<v;S++){for(var T=r[S],U=T.units,V=U.length,W=0,X=0;X<V;X++)W+=U[X].data.length;R+=W,Q+=V,T.length=W,T.dts=Math.max(T.dts,j),T.pts=Math.max(T.pts,T.dts,0),z=Math.min(T.pts,z),A=Math.max(T.pts,A)}m=r[v-1].dts;var Y=R+4*Q+8;try{n=new Uint8Array(Y)}catch(Z){this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:h.ErrorTypes.MUX_ERROR,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating video mdat "+Y});return}var $=new DataView(n.buffer);$.setUint32(0,Y),n.set(f.default.types.mdat,4);for(var _=0;_<v;_++){for(var aa=r[_],ab=aa.units,ac=0,ad=0,ae=ab.length;ad<ae;ad++){var af=ab[ad],ag=af.data,ah=af.data.byteLength;$.setUint32(y,ah),y+=4,n.set(ag,y),y+=ah,ac+=4+ah}if(_<v-1)e=r[_+1].dts-aa.dts;else{var ai=this.config,aj=aa.dts-r[_>0?_-1:_].dts;if(ai.stretchShortVideoTrack&&null!==this.nextAudioPts){var ak=Math.floor(ai.maxBufferHole*p),al=(d?z+d*p:this.nextAudioPts)-aa.pts;al>ak?((e=al-aj)<0&&(e=aj),i.logger.log("[mp4-remuxer]: It is approximately "+al/90+" ms to the next segment; using duration "+e/90+" ms for the last video frame.")):e=aj}else e=aj}var am=Math.round(aa.pts-aa.dts);t.push(new u(aa.key,e,ac,am))}if(t.length&&o&&o<70){var an=t[0].flags;an.dependsOn=2,an.isNonSync=0}console.assert(void 0!==e,"mp4SampleDuration must be computed"),this.nextAvcDts=x=m+e,this.isVideoContiguous=!0;var ao,ap={data1:f.default.moof(a.sequenceNumber++,j,l({},a,{samples:t})),data2:n,startPTS:z/p,endPTS:(A+e)/p,startDTS:j/p,endDTS:x/p,type:"video",hasAudio:!1,hasVideo:!0,nb:t.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(n.length,"MDAT length must not be zero"),ap},b.remuxAudio=function(a,b,c,d,j){var k,o=a.inputTimeScale,p=a.samplerate?a.samplerate:o,q=o/p,r=a.isAAC?m:n,t=r*q,v=this._initPTS,w=!a.isAAC&&this.typeSupported.mpeg,x=[],y=a.samples,z=w?0:8,A=this.nextAudioPts|| -1,B=b*o;if(this.isAudioContiguous=c=c||y.length&&A>0&&(d&&9e3>Math.abs(B-A)||Math.abs(s(y[0].pts-v,B)-A)<20*t),y.forEach(function(a){a.pts=s(a.pts-v,B)}),!c||A<0){if(!(y=y.filter(function(a){return a.pts>=0})).length)return;A=0===j?0:d?Math.max(0,B):y[0].pts}if(a.isAAC)for(var C=void 0!==j,D=this.config.maxAudioFramesDrift,E=0,F=A;E<y.length;E++){var G=y[E],H=G.pts,I=H-F,J=Math.abs(1e3*I/o);if(I<= -D*t&&C)0===E&&(i.logger.warn("Audio frame @ "+(H/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*I/o)+" ms."),this.nextAudioPts=A=F=H);else if(I>=D*t&&J<1e4&&C){var K=Math.round(I/t);(F=H-K*t)<0&&(K--,F+=t),0===E&&(this.nextAudioPts=A=F),i.logger.warn("[mp4-remuxer]: Injecting "+K+" audio frame @ "+(F/o).toFixed(3)+"s due to "+Math.round(1e3*I/o)+" ms gap.");for(var L=0;L<K;L++){var M=Math.max(F,0),N=e.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);N||(i.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),N=G.unit.subarray()),y.splice(E,0,{unit:N,pts:M}),F+=t,E++}}G.pts=F,F+=t}for(var O=null,P=null,Q=0,R=y.length;R--;)Q+=y[R].unit.byteLength;for(var S=0,T=y.length;S<T;S++){var U=y[S],V=U.unit,W=U.pts;if(null!==P)x[S-1].duration=Math.round((W-P)/q);else{if(c&&a.isAAC&&(W=A),O=W,!(Q>0))return;Q+=z;try{k=new Uint8Array(Q)}catch(X){this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:h.ErrorTypes.MUX_ERROR,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Q,reason:"fail allocating audio mdat "+Q});return}!w&&(new DataView(k.buffer).setUint32(0,Q),k.set(f.default.types.mdat,4))}k.set(V,z);var Y=V.byteLength;z+=Y,x.push(new u(!0,r,Y,0)),P=W}var Z=x.length;if(Z){var $=x[x.length-1];this.nextAudioPts=A=P+q*$.duration;var _=w?new Uint8Array(0):f.default.moof(a.sequenceNumber++,O/q,l({},a,{samples:x}));a.samples=[];var aa=O/o,ab=A/o,ac={data1:_,data2:k,startPTS:aa,endPTS:ab,startDTS:aa,endDTS:ab,type:"audio",hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,console.assert(k.length,"MDAT length must not be zero"),ac}},b.remuxEmptyAudio=function(a,b,c,d){var f=a.inputTimeScale,g=a.samplerate?a.samplerate:f,h=this.nextAudioPts,j=(null!==h?h:d.startDTS*f)+this._initDTS,k=d.endDTS*f+this._initDTS,l=f/g*m,n=Math.ceil((k-j)/l),o=e.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(i.logger.warn("[mp4-remuxer]: remux empty Audio"),!o){i.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var p=[],q=0;q<n;q++){var r=j+q*l;p.push({unit:o,pts:r,dts:r})}return a.samples=p,this.remuxAudio(a,b,c,!1)},b.remuxID3=function(a,b){var c=a.samples.length;if(c){for(var d=a.inputTimeScale,e=this._initPTS,f=this._initDTS,g=0;g<c;g++){var h=a.samples[g];h.pts=s(h.pts-e,b*d)/d,h.dts=s(h.dts-f,b*d)/d}var i=a.samples;return a.samples=[],{samples:i}}},b.remuxText=function(a,b){var c=a.samples.length;if(c){for(var d=a.inputTimeScale,e=this._initPTS,f=0;f<c;f++){var g=a.samples[f];g.pts=s(g.pts-e,b*d)/d}a.samples.sort(function(a,b){return a.pts-b.pts});var h=a.samples;return a.samples=[],{samples:h}}},a}();function s(a,b){var c;if(null===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}function t(a){for(var b=0;b<a.length;b++)if(a[b].key)return b;return -1}var u=function(a,b,c,d){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=b,this.size=c,this.cts=d,this.flags=new v(a)},v=function(a){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=a?2:1,this.isNonSync=a?0:1}},"./src/remux/passthrough-remuxer.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../utils/mp4-tools */ "./src/utils/mp4-tools.ts"),f=c(/*! ../loader/fragment */ "./src/loader/fragment.ts"),g=c(/*! ../utils/logger */ "./src/utils/logger.ts"),h=function(){function a(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var b=a.prototype;return b.destroy=function(){},b.resetTimeStamp=function(a){this.initPTS=a,this.lastEndDTS=null},b.resetNextTimestamp=function(){this.lastEndDTS=null},b.resetInitSegment=function(a,b,c){this.audioCodec=b,this.videoCodec=c,this.generateInitSegment(a),this.emitInitSegment=!0},b.generateInitSegment=function(a){var b=this.audioCodec,c=this.videoCodec;if(!a||!a.byteLength){this.initTracks=void 0,this.initData=void 0;return}var d=this.initData=Object(e.parseInitSegment)(a);b||(b=j(d.audio,f.ElementaryStreamTypes.AUDIO)),c||(c=j(d.video,f.ElementaryStreamTypes.VIDEO));var h={};d.audio&&d.video?h.audiovideo={container:"video/mp4",codec:b+","+c,initSegment:a,id:"main"}:d.audio?h.audio={container:"audio/mp4",codec:b,initSegment:a,id:"audio"}:d.video?h.video={container:"video/mp4",codec:c,initSegment:a,id:"main"}:g.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=h},b.remux=function(a,b,c,f,h){var j=this.initPTS,k=this.lastEndDTS,l={audio:void 0,video:void 0,text:f,id3:c,initSegment:void 0};Object(d.isFiniteNumber)(k)||(k=this.lastEndDTS=h||0);var m=b.samples;if(!m||!m.length)return l;var n={initPTS:void 0,timescale:1},o=this.initData;if(o&&o.length||(this.generateInitSegment(m),o=this.initData),!o||!o.length)return g.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(d.isFiniteNumber)(j)||(this.initPTS=n.initPTS=j=i(o,m,k));var p=Object(e.getDuration)(m,o),q=k,r=p+q;Object(e.offsetStartDTS)(o,m,j),p>0?this.lastEndDTS=r:(g.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var s=!!o.audio,t=!!o.video,u="";s&&(u+="audio"),t&&(u+="video");var v={data1:m,startPTS:q,startDTS:q,endPTS:r,endDTS:r,type:u,hasAudio:s,hasVideo:t,nb:1,dropped:0};return l.audio="audio"===v.type?v:void 0,l.video="audio"!==v.type?v:void 0,l.text=f,l.id3=c,l.initSegment=n,l},a}(),i=function(a,b,c){return Object(e.getStartDTS)(a,b)-c};function j(a,b){var c=null==a?void 0:a.codec;return c&&c.length>4?c:"hvc1"===c?"hvc1.1.c.L120.90":"av01"===c?"av01.0.04M.08":"avc1"===c||b===f.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}b.default=h},"./src/task-loop.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=a.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(a){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,a),!0)},b.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},a}()},"./src/types/cmcd.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"CMCDVersion",function(){return j}),c.d(b,"CMCDObjectType",function(){return d}),c.d(b,"CMCDStreamingFormat",function(){return e}),c.d(b,"CMCDStreamType",function(){return f});var d,e,f,g,h,i,j=1;(g=d||(d={})).MANIFEST="m",g.AUDIO="a",g.VIDEO="v",g.MUXED="av",g.INIT="i",g.CAPTION="c",g.TIMED_TEXT="tt",g.KEY="k",g.OTHER="o",(h=e||(e={})).DASH="d",h.HLS="h",h.SMOOTH="s",h.OTHER="o",(i=f||(f={})).VOD="v",i.LIVE="l"},"./src/types/level.ts":function(a,b,c){"use strict";function d(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function e(a,b){var c=a.canSkipUntil,d=a.canSkipDateRanges,e=a.endSN;return c&&(void 0!==b?b-e:0)<c?d?g.v2:g.Yes:(0,g.No)}c.r(b),c.d(b,"HlsSkip",function(){return g}),c.d(b,"getSkipValue",function(){return e}),c.d(b,"HlsUrlParameters",function(){return h}),c.d(b,"Level",function(){return i}),(f=g||(g={})).No="",f.Yes="YES",f.v2="v2";var f,g,h=function(){function a(a,b,c){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=b,this.skip=c}return a.prototype.addDirectives=function(a){var b=new self.URL(a);return void 0!==this.msn&&b.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&b.searchParams.set("_HLS_part",this.part.toString()),this.skip&&b.searchParams.set("_HLS_skip",this.skip),b.toString()},a}(),i=function(){var a,b,c;function e(a){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[a.url],this.attrs=a.attrs,this.bitrate=a.bitrate,a.details&&(this.details=a.details),this.id=a.id||0,this.name=a.name,this.width=a.width||0,this.height=a.height||0,this.audioCodec=a.audioCodec,this.videoCodec=a.videoCodec,this.unknownCodecs=a.unknownCodecs,this.codecSet=[a.videoCodec,a.audioCodec].filter(function(a){return a}).join(",").replace(/\.[^.,]+/g,"")}return a=e,b=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(a){var b=a%this.url.length;this._urlId!==b&&(this.details=void 0,this._urlId=b)}}],d(a.prototype,b),c&&d(a,c),e}()},"./src/types/loader.ts":function(a,b,c){"use strict";var d,e,f,g;c.r(b),c.d(b,"PlaylistContextType",function(){return d}),c.d(b,"PlaylistLevelType",function(){return e}),(f=d||(d={})).MANIFEST="manifest",f.LEVEL="level",f.AUDIO_TRACK="audioTrack",f.SUBTITLE_TRACK="subtitleTrack",(g=e||(e={})).MAIN="main",g.AUDIO="audio",g.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"ChunkMetadata",function(){return d});var d=function(a,b,c,d,f,g){void 0===d&&(d=0),void 0===f&&(f=-1),void 0===g&&(g=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=e(),this.buffering={audio:e(),video:e(),audiovideo:e()},this.level=a,this.sn=b,this.id=c,this.size=d,this.part=f,this.partial=g};function e(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"AttrList",function(){return f});var d=/^(\d+)x(\d+)$/,e=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,f=function(){function a(b){for(var c in"string"==typeof b&&(b=a.parseAttrList(b)),b)b.hasOwnProperty(c)&&(this[c]=b[c])}var b=a.prototype;return b.decimalInteger=function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b},b.hexadecimalInteger=function(a){if(!this[a])return null;var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c},b.hexadecimalIntegerAsNumber=function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b},b.decimalFloatingPoint=function(a){return parseFloat(this[a])},b.optionalFloat=function(a,b){var c=this[a];return c?parseFloat(c):b},b.enumeratedString=function(a){return this[a]},b.bool=function(a){return"YES"===this[a]},b.decimalResolution=function(a){var b=d.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}},a.parseAttrList=function(a){var b,c={};for(e.lastIndex=0;null!==(b=e.exec(a));){var d=b[2];0===d.indexOf('"')&&d.lastIndexOf('"')===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d}return c},a}()},"./src/utils/binary-search.ts":function(a,b,c){"use strict";c.r(b),b.default={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){var g=b(f=a[e=(c+d)/2|0]);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}}},"./src/utils/buffer-helper.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"BufferHelper",function(){return f});var d=c(/*! ./logger */ "./src/utils/logger.ts"),e={length:0,start:function(){return 0},end:function(){return 0}},f=function(){function a(){}return a.isBuffered=function(b,c){try{if(b){for(var d=a.getBuffered(b),e=0;e<d.length;e++)if(c>=d.start(e)&&c<=d.end(e))return!0}}catch(f){}return!1},a.bufferInfo=function(b,c,d){try{if(b){var e,f=a.getBuffered(b),g=[];for(e=0;e<f.length;e++)g.push({start:f.start(e),end:f.end(e)});return this.bufferedInfo(g,c,d)}}catch(h){}return{len:0,start:c,end:c,nextStart:void 0}},a.bufferedInfo=function(a,b,c){b=Math.max(0,b),a.sort(function(a,b){var c=a.start-b.start;return c||b.end-a.end});var d,e=[];if(c)for(var f=0;f<a.length;f++){var g=e.length;if(g){var h=e[g-1].end;a[f].start-h<c?a[f].end>h&&(e[g-1].end=a[f].end):e.push(a[f])}else e.push(a[f])}else e=a;for(var i=0,j=b,k=b,l=0;l<e.length;l++){var m=e[l].start,n=e[l].end;if(b+c>=m&&b<n)j=m,i=(k=n)-b;else if(b+c<m){d=m;break}}return{len:i,start:j||0,end:k||0,nextStart:d}},a.getBuffered=function(a){try{return a.buffered}catch(b){return d.logger.log("failed to get media.buffered",b),e}},a}()},"./src/utils/cea-608-parser.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"Row",function(){return r}),c.d(b,"CaptionScreen",function(){return s});var d,e,f=c(/*! ../utils/logger */ "./src/utils/logger.ts"),g={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},h=function(a){var b=a;return g.hasOwnProperty(a)&&(b=g[a]),String.fromCharCode(b)},i={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},j={17:2,18:4,21:6,22:8,23:10,19:13,20:15},k={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},m=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(e=d||(d={}))[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA";var n=function(){function a(){this.time=null,this.verboseLevel=d.ERROR}return a.prototype.log=function(a,b){this.verboseLevel>=a&&f.logger.log(this.time+" ["+a+"] "+b)},a}(),o=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},p=function(){function a(a,b,c,d,e){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1}var b=a.prototype;return b.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},b.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},b.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},b.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},b.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},b.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),q=function(){function a(a,b,c,d,e,f){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new p(b,c,d,e,f)}var b=a.prototype;return b.reset=function(){this.uchar=" ",this.penState.reset()},b.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},b.setPenState=function(a){this.penState.copy(a)},b.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},b.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},b.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),r=function(){function a(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var b=0;b<100;b++)this.chars.push(new q);this.logger=a,this.pos=0,this.currPenState=new p}var b=a.prototype;return b.equals=function(a){for(var b=!0,c=0;c<100;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},b.copy=function(a){for(var b=0;b<100;b++)this.chars[b].copy(a.chars[b])},b.isEmpty=function(){for(var a=!0,b=0;b<100;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},b.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(d.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(d.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},b.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},b.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},b.insertChar=function(a){a>=144&&this.backSpace();var b=h(a);if(this.pos>=100){this.logger.log(d.ERROR,"Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1)},b.clearFromPos=function(a){var b;for(b=a;b<100;b++)this.chars[b].reset()},b.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},b.clearToEndOfRow=function(){this.clearFromPos(this.pos)},b.getTextString=function(){for(var a=[],b=!0,c=0;c<100;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},b.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},a}(),s=function(){function a(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var b=0;b<15;b++)this.rows.push(new r(a));this.logger=a,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var b=a.prototype;return b.reset=function(){for(var a=0;a<15;a++)this.rows[a].clear();this.currRow=14},b.equals=function(a){for(var b=!0,c=0;c<15;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},b.copy=function(a){for(var b=0;b<15;b++)this.rows[b].copy(a.rows[b])},b.isEmpty=function(){for(var a=!0,b=0;b<15;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},b.backSpace=function(){this.rows[this.currRow].backSpace()},b.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},b.insertChar=function(a){this.rows[this.currRow].insertChar(a)},b.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},b.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},b.setCursor=function(a){this.logger.log(d.INFO,"setCursor: "+a),this.rows[this.currRow].setCursor(a)},b.setPAC=function(a){this.logger.log(d.INFO,"pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;c<15;c++)this.rows[c].clear();var e=this.currRow+1-this.nrRollUpRows,f=this.lastOutputScreen;if(f){var g=f.rows[e].cueStartTime,h=this.logger.time;if(g&&null!==h&&g<h)for(var i=0;i<this.nrRollUpRows;i++)this.rows[b-this.nrRollUpRows+i+1].copy(f.rows[e+i])}}this.currRow=b;var j=this.rows[this.currRow];if(null!==a.indent){var k=Math.max(a.indent-1,0);j.setCursor(a.indent),a.color=j.chars[k].penState.foreground}var l={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(l)},b.setBkgData=function(a){this.logger.log(d.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},b.setRollUpRows=function(a){this.nrRollUpRows=a},b.rollUp=function(){if(null===this.nrRollUpRows){this.logger.log(d.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(d.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),this.logger.log(d.INFO,"Rolling up")},b.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<15;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},b.getTextAndFormat=function(){return this.rows},a}(),t=function(){function a(a,b,c){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new s(c),this.nonDisplayedMemory=new s(c),this.lastOutputScreen=new s(c),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=c}var b=a.prototype;return b.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},b.getHandler=function(){return this.outputFilter},b.setHandler=function(a){this.outputFilter=a},b.setPAC=function(a){this.writeScreen.setPAC(a)},b.setBkgData=function(a){this.writeScreen.setBkgData(a)},b.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(d.INFO,"MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},b.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(d.INFO,c+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(d.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},b.ccRCL=function(){this.logger.log(d.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},b.ccBS=function(){this.logger.log(d.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},b.ccAOF=function(){},b.ccAON=function(){},b.ccDER=function(){this.logger.log(d.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},b.ccRU=function(a){this.logger.log(d.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},b.ccFON=function(){this.logger.log(d.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},b.ccRDC=function(){this.logger.log(d.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},b.ccTR=function(){this.logger.log(d.INFO,"TR"),this.setMode("MODE_TEXT")},b.ccRTD=function(){this.logger.log(d.INFO,"RTD"),this.setMode("MODE_TEXT")},b.ccEDM=function(){this.logger.log(d.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},b.ccCR=function(){this.logger.log(d.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},b.ccENM=function(){this.logger.log(d.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},b.ccEOC=function(){if(this.logger.log(d.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(d.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},b.ccTO=function(a){this.logger.log(d.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},b.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2==1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,e=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=e[c]}this.logger.log(d.INFO,"MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},b.outputDataUpdate=function(a){void 0===a&&(a=!1);var b=this.logger.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},b.cueSplitAtTime=function(a){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a)},a}(),u=function(){function a(a,b,c){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var d=new n;this.channels=[null,new t(a,b,d),new t(a+1,c,d)],this.cmdHistory=x(),this.logger=d}var b=a.prototype;return b.getHandler=function(a){return this.channels[a].getHandler()},b.setHandler=function(a,b){this.channels[a].setHandler(b)},b.addData=function(a,b){var c,e,f,g=!1;this.logger.time=a;for(var h=0;h<b.length;h+=2)if(e=127&b[h],f=127&b[h+1],0!==e||0!==f){if(this.logger.log(d.DATA,"["+o([b[h],b[h+1]])+"] -> ("+o([e,f])+")"),(c=this.parseCmd(e,f))||(c=this.parseMidrow(e,f)),c||(c=this.parsePAC(e,f)),c||(c=this.parseBackgroundAttributes(e,f)),!c&&(g=this.parseChars(e,f))){var i=this.currentChannel;i&&i>0?this.channels[i].insertChars(g):this.logger.log(d.WARNING,"No channel found yet. TEXT-MODE?")}c||g||this.logger.log(d.WARNING,"Couldn't parse cleaned data "+o([e,f])+" orig: "+o([b[h],b[h+1]]))}},b.parseCmd=function(a,b){var c=this.cmdHistory;if(!((20===a||28===a||21===a||29===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=33&&b<=35))return!1;if(w(a,b,c))return v(null,null,c),this.logger.log(d.DEBUG,"Repeated command ("+o([a,b])+") is dropped"),!0;var e=20===a||21===a||23===a?1:2,f=this.channels[e];return 20===a||21===a||28===a||29===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),v(a,b,c),this.currentChannel=e,!0},b.parseMidrow=function(a,b){var c=0;if((17===a||25===a)&&b>=32&&b<=47){if((c=17===a?1:2)!==this.currentChannel)return this.logger.log(d.ERROR,"Mismatch channel in midrow parsing"),!1;var e=this.channels[c];return!!e&&(e.ccMIDROW(b),this.logger.log(d.DEBUG,"MIDROW ("+o([a,b])+")"),!0)}return!1},b.parsePAC=function(a,b){var c,d=this.cmdHistory;if(!((a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127||(16===a||24===a)&&b>=64&&b<=95))return!1;if(w(a,b,d))return v(null,null,d),!0;var e=a<=23?1:2;c=b>=64&&b<=95?1===e?i[a]:k[a]:1===e?j[a]:l[a];var f=this.channels[e];return!!f&&(f.setPAC(this.interpretPAC(c,b)),v(a,b,d),this.currentChannel=e,!0)},b.interpretPAC=function(a,b){var c,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=(1&c)==1,c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},b.parseChars=function(a,b){var c,e,f=null,g=null;if(a>=25?(c=2,g=a-8):(c=1,g=a),g>=17&&g<=19?(e=17===g?b+80:18===g?b+112:b+144,this.logger.log(d.INFO,"Special char '"+h(e)+"' in channel "+c),f=[e]):a>=32&&a<=127&&(f=0===b?[a]:[a,b]),f){var i=o(f);this.logger.log(d.DEBUG,"Char codes =  "+i.join(",")),v(a,b,this.cmdHistory)}return f},b.parseBackgroundAttributes=function(a,b){if(!((16===a||24===a)&&b>=32&&b<=47||(23===a||31===a)&&b>=45&&b<=47))return!1;var c,d={};return 16===a||24===a?(c=Math.floor((b-32)/2),d.background=m[c],b%2==1&&(d.background=d.background+"_semi")):45===b?d.background="transparent":(d.foreground="black",47===b&&(d.underline=!0)),this.channels[a<=23?1:2].setBkgData(d),v(a,b,this.cmdHistory),!0},b.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var b=this.channels[a];b&&b.reset()}this.cmdHistory=x()},b.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++){var c=this.channels[b];c&&c.cueSplitAtTime(a)}},a}();function v(a,b,c){c.a=a,c.b=b}function w(a,b,c){return c.a===a&&c.b===b}function x(){return{a:null,b:null}}b.default=u},"./src/utils/codecs.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"isCodecType",function(){return e}),c.d(b,"isCodecSupportedInMp4",function(){return f});var d={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function e(a,b){var c=d[b];return!!c&& !0===c[a.slice(0,4)]}function f(a,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}},"./src/utils/cues.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ./vttparser */ "./src/utils/vttparser.ts"),e=c(/*! ./webvtt-parser */ "./src/utils/webvtt-parser.ts"),f=c(/*! ./texttrack-utils */ "./src/utils/texttrack-utils.ts"),g=/\s/;b.default={newCue:function(a,b,c,h){for(var i,j,k,l,m,n=[],o=self.VTTCue||self.TextTrackCue,p=0;p<h.rows.length;p++)if(i=h.rows[p],k=!0,l=0,m="",!i.isEmpty()){for(var q=0;q<i.chars.length;q++)g.test(i.chars[q].uchar)&&k?l++:(m+=i.chars[q].uchar,k=!1);i.cueStartTime=b,b===c&&(c+=1e-4),l>=16?l--:l++;var r=Object(d.fixLineBreaks)(m.trim()),s=Object(e.generateCueId)(b,c,r);a&&a.cues&&a.cues.getCueById(s)||((j=new o(b,c,r)).id=s,j.line=p+1,j.align="left",j.position=10+Math.min(80,10*Math.floor(8*l/32)),n.push(j))}return a&&n.length&&(n.sort(function(a,b){return"auto"===a.line||"auto"===b.line?0:a.line>8&&b.line>8?b.line-a.line:a.line-b.line}),n.forEach(function(b){return Object(f.addCueToTrack)(a,b)})),n}}},"./src/utils/discontinuities.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"findFirstFragWithCC",function(){return g}),c.d(b,"shouldAlignOnDiscontinuities",function(){return h}),c.d(b,"findDiscontinuousReferenceFrag",function(){return i}),c.d(b,"adjustSlidingStart",function(){return k}),c.d(b,"alignStream",function(){return l}),c.d(b,"alignPDT",function(){return n}),c.d(b,"alignFragmentByPDTDelta",function(){return o}),c.d(b,"alignMediaPlaylistByPDT",function(){return p});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ./logger */ "./src/utils/logger.ts"),f=c(/*! ../controller/level-helper */ "./src/controller/level-helper.ts");function g(a,b){for(var c=null,d=0,e=a.length;d<e;d++){var f=a[d];if(f&&f.cc===b){c=f;break}}return c}function h(a,b,c){return!!b.details&&(!!(c.endCC>c.startCC)|| !!a&&!!(a.cc<c.startCC))}function i(a,b){var c=a.fragments,d=b.fragments;if(!d.length||!c.length){e.logger.log("No fragments to align");return}var f=g(c,d[0].cc);if(!f||f&&!f.startPTS){e.logger.log("No frag in previous level to align on");return}return f}function j(a,b){if(a){var c=a.start+b;a.start=a.startPTS=c,a.endPTS=c+a.duration}}function k(a,b){for(var c=b.fragments,d=0,e=c.length;d<e;d++)j(c[d],a);b.fragmentHint&&j(b.fragmentHint,a),b.alignedSliding=!0}function l(a,b,c){b&&(m(a,c,b),!c.alignedSliding&&b.details&&n(c,b.details),c.alignedSliding||!b.details||c.skippedSegments||Object(f.adjustSliding)(b.details,c))}function m(a,b,c){if(h(a,c,b)){var f=i(c.details,b);f&&Object(d.isFiniteNumber)(f.start)&&(e.logger.log("Adjusting PTS using last level due to CC increase within current level "+b.url),k(f.start,b))}}function n(a,b){if(b.fragments.length&&a.hasProgramDateTime&&b.hasProgramDateTime){var c=b.fragments[0].programDateTime,f=a.fragments[0].programDateTime,g=(f-c)/1e3+b.fragments[0].start;g&&Object(d.isFiniteNumber)(g)&&(e.logger.log("Adjusting PTS using programDateTime delta "+(f-c)+"ms, sliding:"+g.toFixed(3)+" "+a.url+" "),k(g,a))}}function o(a,b){var c=a.programDateTime;if(c){var d=(c-b)/1e3;a.start=a.startPTS=d,a.endPTS=d+a.duration}}function p(a,b){if(b.fragments.length&&a.hasProgramDateTime&&b.hasProgramDateTime){var c=b.fragments[0].programDateTime,d=b.fragments[0].start,e=c-1e3*d;a.fragments.forEach(function(a){o(a,e)}),a.fragmentHint&&o(a.fragmentHint,e),a.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../utils/ewma */ "./src/utils/ewma.ts"),e=function(){function a(a,b,c){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=c,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new d.default(a),this.fast_=new d.default(b)}var b=a.prototype;return b.update=function(a,b){var c=this.slow_,e=this.fast_;this.slow_.halfLife!==a&&(this.slow_=new d.default(a,c.getEstimate(),c.getTotalWeight())),this.fast_.halfLife!==b&&(this.fast_=new d.default(b,e.getEstimate(),e.getTotalWeight()))},b.sample=function(a,b){var c=(a=Math.max(a,this.minDelayMs_))/1e3,d=8*b/c;this.fast_.sample(c,d),this.slow_.sample(c,d)},b.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},a}();b.default=e},"./src/utils/ewma.ts":function(a,b,c){"use strict";c.r(b);var d=function(){function a(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=a,this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=b,this.totalWeight_=c}var b=a.prototype;return b.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);if(a)return this.estimate_/a}return this.estimate_},a}();b.default=d},"./src/utils/fetch-loader.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"fetchSupported",function(){return n});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ../loader/load-stats */ "./src/loader/load-stats.ts"),f=c(/*! ../demux/chunk-cache */ "./src/demux/chunk-cache.ts");function g(a){var b="function"==typeof Map?new Map:void 0;return(g=function(a){if(null===a||!j(a))return a;if("function"!=typeof a)throw TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}function c(){return h(a,arguments,l(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),k(c,a)})(a)}function h(a,b,c){return(h=i()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);var e=new(Function.bind.apply(a,d));return c&&k(e,c.prototype),e}).apply(null,arguments)}function i(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function j(a){return -1!==Function.toString.call(a).indexOf("[native code]")}function k(a,b){return(k=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function l(a){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function m(){return(m=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function n(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(a){}return!1}var o=function(){function a(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||q,this.controller=new self.AbortController,this.stats=new e.LoadStats}var b=a.prototype;return b.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},b.abortInternal=function(){var a=this.response;a&&a.ok||(this.stats.aborted=!0,this.controller.abort())},b.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&& void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},b.load=function(a,b,c){var e=this,f=this.stats;if(f.loading.start)throw Error("Loader can only be used once.");f.loading.start=self.performance.now();var g=p(a,this.controller.signal),h=c.onProgress,i="arraybuffer"===a.responseType,j=i?"byteLength":"length";this.context=a,this.config=b,this.callbacks=c,this.request=this.fetchSetup(a,g),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){e.abortInternal(),c.onTimeout(f,a,e.response)},b.timeout),self.fetch(this.request).then(function(c){if(e.response=e.loader=c,!c.ok){var g=c.status,j=c.statusText;throw new r(j||"fetch, bad network response",g,c)}return(f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(c.headers.get("Content-Length")||"0"),h&&Object(d.isFiniteNumber)(b.highWaterMark))?e.loadProgressively(c,f,a,b.highWaterMark,h):i?c.arrayBuffer():c.text()}).then(function(g){var i=e.response;self.clearTimeout(e.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=g[j];var k={url:i.url,data:g};h&&!Object(d.isFiniteNumber)(b.highWaterMark)&&h(f,a,g,i),c.onSuccess(k,f,a,i)}).catch(function(b){if(self.clearTimeout(e.requestTimeout),!f.aborted){var d=b.code||0;c.onError({code:d,text:b.message},a,b.details)}})},b.getCacheAge=function(){var a=null;if(this.response){var b=this.response.headers.get("age");a=b?parseFloat(b):null}return a},b.loadProgressively=function(a,b,c,d,e){void 0===d&&(d=0);var g=new f.default,h=a.body.getReader();return function f(){return h.read().then(function(h){if(h.done)return g.dataLength&&e(b,c,g.flush(),a),Promise.resolve(new ArrayBuffer(0));var i=h.value,j=i.length;return b.loaded+=j,j<d||g.dataLength?(g.push(i),g.dataLength>=d&&e(b,c,g.flush(),a)):e(b,c,i,a),f()}).catch(function(){return Promise.reject()})}()},a}();function p(a,b){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:b,headers:new self.Headers(m({},a.headers))};return a.rangeEnd&&c.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),c}function q(a,b){return new self.Request(a.url,b)}var r=function(a){var b,c;function d(b,c,d){var e;return(e=a.call(this,b)||this).code=void 0,e.details=void 0,e.code=c,e.details=d,e}return b=d,c=a,b.prototype=Object.create(c.prototype),b.prototype.constructor=b,k(b,c),d}(g(Error));b.default=o},"./src/utils/imsc1-ttml-parser.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"IMSC1_CODEC",function(){return k}),c.d(b,"parseIMSC1",function(){return o});var d=c(/*! ./mp4-tools */ "./src/utils/mp4-tools.ts"),e=c(/*! ./vttparser */ "./src/utils/vttparser.ts"),f=c(/*! ./vttcue */ "./src/utils/vttcue.ts"),g=c(/*! ../demux/id3 */ "./src/demux/id3.ts"),h=c(/*! ./timescale-conversion */ "./src/utils/timescale-conversion.ts"),i=c(/*! ./webvtt-parser */ "./src/utils/webvtt-parser.ts");function j(){return(j=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}var k="stpp.ttml.im1t",l=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,m=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,n={left:"start",center:"center",right:"end",start:"start",end:"end"};function o(a,b,c,e,f){var i=Object(d.findBox)(new Uint8Array(a),["mdat"]);if(0===i.length){f(Error("Could not parse IMSC1 mdat"));return}var j=i[0],k=Object(g.utf8ArrayToStr)(new Uint8Array(a,j.start,j.end-j.start)),l=Object(h.toTimescaleFromScale)(b,1,c);try{e(p(k,l))}catch(m){f(m)}}function p(a,b){var c=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!c)throw Error("Invalid ttml");var d={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},e=Object.keys(d).reduce(function(a,b){return a[b]=c.getAttribute("ttp:"+b)||d[b],a},{}),g="preserve"!==c.getAttribute("xml:space"),h=r(q(c,"styling","style")),k=r(q(c,"layout","region")),l=q(c,"body","[begin]");return[].map.call(l,function(a){var c=s(a,g);if(!c||!a.hasAttribute("begin"))return null;var d=w(a.getAttribute("begin"),e),l=w(a.getAttribute("dur"),e),m=w(a.getAttribute("end"),e);if(null===d)throw v(a);if(null===m){if(null===l)throw v(a);m=d+l}var o=new f.default(d-b,m-b,c);o.id=Object(i.generateCueId)(o.startTime,o.endTime,o.text);var p=k[a.getAttribute("region")],q=h[a.getAttribute("style")];o.position=10,o.size=80;var r=t(p,q),u=r.textAlign;if(u){var x=n[u];x&&(o.lineAlign=x),o.align=u}return j(o,r),o}).filter(function(a){return null!==a})}function q(a,b,c){var d=a.getElementsByTagName(b)[0];return d?[].slice.call(d.querySelectorAll(c)):[]}function r(a){return a.reduce(function(a,b){var c=b.getAttribute("xml:id");return c&&(a[c]=b),a},{})}function s(a,b){return[].slice.call(a.childNodes).reduce(function(a,c,d){var e;return"br"===c.nodeName&&d?a+"\n":null!==(e=c.childNodes)&& void 0!==e&&e.length?s(c,b):b?a+c.textContent.trim().replace(/\s+/g," "):a+c.textContent},"")}function t(a,b){var c="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(d,e){var f=u(b,c,e)||u(a,c,e);return f&&(d[e]=f),d},{})}function u(a,b,c){return a.hasAttributeNS(b,c)?a.getAttributeNS(b,c):null}function v(a){return Error("Could not parse ttml timestamp "+a)}function w(a,b){if(!a)return null;var c=Object(e.parseTimeStamp)(a);return null===c&&(l.test(a)?c=x(a,b):m.test(a)&&(c=y(a,b))),c}function x(a,b){var c=l.exec(a),d=(0|c[4])+(0|c[5])/b.subFrameRate;return(0|c[1])*3600+(0|c[2])*60+(0|c[3])+d/b.frameRate}function y(a,b){var c=m.exec(a),d=Number(c[1]),e=c[2];switch(e){case"h":return 3600*d;case"m":return 60*d;case"ms":return 1e3*d;case"f":return d/b.frameRate;case"t":return d/b.tickRate}return d}},"./src/utils/logger.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"enableLogs",function(){return g}),c.d(b,"logger",function(){return h});var d=function(){},e={trace:d,debug:d,log:d,warn:d,info:d,error:d},f=e;function g(a){if(self.console&& !0===a||"object"==typeof a){!function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];c.forEach(function(b){var c,e;f[b]=a[b]?a[b].bind(a):(c=b,(e=self.console[c])?e.bind(self.console,"["+c+"] >"):d)})}(a,"debug","log","info","warn","error");try{f.log()}catch(b){f=e}}else f=e}var h=f},"./src/utils/mediakeys-helper.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"KeySystems",function(){return e}),c.d(b,"requestMediaKeySystemAccess",function(){return f}),(d=e||(e={})).WIDEVINE="com.widevine.alpha",d.PLAYREADY="com.microsoft.playready";var d,e,f="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(a,b,c){"use strict";function d(){return self.MediaSource||self.WebKitMediaSource}c.r(b),c.d(b,"getMediaSource",function(){return d})},"./src/utils/mp4-tools.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"bin2str",function(){return g}),c.d(b,"readUint16",function(){return h}),c.d(b,"readUint32",function(){return i}),c.d(b,"writeUint32",function(){return j}),c.d(b,"findBox",function(){return k}),c.d(b,"parseSegmentIndex",function(){return l}),c.d(b,"parseInitSegment",function(){return m}),c.d(b,"getStartDTS",function(){return n}),c.d(b,"getDuration",function(){return o}),c.d(b,"computeRawDurationFromSamples",function(){return p}),c.d(b,"offsetStartDTS",function(){return q}),c.d(b,"segmentValidRange",function(){return r}),c.d(b,"appendUint8Array",function(){return s});var d=c(/*! ./typed-array */ "./src/utils/typed-array.ts"),e=c(/*! ../loader/fragment */ "./src/loader/fragment.ts"),f=[].push;function g(a){return String.fromCharCode.apply(null,a)}function h(a,b){"data"in a&&(b+=a.start,a=a.data);var c=a[b]<<8|a[b+1];return c<0?65536+c:c}function i(a,b){"data"in a&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return c<0?4294967296+c:c}function j(a,b,c){"data"in a&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c}function k(a,b){var c,d,e,h=[];if(!b.length)return h;"data"in a?(c=a.data,d=a.start,e=a.end):(d=0,e=(c=a).byteLength);for(var j=d;j<e;){var l=i(c,j),m=g(c.subarray(j+4,j+8)),n=l>1?j+l:e;if(m===b[0]){if(1===b.length)h.push({data:c,start:j+8,end:n});else{var o=k({data:c,start:j+8,end:n},b.slice(1));o.length&&f.apply(h,o)}}j=n}return h}function l(a){var b=k(a,["moov"])[0],c=b?b.end:null,d=k(a,["sidx"]);if(!d||!d[0])return null;var e=[],f=d[0],g=f.data[0],j=0===g?8:16,l=i(f,j);j+=4;var m=0;0===g?j+=8:j+=16,j+=2;var n=f.end+m,o=h(f,j);j+=2;for(var p=0;p<o;p++){var q=j,r=i(f,q);q+=4;var s=2147483647&r;if(1==(2147483648&r)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var t=i(f,q);q+=4,e.push({referenceSize:s,subsegmentDuration:t,info:{duration:t/l,start:n,end:n+s-1}}),n+=s,q+=4,j=q}return{earliestPresentationTime:0,timescale:l,version:g,referencesCount:o,references:e,moovEndOffset:c}}function m(a){for(var b=[],c=k(a,["moov","trak"]),d=0;d<c.length;d++){var f=c[d],h=k(f,["tkhd"])[0];if(h){var j=h.data[h.start],l=0===j?12:20,m=i(h,l),n=k(f,["mdia","mdhd"])[0];if(n){l=0===(j=n.data[n.start])?12:20;var o=i(n,l),p=k(f,["mdia","hdlr"])[0];if(p){var q=g(p.data.subarray(p.start+8,p.start+12)),r={soun:e.ElementaryStreamTypes.AUDIO,vide:e.ElementaryStreamTypes.VIDEO}[q];if(r){var s=k(f,["mdia","minf","stbl","stsd"])[0],t=void 0;s&&(t=g(s.data.subarray(s.start+12,s.start+16))),b[m]={timescale:o,type:r},b[r]={timescale:o,id:m,codec:t}}}}}}return k(a,["moov","mvex","trex"]).forEach(function(a){var c=b[i(a,4)];c&&(c.default={duration:i(a,12),flags:i(a,20)})}),b}function n(a,b){return k(b,["moof","traf"]).reduce(function(b,c){var d=k(c,["tfdt"])[0],e=d.data[d.start],f=k(c,["tfhd"]).reduce(function(b,c){var f=a[i(c,4)];if(f){var g=i(d,4);1===e&&(g*=4294967296,g+=i(d,8));var h=g/(f.timescale||9e4);if(isFinite(h)&&(null===b||h<b))return h}return b},null);return null!==f&&isFinite(f)&&(null===b||f<b)?f:b},null)||0}function o(a,b){for(var c=0,d=0,f=0,g=k(a,["moof","traf"]),h=0;h<g.length;h++){var j=g[h],m=k(j,["tfhd"])[0],n=b[i(m,4)];if(n){var o=n.default,q=i(m,0)|(null==o?void 0:o.flags),r=null==o?void 0:o.duration;8&q&&(r=2&q?i(m,12):i(m,8));for(var s=n.timescale||9e4,t=k(j,["trun"]),u=0;u<t.length;u++){if(!(c=p(t[u]))&&r){var v=i(t[u],4);c=r*v}n.type===e.ElementaryStreamTypes.VIDEO?d+=c/s:n.type===e.ElementaryStreamTypes.AUDIO&&(f+=c/s)}}}if(0===d&&0===f){var w=l(a);if(null!=w&&w.references)return w.references.reduce(function(a,b){return a+b.info.duration||0},0)}return d||f}function p(a){var b=i(a,0),c=8;1&b&&(c+=4),4&b&&(c+=4);for(var d=0,e=i(a,4),f=0;f<e;f++){if(256&b){var g=i(a,c);d+=g,c+=4}512&b&&(c+=4),1024&b&&(c+=4),2048&b&&(c+=4)}return d}function q(a,b,c){k(b,["moof","traf"]).forEach(function(b){k(b,["tfhd"]).forEach(function(d){var e=a[i(d,4)];if(e){var f=e.timescale||9e4;k(b,["tfdt"]).forEach(function(a){var b=a.data[a.start],d=i(a,4);if(0===b)j(a,4,d-c*f);else{d*=4294967296,d+=i(a,8),d-=c*f,d=Math.max(d,0);var e=Math.floor(d/4294967296),g=Math.floor(d%4294967296);j(a,4,e),j(a,8,g)}})}})})}function r(a){var b={valid:null,remainder:null},c=k(a,["moof"]);if(!c)return b;if(c.length<2)return b.remainder=a,b;var e=c[c.length-1];return b.valid=Object(d.sliceUint8)(a,0,e.start-8),b.remainder=Object(d.sliceUint8)(a,e.start-8),b}function s(a,b){var c=new Uint8Array(a.length+b.length);return c.set(a),c.set(b,a.length),c}},"./src/utils/output-filter.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"default",function(){return d});var d=function(){function a(a,b){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=a,this.trackName=b}var b=a.prototype;return b.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},a}()},"./src/utils/texttrack-utils.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"sendAddTrackEvent",function(){return e}),c.d(b,"addCueToTrack",function(){return f}),c.d(b,"clearCurrentCues",function(){return g}),c.d(b,"removeCuesInRange",function(){return h}),c.d(b,"getCuesInRange",function(){return i});var d=c(/*! ./logger */ "./src/utils/logger.ts");function e(a,b){var c;try{c=new Event("addtrack")}catch(d){(c=document.createEvent("Event")).initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)}function f(a,b){var c=a.mode;if("disabled"===c&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(b.id))try{if(a.addCue(b),!a.cues.getCueById(b.id))throw Error("addCue is failed for: "+b)}catch(e){d.logger.debug("[texttrack-utils]: "+e);var f=new self.TextTrackCue(b.startTime,b.endTime,b.text);f.id=b.id,a.addCue(f)}"disabled"===c&&(a.mode=c)}function g(a){var b=a.mode;if("disabled"===b&&(a.mode="hidden"),a.cues)for(var c=a.cues.length;c--;)a.removeCue(a.cues[c]);"disabled"===b&&(a.mode=b)}function h(a,b,c){var d=a.mode;if("disabled"===d&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var e=i(a.cues,b,c),f=0;f<e.length;f++)a.removeCue(e[f]);"disabled"===d&&(a.mode=d)}function i(a,b,c){var d=[],e=function(a,b){if(b<a[0].startTime)return 0;var c=a.length-1;if(b>a[c].endTime)return -1;for(var d=0,e=c;d<=e;){var f=Math.floor((e+d)/2);if(b<a[f].startTime)e=f-1;else{if(!(b>a[f].startTime)||!(d<c))return f;d=f+1}}return a[d].startTime-b<b-a[e].startTime?d:e}(a,b);if(e> -1)for(var f=e,g=a.length;f<g;f++){var h=a[f];if(h.startTime>=b&&h.endTime<=c)d.push(h);else if(h.startTime>c)break}return d}},"./src/utils/time-ranges.ts":function(a,b,c){"use strict";c.r(b),b.default={toString:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}}},"./src/utils/timescale-conversion.ts":function(a,b,c){"use strict";function d(a,b,c,d){void 0===c&&(c=1),void 0===d&&(d=!1);var e=a*b*c;return d?Math.round(e):e}function e(a,b,c,e){return void 0===c&&(c=1),void 0===e&&(e=!1),d(a,b,1/c,e)}function f(a,b){return void 0===b&&(b=!1),d(a,1e3,11111111111111112e-21,b)}function g(a,b){return void 0===b&&(b=1),d(a,9e4,1/b)}c.r(b),c.d(b,"toTimescaleFromBase",function(){return d}),c.d(b,"toTimescaleFromScale",function(){return e}),c.d(b,"toMsFromMpegTsClock",function(){return f}),c.d(b,"toMpegTsClockFromTimescale",function(){return g})},"./src/utils/typed-array.ts":function(a,b,c){"use strict";function d(a,b,c){return Uint8Array.prototype.slice?a.slice(b,c):new Uint8Array(Array.prototype.slice.call(a,b,c))}c.r(b),c.d(b,"sliceUint8",function(){return d})},"./src/utils/vttcue.ts":function(a,b,c){"use strict";c.r(b),b.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var a=["","lr","rl"],b=["start","middle","end","left","right"];function c(a,b){if("string"!=typeof b||!Array.isArray(a))return!1;var c=b.toLowerCase();return!!~a.indexOf(c)&&c}function d(a){return c(b,a)}function e(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];for(var e=1;e<arguments.length;e++){var f=arguments[e];for(var g in f)a[g]=f[g]}return a}function f(b,f,g){var h=this,i={enumerable:!0};h.hasBeenReset=!1;var j="",k=!1,l=b,m=f,n=g,o=null,p="",q=!0,r="auto",s="start",t=50,u="middle",v=50,w="middle";Object.defineProperty(h,"id",e({},i,{get:function(){return j},set:function(a){j=""+a}})),Object.defineProperty(h,"pauseOnExit",e({},i,{get:function(){return k},set:function(a){k=!!a}})),Object.defineProperty(h,"startTime",e({},i,{get:function(){return l},set:function(a){if("number"!=typeof a)throw TypeError("Start time must be set to a number.");l=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",e({},i,{get:function(){return m},set:function(a){if("number"!=typeof a)throw TypeError("End time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",e({},i,{get:function(){return n},set:function(a){n=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",e({},i,{get:function(){return o},set:function(a){o=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",e({},i,{get:function(){return p},set:function(b){var d,e=c(a,d=b);if(!1===e)throw SyntaxError("An invalid or illegal string was specified.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",e({},i,{get:function(){return q},set:function(a){q=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",e({},i,{get:function(){return r},set:function(a){if("number"!=typeof a&&"auto"!==a)throw SyntaxError("An invalid number or illegal string was specified.");r=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",e({},i,{get:function(){return s},set:function(a){var b=d(a);if(!b)throw SyntaxError("An invalid or illegal string was specified.");s=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",e({},i,{get:function(){return t},set:function(a){if(a<0||a>100)throw Error("Position must be between 0 and 100.");t=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",e({},i,{get:function(){return u},set:function(a){var b=d(a);if(!b)throw SyntaxError("An invalid or illegal string was specified.");u=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",e({},i,{get:function(){return v},set:function(a){if(a<0||a>100)throw Error("Size must be between 0 and 100.");v=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",e({},i,{get:function(){return w},set:function(a){var b=d(a);if(!b)throw SyntaxError("An invalid or illegal string was specified.");w=b,this.hasBeenReset=!0}})),h.displayState=void 0}return f.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},f}()},"./src/utils/vttparser.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"parseTimeStamp",function(){return f}),c.d(b,"fixLineBreaks",function(){return l}),c.d(b,"VTTParser",function(){return m});var d=c(/*! ./vttcue */ "./src/utils/vttcue.ts"),e=function(){function a(){}return a.prototype.decode=function(a,b){if(!a)return"";if("string"!=typeof a)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))},a}();function f(a){function b(a,b,c,d){return(0|a)*3600+(0|b)*60+(0|c)+parseFloat(d||0)}var c=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return c?parseFloat(c[2])>59?b(c[2],c[3],0,c[4]):b(c[1],c[2],c[3],c[4]):null}var g=function(){function a(){this.values=Object.create(null)}var b=a.prototype;return b.set=function(a,b){this.get(a)||""===b||(this.values[a]=b)},b.get=function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},b.has=function(a){return a in this.values},b.alt=function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},b.integer=function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},b.percent=function(a,b){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(b)){var c=parseFloat(b);if(c>=0&&c<=100)return this.set(a,c),!0}return!1},a}();function h(a,b,c,d){var e=d?a.split(d):[a];for(var f in e){if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}}var i=new d.default(0,0,""),j="middle"===i.align?"middle":"center";function k(a,b,c){var d,e,k,l,m,n=a;function o(){var b=f(a);if(null===b)throw Error("Malformed timestamp: "+n);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function p(){a=a.replace(/^\s+/,"")}if(p(),b.startTime=o(),p(),"-->"!==a.substr(0,3))throw Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);a=a.substr(3),p(),b.endTime=o(),p(),d=a,e=b,k=new g,h(d,function(a,b){var d;switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){k.set(a,c[e].region);break}break;case"vertical":k.alt(a,b,["rl","lr"]);break;case"line":d=b.split(","),k.integer(a,d[0]),k.percent(a,d[0])&&k.set("snapToLines",!1),k.alt(a,d[0],["auto"]),2===d.length&&k.alt("lineAlign",d[1],["start",j,"end"]);break;case"position":d=b.split(","),k.percent(a,d[0]),2===d.length&&k.alt("positionAlign",d[1],["start",j,"end","line-left","line-right","auto"]);break;case"size":k.percent(a,b);break;case"align":k.alt(a,b,["start",j,"end","left","right"])}},/:/,/\s/),e.region=k.get("region",null),e.vertical=k.get("vertical",""),"auto"===(l=k.get("line","auto"))&& -1===i.line&&(l=-1),e.line=l,e.lineAlign=k.get("lineAlign","start"),e.snapToLines=k.get("snapToLines",!0),e.size=k.get("size",100),e.align=k.get("align",j),"auto"===(m=k.get("position","auto"))&&50===i.position&&(m="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=m}function l(a){return a.replace(/<br(?: \/)?>/gi,"\n")}var m=function(){function a(){this.state="INITIAL",this.buffer="",this.decoder=new e,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var b=a.prototype;return b.parse=function(a){var b=this;function c(){var a=b.buffer,c=0;for(a=l(a);c<a.length&&"\r"!==a[c]&&"\n"!==a[c];)++c;var d=a.substr(0,c);return"\r"===a[c]&& ++c,"\n"===a[c]&& ++c,b.buffer=a.substr(c),d}function e(a){h(a,function(a,b){},/:/)}a&&(b.buffer+=b.decoder.decode(a,{stream:!0}));try{var f="";if("INITIAL"===b.state){if(!/\r\n|\n/.test(b.buffer))return this;var g=(f=c()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!g||!g[0])throw Error("Malformed WebVTT signature.");b.state="HEADER"}for(var i=!1;b.buffer&&/\r\n|\n/.test(b.buffer);)switch(i?i=!1:f=c(),b.state){case"HEADER":/:/.test(f)?e(f):f||(b.state="ID");continue;case"NOTE":f||(b.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){b.state="NOTE";break}if(!f)continue;if(b.cue=new d.default(0,0,""),b.state="CUE",-1===f.indexOf("-->")){b.cue.id=f;continue}case"CUE":if(!b.cue){b.state="BADCUE";continue}try{k(f,b.cue,b.regionList)}catch(j){b.cue=null,b.state="BADCUE";continue}b.state="CUETEXT";continue;case"CUETEXT":var m=-1!==f.indexOf("-->");if(!f||m&&(i=!0)){b.oncue&&b.cue&&b.oncue(b.cue),b.cue=null,b.state="ID";continue}if(null===b.cue)continue;b.cue.text&&(b.cue.text+="\n"),b.cue.text+=f;continue;case"BADCUE":f||(b.state="ID")}}catch(n){"CUETEXT"===b.state&&b.cue&&b.oncue&&b.oncue(b.cue),b.cue=null,b.state="INITIAL"===b.state?"BADWEBVTT":"BADCUE"}return this},b.flush=function(){var a=this;try{if((a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state||"BADWEBVTT"===a.state)throw Error("Malformed WebVTT signature.")}catch(b){a.onparsingerror&&a.onparsingerror(b)}return a.onflush&&a.onflush(),this},a}()},"./src/utils/webvtt-parser.ts":function(a,b,c){"use strict";c.r(b),c.d(b,"generateCueId",function(){return m}),c.d(b,"parseWebVTT",function(){return o});var d=c(/*! ./src/polyfills/number */ "./src/polyfills/number.ts"),e=c(/*! ./vttparser */ "./src/utils/vttparser.ts"),f=c(/*! ../demux/id3 */ "./src/demux/id3.ts"),g=c(/*! ./timescale-conversion */ "./src/utils/timescale-conversion.ts"),h=c(/*! ../remux/mp4-remuxer */ "./src/remux/mp4-remuxer.ts"),i=/\r\n|\n\r|\n|\r/g,j=function(a,b,c){return void 0===c&&(c=0),a.substr(c,b.length)===b},k=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),e=parseInt(a.substr(-9,2)),f=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;if(!Object(d.isFiniteNumber)(b)||!Object(d.isFiniteNumber)(c)||!Object(d.isFiniteNumber)(e)||!Object(d.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return b+=1e3*c,b+=6e4*e,b+=36e5*f},l=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return(b>>>0).toString()};function m(a,b,c){return l(a.toString())+l(b.toString())+l(c)}var n=function(a,b,c){var d,e=a[b],f=a[e.prevCC];if(!f|| !f.new&&e.new){a.ccOffset=a.presentationOffset=e.start,e.new=!1;return}for(;null!==(d=f)&& void 0!==d&&d.new;)a.ccOffset+=e.start-f.start,e.new=!1,f=a[(e=f).prevCC];a.presentationOffset=c};function o(a,b,c,d,l,o,p,q){var r,s=new e.VTTParser,t=Object(f.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(i,"\n").split("\n"),u=[],v=Object(g.toMpegTsClockFromTimescale)(b,c),w="00:00.000",x=0,y=0,z=!0,A=!1;s.oncue=function(a){var b=d[l],c=d.ccOffset,e=(x-v)/9e4;if(null!=b&&b.new&&(void 0!==y?c=d.ccOffset=b.start:n(d,l,e)),e&&(c=e-d.presentationOffset),A){var f=a.endTime-a.startTime,g=Object(h.normalizePts)((a.startTime+c-y)*9e4,9e4*o)/9e4;a.startTime=g,a.endTime=g+f}var i=a.text.trim();a.text=decodeURIComponent(encodeURIComponent(i)),a.id||(a.id=m(a.startTime,a.endTime,i)),a.endTime>0&&u.push(a)},s.onparsingerror=function(a){r=a},s.onflush=function(){if(r){q(r);return}p(u)},t.forEach(function(a){if(z){if(j(a,"X-TIMESTAMP-MAP=")){z=!1,A=!0,a.substr(16).split(",").forEach(function(a){j(a,"LOCAL:")?w=a.substr(6):j(a,"MPEGTS:")&&(x=parseInt(a.substr(7)))});try{y=k(w)/1e3}catch(b){A=!1,r=b}return}""===a&&(z=!1)}s.parse(a+"\n")}),s.flush()}},"./src/utils/xhr-loader.ts":function(a,b,c){"use strict";c.r(b);var d=c(/*! ../utils/logger */ "./src/utils/logger.ts"),e=c(/*! ../loader/load-stats */ "./src/loader/load-stats.ts"),f=/^age:\s*[\d.]+\s*$/m,g=function(){function a(a){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=a?a.xhrSetup:null,this.stats=new e.LoadStats,this.retryDelay=0}var b=a.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var a=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),a&&(a.onreadystatechange=null,a.onprogress=null,4!==a.readyState&&(this.stats.aborted=!0,a.abort()))},b.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&& void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(a,b,c){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=a,this.config=b,this.callbacks=c,this.retryDelay=b.retryDelay,this.loadInternal()},b.loadInternal=function(){var a=this.config,b=this.context;if(a){var c=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0;var e=this.xhrSetup;try{if(e)try{e(c,b.url)}catch(f){c.open("GET",b.url,!0),e(c,b.url)}c.readyState||c.open("GET",b.url,!0);var g=this.context.headers;if(g)for(var h in g)c.setRequestHeader(h,g[h])}catch(i){this.callbacks.onError({code:c.status,text:i.message},b,c);return}b.rangeEnd&&c.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=b.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout),c.send()}},b.readystatechange=function(){var a=this.context,b=this.loader,c=this.stats;if(a&&b){var e=b.readyState,f=this.config;if(!c.aborted&&e>=2){if(self.clearTimeout(this.requestTimeout),0===c.loading.first&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),4===e){b.onreadystatechange=null,b.onprogress=null;var g=b.status;if(g>=200&&g<300){if(c.loading.end=Math.max(self.performance.now(),c.loading.first),i="arraybuffer"===a.responseType?(h=b.response).byteLength:(h=b.responseText).length,c.loaded=c.total=i,!this.callbacks)return;var h,i,j=this.callbacks.onProgress;if(j&&j(c,a,h,b),!this.callbacks)return;var k={url:b.responseURL,data:h};this.callbacks.onSuccess(k,c,a,b)}else c.retry>=f.maxRetry||g>=400&&g<499?(d.logger.error(g+" while loading "+a.url),this.callbacks.onError({code:g,text:b.statusText},a,b)):(d.logger.warn(g+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,f.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),f.timeout)}}},b.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url);var a=this.callbacks;a&&(this.abortInternal(),a.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total)},b.getCacheAge=function(){var a=null;if(this.loader&&f.test(this.loader.getAllResponseHeaders())){var b=this.loader.getResponseHeader("age");a=b?parseFloat(b):null}return a},a}();b.default=g}}).default})}}])